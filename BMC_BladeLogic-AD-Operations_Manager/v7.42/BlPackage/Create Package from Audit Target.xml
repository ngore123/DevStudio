<process draft="false" dev-studio-version="7.6.01.00">
  <process-def name=":BMC_BladeLogic-AD-Operations_Manager:v7.42:BlPackage:Create Package from Audit Target">
    <parameters>
      <input global="false" required="false">
        <description>XML document conforming to the ConnectionDetails Concept that contains the information required to execute a command.</description>
        <from>connection details</from>
        <to>connection details</to>
      </input>
      <input global="false" required="true">
        <description>Name of the package.</description>
        <from>packageName</from>
        <to>packageName</to>
      </input>
      <input global="false" required="true">
        <description>ID of a group that should contain the package.</description>
        <from>groupId</from>
        <to>groupId</to>
      </input>
      <input global="false" required="true">
        <description>True to create a package soft linked to the depot object resources, false otherwise.</description>
        <from>bSoftLinked</from>
        <to>bSoftLinked</to>
      </input>
      <input global="false" required="true">
        <description>True to package the file ACLs, false otherwise.</description>
        <from>bCollectFileAcl</from>
        <to>bCollectFileAcl</to>
      </input>
      <input global="false" required="true">
        <description>True to package the file attributes, false otherwise.</description>
        <from>bCollectFileAttributes</from>
        <to>bCollectFileAttributes</to>
      </input>
      <input global="false" required="true">
        <description>True to package the file contents, false otherwise.</description>
        <from>bCopyFileContents</from>
        <to>bCopyFileContents</to>
      </input>
      <input global="false" required="true">
        <description>True to package the registry ACLs, false otherwise.</description>
        <from>bCollectRegistryAcl</from>
        <to>bCollectRegistryAcl</to>
      </input>
      <input global="false" required="true">
        <description>Handle to the Audit Job result you want to package.</description>
        <from>auditJobResultKey</from>
        <to>auditJobResultKey</to>
      </input>
      <input global="false" required="true">
        <description>Handle to the template that should be packaged in the audit.</description>
        <from>templateKey</from>
        <to>templateKey</to>
      </input>
      <input global="false" required="false">
        <description>Name of the target component.</description>
        <from>targetComponent</from>
        <to>targetComponent</to>
      </input>
      <input global="false" required="false">
        <description>NSH path of the matching software file.</description>
        <from>matchFile</from>
        <to>matchFile</to>
      </input>
      <output global="false" required="true">
        <description>Success status of the command. "true" if successfule, "false" otherwise.</description>
        <to>status</to>
        <from>status</from>
      </output>
      <output global="false" required="false">
        <description>If "success" is false then error message contains the corresponding error message if any.</description>
        <to>error message</to>
        <from>error message</from>
      </output>
      <output global="false" required="false">
        <description>Contains the DB Key for the newly created BlPackage.</description>
        <to>DBKey</to>
        <from>return values</from>
      </output>
      <output global="false" required="false">
        <description>Contains any debug message accompanying the adapter response.</description>
        <to>debug message</to>
        <from>debug message</from>
      </output>
      <output global="false" required="true">
        <description>Contains the Adapter response for this command.</description>
        <to>output</to>
        <from>output</from>
      </output>
      <output global="false" required="false">
        <to>script lines</to>
        <from>script lines</from>
      </output>
    </parameters>
    <access />
    <sequence>
      <call-process>
        <process-name>:BMC_BladeLogic-AD-Operations_Manager:Utilities:Add up to 10 Arguments to List</process-name>
        <parameters>
          <input>
            <from>packageName</from>
            <to>argument 1</to>
          </input>
          <input>
            <from>groupId</from>
            <to>argument 2</to>
          </input>
          <input>
            <from>bSoftLinked</from>
            <to>argument 3</to>
          </input>
          <input>
            <from>bCollectFileAcl</from>
            <to>argument 4</to>
          </input>
          <input>
            <from>bCollectFileAttributes</from>
            <to>argument 5</to>
          </input>
          <input>
            <from>bCopyFileContents</from>
            <to>argument 6</to>
          </input>
          <input>
            <from>bCollectRegistryAcl</from>
            <to>argument 7</to>
          </input>
          <input>
            <from>auditJobResultKey</from>
            <to>argument 8</to>
          </input>
          <input>
            <from>templateKey</from>
            <to>argument 9</to>
          </input>
          <output>
            <from>updated list</from>
            <to>argument list</to>
          </output>
        </parameters>
        <meta>
          <documentation />
          <run-mode-handling>
            <run-mode>OCP</run-mode>
            <allow-step-into>false</allow-step-into>
          </run-mode-handling>
          <checkpoint>false</checkpoint>
        </meta>
        <location>:call-process[1]</location>
      </call-process>
      <switch>
        <meta>
          <documentation />
          <run-mode-handling>
            <run-mode>OCP</run-mode>
            <allow-step-into>true</allow-step-into>
          </run-mode-handling>
          <checkpoint>false</checkpoint>
        </meta>
        <execute-all-applicable-cases>false</execute-all-applicable-cases>
        <default>
          <sequence />
        </default>
        <case>
          <condition>
            <document>
              <input>
                <from>targetComponent</from>
              </input>
            </document>
            <xpath-expression>
              <xpath-replacement-tokens />
              <xpath><![CDATA[string-length(.)>0]]></xpath>
            </xpath-expression>
          </condition>
          <sequence>
            <call-process>
              <process-name>:BMC_BladeLogic-AD-Operations_Manager:Utilities:Add up to 10 Arguments to List</process-name>
              <parameters>
                <input>
                  <from>targetComponent</from>
                  <to>argument 1</to>
                </input>
                <input>
                  <from>argument list</from>
                  <to>current list</to>
                </input>
                <input>
                  <from>matchFile</from>
                  <to>argument 2</to>
                </input>
                <output>
                  <from>updated list</from>
                  <to>argument list</to>
                </output>
              </parameters>
              <meta>
                <documentation />
                <run-mode-handling>
                  <run-mode>OCP</run-mode>
                  <allow-step-into>false</allow-step-into>
                </run-mode-handling>
                <checkpoint>false</checkpoint>
              </meta>
              <location>:switch[1]:sequence[2]:call-process[1]</location>
            </call-process>
          </sequence>
        </case>
        <location>:switch[1]</location>
      </switch>
      <call-process>
        <process-name>:BMC_BladeLogic-AD-Operations_Manager:Perform BLCLI command</process-name>
        <parameters>
          <input>
            <from>connection details</from>
            <to>connection details</to>
          </input>
          <input>
            <value>BlPackage</value>
            <to>namespace</to>
          </input>
          <input>
            <value>createPackageFromAuditTarget</value>
            <to>command name</to>
          </input>
          <input>
            <from>argument list</from>
            <to>argument list</to>
          </input>
          <output>
            <from>status</from>
            <to>status</to>
          </output>
          <output>
            <from>return values</from>
            <to>return values</to>
            <xpath-expression>
              <xpath-replacement-tokens />
              <xpath><![CDATA[//value/text()]]></xpath>
            </xpath-expression>
          </output>
          <output>
            <from>error message</from>
            <to>error message</to>
          </output>
          <output>
            <from>debug message</from>
            <to>debug message</to>
          </output>
          <output>
            <from>output</from>
            <to>output</to>
          </output>
          <output>
            <from>script lines</from>
            <to>script lines</to>
          </output>
        </parameters>
        <meta>
          <documentation />
          <run-mode-handling>
            <run-mode>OCP</run-mode>
            <allow-step-into>false</allow-step-into>
          </run-mode-handling>
          <checkpoint>false</checkpoint>
        </meta>
        <location>:call-process[2]</location>
      </call-process>
    </sequence>
    <meta>
      <expose-to>
        <consumer>RULE</consumer>
        <consumer>SCHEDULE</consumer>
      </expose-to>
      <documentation>
        <description>Case 1:
This command creates a BLPackage based on all the information collected from an Audit Job result.
The audit target will be picked from an audit based on the template specified as input to this command. Currently this command cannot be used for audits that have multiple targets for the same template.
Audits can have several templates specified in them. For each template, the audit can have one master and several targets. Currently this command allows packaging audit results for only one target of one template.
This command returns a handle to the newly created package and can be used as input to commands that need a handle to the package.

Case 2:
This command creates a BLPackage based on all the information collected from an Audit Job result.

The audit target will be picked from an audit based on the template specified as input to this command with the matched target component name. If you do not provide a target component name, this command fails if the audit result has multiple targets for the same template.

If there is software in the audit result needed to match to depot software, the command will try to find the match specifed in the match mapping file. If the command cannot find it, or you did not provide a software matching file, the command will try matching to default depot software. If the command cannot find default depot software, it skips the software.

The software matching file is a comma seperated text file, where each line contains a software name followed by the depot software DBKey. (To get the DBKey of depot software, you can use the Depot Object : getDBKeyByTypeStringGroupAndName command.)
Here is a sample line from a software matching file:
"AdventNet SNMP Utilities 4","DBKey:SDepotObjectKey:3-1"
Audits can have several templates specified in them. For each template, the audit can have one master and several targets.
This command returns a handle to the newly created package and can be used as input to commands that need a handle to the package.</description>
        <version></version>
      </documentation>
      <peer-location>
        <location>any</location>
      </peer-location>
      <record-metrics>false</record-metrics>
      <process-id>dfe76c85-7990-337e-a821-a0658a60f666</process-id>
      <author />
      <category />
      <status />
      <keywords />
      <systems />
      <last-modified-by />
      <last-modified>1283179762832</last-modified>
    </meta>
  </process-def>
</process>