<process draft="false" dev-studio-version="20.02.00">
  <process-def name=":AO-AD-Amazon_EC2_REST:Adapter_Actions:v1.0:Amazon_Machine_Image_Operations:Create Image">
    <parameters>
      <input global="false" required="false">
        <description>adapter name    [Optional]
            The name of the adapter use to handle the request.

Default value: AmazonEC2RESTActorAdapter</description>
        <from>adapter name</from>
        <to>adapter name</to>
      </input>
      <input global="false" required="false">
        <description>access key    [Optional]
	The AWS access key.</description>
        <from>access key</from>
        <to>access key</to>
      </input>
      <input global="false" required="false">
        <description>secret key    [Optional]
	The AWS secret access key.</description>
        <from>secret key</from>
        <to>secret key</to>
      </input>
      <input global="false" required="false">
        <description>session token [Optional] : The AWS session token which is generally created for temporary access to users for role based authorization.

Please Note: The temporary access key , secret key and session token to be generated by the user to provide in adapter request.

Please refer below AWS docs for more details

https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp_request.html  

https://docs.aws.amazon.com/cli/latest/reference/sts/assume-role.html
</description>
        <from>session token</from>
        <to>session token</to>
      </input>
      <input global="false" required="false">
        <description>region    [Optional]
		 The region to communicate with.</description>
        <from>region</from>
        <to>region</to>
      </input>
      <input global="false" required="true">
        <description>instance id [Mandatory]

The ID of the instance.</description>
        <from>instance id</from>
        <to>instance id</to>
      </input>
      <input global="false" required="true">
        <description>name [Mandatory]

The name of the AMI</description>
        <from>name</from>
        <to>name</to>
      </input>
      <input global="false" required="false">
        <description>description [Optional]

The description of the AMI</description>
        <from>description</from>
        <to>description</to>
      </input>
      <input global="false" required="false">
        <description>no reboot [Optional]

Type: xsd:boolean

By default this property is set to false, which means Amazon EC2 attempts to cleanly shut down the instance before image creation and reboots the instance afterwards. When set to true, Amazon EC2 does not shut down the instance before creating the image. When this option is used, file system integrity on the created
image cannot be guaranteed.</description>
        <from>no reboot</from>
        <to>no reboot</to>
      </input>
      <input global="false" required="false">
        <description>block device mapping [Optional]

The block device mapping for the instance. This argument is passed in the form of &lt;devicename&gt;=&lt;blockdevice&gt;. The devicename is the device name of the physical device on the instance to map. The blockdevice can be one of the following values:

    - Suppresses an existing mapping of the device from the AMI used to launch the instance (device=none). Specified by using the &lt;no-device&gt; element.

    - An instance store volume (ephemeral[0..3]) to be mapped to the device. Specified by using the &lt;virtual-name&gt; element.

    - An Amazon EBS volume to be mapped to the device. Specified by using the &lt;ebs&gt; element.

Following is the description of all elements in a block device mapping:

device-name - The device name of the physical device on the instance to map  (e.g., /dev/sdh). 
virtual-name - An instance store volume (ephemeral[0..3]) to be mapped to the device.
ebs - Specifies parameters used to automatically setup Amazon EBS volumes when the instance is launched.
snapshot-id - To create a volume from a snapshot, specify the snapshot ID.
volume-size - To create an empty Amazon EBS volume, omit the snapshot ID and specify a volume size instead.
volume-type - The type of the volume. Valid values: 'standard' and 'io1'.
iops - To create a Provisioned IOPS volume, specify io1. The default volume type is standard. If the volume type is io1, you can also provision the number of IOPS that the volume supports.
delete-on-termination - Specifies whether the Amazon EBS volume is deleted on instance termination.
no-device - Specifies the device name to suppress during instance launch.


&lt;block-device-mapping&gt;
    &lt;!--Zero or more repetition--&gt;
    &lt;item&gt;
        &lt;device-name&gt;&lt;/device-name&gt;
        &lt;!--You have a CHOICE of the next 3 items at this level--&gt;
        &lt;virtual-name&gt;&lt;/virtual-name&gt;
        &lt;ebs&gt;
            &lt;!--Optional:--&gt;
            &lt;snapshot-id&gt;&lt;/snapshot-id&gt;
            &lt;!--Optional:--&gt;
            &lt;volume-size&gt;&lt;/volume-size&gt;
		 &lt;!--Optional:--&gt;
            &lt;volume-type&gt;&lt;/volume-type&gt;
		 &lt;!--Optional:--&gt;
            &lt;iops&gt;&lt;/iops&gt;
            &lt;!--Optional:--&gt;
            &lt;delete-on-termination&gt;&lt;/delete-on-termination&gt;
        &lt;/ebs&gt;
        &lt;no-device/&gt;
    &lt;/item&gt;
&lt;/block-device-mapping&gt;</description>
        <from>block device mapping</from>
        <to>block device mapping</to>
      </input>
      <output global="false" required="false">
        <description>The adapter response containing the results. </description>
        <to>adapter response</to>
        <from>adapter response</from>
      </output>
    </parameters>
    <access />
    <sequence>
      <call-process>
        <process-name>:AO-AD-Amazon_EC2_REST:Utilities:Amazon_Machine_Image_Operations:Construct Request for Create Image</process-name>
        <parameters>
          <input>
            <from>access key</from>
            <to>access key</to>
          </input>
          <input>
            <from>secret key</from>
            <to>secret key</to>
          </input>
          <input>
            <from>session token</from>
            <to>session token</to>
          </input>
          <input>
            <from>region</from>
            <to>region</to>
          </input>
          <input>
            <from>instance id</from>
            <to>instance id</to>
          </input>
          <input>
            <from>name</from>
            <to>name</to>
          </input>
          <input>
            <from>description</from>
            <to>description</to>
          </input>
          <input>
            <from>no reboot</from>
            <to>no reboot</to>
          </input>
          <input>
            <from>block device mapping</from>
            <to>block device mapping</to>
          </input>
          <output>
            <from>adapter request</from>
            <to>adapter request</to>
          </output>
        </parameters>
        <meta>
          <documentation />
          <run-mode-handling>
            <run-mode>OCP</run-mode>
            <allow-step-into>false</allow-step-into>
          </run-mode-handling>
          <checkpoint>false</checkpoint>
        </meta>
        <location>:call-process[1]</location>
      </call-process>
      <call-process>
        <process-name>:AO-AD-Amazon_EC2_REST:Utilities:Call Amazon EC2 Adapter</process-name>
        <unique-id>9059c308-39fc-3695-a5b3-24f374d1da7b</unique-id>
        <parameters>
          <input>
            <from>adapter name</from>
            <to>adapter name</to>
          </input>
          <input>
            <from>adapter request</from>
            <to>adapter request</to>
          </input>
          <output>
            <from>adapter response</from>
            <to>adapter response</to>
          </output>
        </parameters>
        <meta>
          <documentation />
          <run-mode-handling>
            <run-mode>OCP</run-mode>
            <allow-step-into>false</allow-step-into>
          </run-mode-handling>
          <checkpoint>false</checkpoint>
        </meta>
        <location>:call-process[2]</location>
      </call-process>
    </sequence>
    <meta>
      <expose-to>
        <consumer>RULE</consumer>
        <consumer>SCHEDULE</consumer>
      </expose-to>
      <documentation>
        <description>Creates an AMI that uses an Amazon EBS root device from a "running" or "stopped" instance.</description>
        <version>1.0</version>
      </documentation>
      <logging-options>
        <is-enabled>false</is-enabled>
        <log-file-name></log-file-name>
      </logging-options>
      <peer-location>
        <location>any</location>
      </peer-location>
      <record-metrics>false</record-metrics>
      <process-id>f2d4e3a9-7fe3-34fa-8550-9dbb6e64ef25</process-id>
      <author>admin</author>
      <category></category>
      <status></status>
      <keywords></keywords>
      <systems></systems>
      <last-modified-by>aoadmin</last-modified-by>
      <last-modified>1609914951037</last-modified>
    </meta>
  </process-def>
</process>