<process draft="false" dev-studio-version="20.02.00">
  <process-def name=":AO-AD-Amazon_EC2_REST:Utilities:Amazon_Machine_Image_Operations:Construct Request for Register Image">
    <parameters>
      <input global="false" required="false">
        <description>access key    [Optional]
	The AWS access key.</description>
        <from>access key</from>
        <to>access key</to>
      </input>
      <input global="false" required="false">
        <description>secret key    [Optional]
	The AWS secret access key.</description>
        <from>secret key</from>
        <to>secret key</to>
      </input>
      <input global="false" required="false">
        <description>session token [Optional] : The AWS session token which is generally created for temporary access to users for role based authorization.

Please Note: The temporary access key , secret key and session token to be generated by the user to provide in adapter request.

Please refer below AWS docs for more details

https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp_request.html  

https://docs.aws.amazon.com/cli/latest/reference/sts/assume-role.html
</description>
        <from>session token</from>
        <to>session token</to>
      </input>
      <input global="false" required="false">
        <description>region    [Optional]
		 The region to communicate with.</description>
        <from>region</from>
        <to>region</to>
      </input>
      <input global="false" required="false">
        <description>image location [Conditional]

Full path to your AMI manifest in Amazon S3 storage.

- Required if registering an instance store-backed AMI</description>
        <from>image location</from>
        <to>image location</to>
      </input>
      <input global="false" required="true">
        <description>name [Mandatory]

The name of the AMI that was provided during image creation</description>
        <from>name</from>
        <to>name</to>
      </input>
      <input global="false" required="false">
        <description>description [Optional]

The description of the AMI</description>
        <from>description</from>
        <to>description</to>
      </input>
      <input global="false" required="false">
        <description>architecture [Optional]

The architecture of the image.

Valid Values: i386, x86_64</description>
        <from>architecture</from>
        <to>architecture</to>
      </input>
      <input global="false" required="false">
        <description>kernel id [Optional]

The ID of the kernel to select.</description>
        <from>kernel id</from>
        <to>kernel id</to>
      </input>
      <input global="false" required="false">
        <description>ramdisk id [Optional]

The ID of the RAM disk to select. </description>
        <from>ramdisk id</from>
        <to>ramdisk id</to>
      </input>
      <input global="false" required="false">
        <description>root device name [Optional]

The root device name (e.g., /dev/sda1).</description>
        <from>root device name</from>
        <to>root device name</to>
      </input>
      <input global="false" required="false">
        <description>block device mapping [Optional]

Specifies how block devices are exposed to the instance. Each mapping is made up of a virtualName
and a deviceName.

device-name - The device name (e.g., /dev/sdh)
virtual-name - The virtual device name
ebs - Specifies parameters used to automatically setup Amazon EBS volumes when the instance is launched.
snapshot-id - The ID of the snapshot
volume-size - The size of the volume
volume-type - The type of the volume. Valid values: 'standard' and 'io1'.
iops - An integer value for the Iops property for this storage object.
delete-on-termination - Specifies whether the Amazon EBS volume is deleted on instance termination.
no-device - Specifies the device name to suppress during instance launch.

&lt;block-device-mapping&gt;
    &lt;!--Zero or more repetition--&gt;
    &lt;item&gt;
        &lt;device-name&gt;&lt;/device-name&gt;
        &lt;!--You have a CHOICE of the next 3 items at this level--&gt;
        &lt;virtual-name&gt;&lt;/virtual-name&gt;
        &lt;ebs&gt;
            &lt;!--Optional:--&gt;
            &lt;snapshot-id&gt;&lt;/snapshot-id&gt;
            &lt;!--Optional:--&gt;
            &lt;volume-size&gt;&lt;/volume-size&gt;
		 &lt;!--Optional:--&gt;
            &lt;volume-type&gt;&lt;/volume-type&gt;
		 &lt;!--Optional:--&gt;
            &lt;iops&gt;&lt;/iops&gt;
            &lt;!--Optional:--&gt;
            &lt;delete-on-termination&gt;&lt;/delete-on-termination&gt;
        &lt;/ebs&gt;
        &lt;no-device/&gt;
    &lt;/item&gt;
&lt;/block-device-mapping&gt;</description>
        <from>block device mapping</from>
        <to>block device mapping</to>
      </input>
      <output global="false" required="false">
        <to>adapter request</to>
        <from>adapter request</from>
      </output>
    </parameters>
    <access />
    <sequence>
      <assign>
        <assignment>
          <output>
            <to>adapter request</to>
            <value>
              <empty />
            </value>
          </output>
          <xslt-stylesheet>
            <stylesheet-replacement-tokens>
              <replacement-token name="access key">
                <input global="false">
                  <from>access key</from>
                </input>
              </replacement-token>
              <replacement-token name="secret key">
                <input global="false">
                  <from>secret key</from>
                </input>
              </replacement-token>
              <replacement-token name="image location">
                <input global="false">
                  <from>image location</from>
                </input>
              </replacement-token>
              <replacement-token name="name">
                <input global="false">
                  <from>name</from>
                </input>
              </replacement-token>
              <replacement-token name="description">
                <input global="false">
                  <from>description</from>
                </input>
              </replacement-token>
              <replacement-token name="architecture">
                <input global="false">
                  <from>architecture</from>
                </input>
              </replacement-token>
              <replacement-token name="kernel id">
                <input global="false">
                  <from>kernel id</from>
                </input>
              </replacement-token>
              <replacement-token name="ramdisk id">
                <input global="false">
                  <from>ramdisk id</from>
                </input>
              </replacement-token>
              <replacement-token name="root device name">
                <input global="false">
                  <from>root device name</from>
                </input>
              </replacement-token>
              <replacement-token name="block device mapping">
                <input global="false">
                  <from>block device mapping</from>
                </input>
              </replacement-token>
              <replacement-token name="region">
                <input global="false">
                  <from>region</from>
                </input>
              </replacement-token>
              <replacement-token name="session token">
                <input global="false">
                  <from>session token</from>
                </input>
              </replacement-token>
            </stylesheet-replacement-tokens>
            <stylesheet><![CDATA[<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
  <xsl:output indent="yes" />
  <xsl:template match="/">
    <request-data>
      <amazon-ec2-rest-request>
        <xsl:if test="string-length('${access key}')&gt;0">
          <access-key>${access key}</access-key>
        </xsl:if>
        <xsl:if test="string-length('${secret key}')&gt;0">
          <secret-key>${secret key}</secret-key>
        </xsl:if>
        <xsl:if test="string-length('${session token}')&gt;0  and string-length('${secret key}')&gt;0 and string-length('${access key}')&gt;0">
          <session-token>${session token}</session-token>
        </xsl:if>
        <operation-name>
          <xsl:text disable-output-escaping="no">register-image</xsl:text>
        </operation-name>
        <xsl:if test="string-length('${region}')&gt;0">
          <region>${region}</region>
        </xsl:if>
        <parameters>
          <image-location>${image location}</image-location>
          <xsl:if test="string-length('${name}')&gt;0">
            <name>${name}</name>
          </xsl:if>
          <xsl:if test="string-length('${description}')&gt;0">
            <description>${description}</description>
          </xsl:if>
          <xsl:if test="string-length('${architecture}')&gt;0">
            <architecture>${architecture}</architecture>
          </xsl:if>
          <xsl:if test="string-length('${kernel id}')&gt;0">
            <kernel-id>${kernel id}</kernel-id>
          </xsl:if>
          <xsl:if test="string-length('${ramdisk id}')&gt;0">
            <ramdisk-id>${ramdisk id}</ramdisk-id>
          </xsl:if>
          <xsl:if test="string-length('${root device name}')&gt;0">
            <root-device-name>${root device name}</root-device-name>
          </xsl:if>
          ${block device mapping}
        </parameters>
      </amazon-ec2-rest-request>
    </request-data>
  </xsl:template>
</xsl:stylesheet>]]></stylesheet>
          </xslt-stylesheet>
        </assignment>
        <meta>
          <documentation />
          <checkpoint>false</checkpoint>
        </meta>
        <location>:assign[1]</location>
      </assign>
    </sequence>
    <meta>
      <expose-to>
        <consumer>RULE</consumer>
        <consumer>SCHEDULE</consumer>
      </expose-to>
      <documentation>
        <description>Registers an AMI with Amazon EC2. Images must be registered before they can be launched.Each AMI is associated with an unique ID which is provided by the Amazon EC2 service through this
operation. If needed, you can deregister an AMI at any time.</description>
        <version>1.0</version>
      </documentation>
      <logging-options>
        <is-enabled>false</is-enabled>
        <log-file-name></log-file-name>
      </logging-options>
      <peer-location>
        <location>any</location>
      </peer-location>
      <record-metrics>false</record-metrics>
      <process-id>f6f79d87-2336-3e3e-a18b-0865c5e3edd6</process-id>
      <author>admin</author>
      <category></category>
      <status></status>
      <keywords></keywords>
      <systems></systems>
      <last-modified-by>aoadmin</last-modified-by>
      <last-modified>1609917314346</last-modified>
    </meta>
  </process-def>
</process>