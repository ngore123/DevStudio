<process draft="false" dev-studio-version="20.02.00">
  <process-def name=":AO-AD-Amazon_EC2_REST:Utilities:Instance_Operations:Construct Request for Run Instances">
    <parameters>
      <input global="false" required="false">
        <description>access key    [Optional]
	The AWS access key.</description>
        <from>access key</from>
        <to>access key</to>
      </input>
      <input global="false" required="false">
        <description>secret key    [Optional]
	The AWS secret access key.</description>
        <from>secret key</from>
        <to>secret key</to>
      </input>
      <input global="false" required="false">
        <description>session token [Optional] : The AWS session token which is generally created for temporary access to users for role based authorization.

Please Note: The temporary access key , secret key and session token to be generated by the user to provide in adapter request.

Please refer below AWS docs for more details

https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp_request.html  

https://docs.aws.amazon.com/cli/latest/reference/sts/assume-role.html
</description>
        <from>session token</from>
        <to>session token</to>
      </input>
      <input global="false" required="false">
        <description>region    [Optional]
		 The region to communicate with.</description>
        <from>region</from>
        <to>region</to>
      </input>
      <input global="false" required="true">
        <description>image id [Mandatory]

Unique ID of a machine image</description>
        <from>image id</from>
        <to>image id</to>
      </input>
      <input global="false" required="true">
        <description>min count [Mandatory]

Minimum number of instances to launch. If the value is more than Amazon EC2 can launch, no instances are
launched at all.
Constraints: Between 1 and the maximum numberallowed for your account (default: 20).</description>
        <from>min count</from>
        <to>min count</to>
      </input>
      <input global="false" required="true">
        <description>max count [Mandatory]

Maximum number of instances to launch. If the value is more than Amazon EC2 can launch, the largest possible
number above minCount will be launched instead.

Constraints: Between 1 and the maximum number allowed for your account (default: 20).</description>
        <from>max count</from>
        <to>max count</to>
      </input>
      <input global="false" required="false">
        <description>key name [Optional]

The name of the key pair.</description>
        <from>key name</from>
        <to>key name</to>
      </input>
      <input global="false" required="false">
        <description>group set [Optional]

Group Set containing security group(s)

&lt;group-set&gt;
    &lt;!--Zero or more repetition--&gt;
    &lt;item&gt;
        &lt;group-id&gt;Test Group&lt;/group-id&gt;
    &lt;/item&gt;
&lt;/group-set&gt;
</description>
        <from>group set</from>
        <to>group set</to>
      </input>
      <input global="false" required="false">
        <description>additional info [Optional]

Specifies additional information to make available to the instance(s).</description>
        <from>additional info</from>
        <to>additional info</to>
      </input>
      <input global="false" required="false">
        <description>user data [Optional]

User data to be made available to the instance
</description>
        <from>user data</from>
        <to>user data</to>
      </input>
      <input global="false" required="false">
        <description>instance type [Optional]

Specifies the instance type.

Valid Values: m1.small, m1.large, m1.xlarge, c1.medium, c1.xlarge, m2.2xlarge, m2.4xlarge
Default: m1.small </description>
        <from>instance type</from>
        <to>instance type</to>
      </input>
      <input global="false" required="false">
        <description>availability zone [Optional]

Specifies the placement constraints (Availability Zones) for launching the instances.

Sample Value: us-east-1a</description>
        <from>availability zone</from>
        <to>availability zone</to>
      </input>
      <input global="false" required="false">
        <description>kernel id [Optional]

The ID of the kernel with which to launch the instance.</description>
        <from>kernel id</from>
        <to>kernel id</to>
      </input>
      <input global="false" required="false">
        <description>ramdisk id [Optional]

The ID of the RAM disk with which to launch the instance. Some kernels require additional drivers at launch. Check the kernel requirements for information on whether you need to specify a RAM disk. To find kernel requirements, go to the Resource Center and search for the kernel ID.</description>
        <from>ramdisk id</from>
        <to>ramdisk id</to>
      </input>
      <input global="false" required="false">
        <description>block device mapping [Optional]

Specifies how block devices are exposed to the instance. Each mapping is made up of a virtualName
and a deviceName.

device-name - The device name (e.g., /dev/sdh)
virtual-name - The virtual device name
ebs - Specifies parameters used to automatically setup Amazon EBS volumes when the instance is launched.
snapshot-id - The ID of the snapshot
volume-size - The size of the volume
volume-type - the type of the volume. valid values - standard and io1
iops - An integer value for the Iops property for this storage object.
delete-on-termination - Specifies whether the Amazon EBS volume is deleted on instance termination.
no-device - Specifies the device name to suppress during instance launch.

&lt;block-device-mapping&gt;
    &lt;!--Zero or more repetition--&gt;
    &lt;item&gt;
        &lt;device-name&gt;&lt;/device-name&gt;
        &lt;!--You have a CHOICE of the next 3 items at this level--&gt;
        &lt;virtual-name&gt;&lt;/virtual-name&gt;
        &lt;ebs&gt;
            &lt;!--Optional:--&gt;
            &lt;snapshot-id&gt;&lt;/snapshot-id&gt;
            &lt;!--Optional:--&gt;
            &lt;volume-size&gt;&lt;/volume-size&gt;
		 &lt;!--Optional:--&gt;
		 &lt;volume-type&gt;&lt;/volume-type&gt;
		 &lt;!--Optional:--&gt;
		 &lt;iops&gt;&lt;/iops&gt;
            &lt;!--Optional:--&gt;
            &lt;delete-on-termination&gt;&lt;/delete-on-termination&gt;
        &lt;/ebs&gt;
        &lt;no-device/&gt;
    &lt;/item&gt;
&lt;/block-device-mapping&gt;
</description>
        <from>block device mapping</from>
        <to>block device mapping</to>
      </input>
      <input global="false" required="false">
        <description>monitoring [Optional]

Specifies whether to enable monitoring for the instance.

Valid values:
true, false</description>
        <from>monitoring</from>
        <to>monitoring</to>
      </input>
      <input global="false" required="false">
        <description>subnet id [Optional]

Specifies the Amazon VPC subnet ID within which to launch the instance(s) for Amazon Virtual Private Cloud.</description>
        <from>subnet id</from>
        <to>subnet id</to>
      </input>
      <input global="false" required="false">
        <description>instance initiated shutdown behavior [Optional]

Specifies whether the instance's Amazon EBS volumes are stopped or terminated when the instance is shut down.

Valid Values: stop , terminate </description>
        <from>instance initiated shutdown behavior</from>
        <to>instance initiated shutdown behavior</to>
      </input>
      <input global="false" required="false">
        <description>The private IP address to be assigned to the new instance [Optional]
</description>
        <from>private ip address</from>
        <to>private ip address</to>
      </input>
      <output global="false" required="false">
        <to>adapter request</to>
        <from>adapter request</from>
      </output>
    </parameters>
    <access />
    <sequence>
      <assign>
        <assignment>
          <output>
            <to>adapter request</to>
            <value>
              <empty />
            </value>
          </output>
          <xslt-stylesheet>
            <stylesheet-replacement-tokens>
              <replacement-token name="access key">
                <input global="false">
                  <from>access key</from>
                </input>
              </replacement-token>
              <replacement-token name="secret key">
                <input global="false">
                  <from>secret key</from>
                </input>
              </replacement-token>
              <replacement-token name="image id">
                <input global="false">
                  <from>image id</from>
                </input>
              </replacement-token>
              <replacement-token name="min count">
                <input global="false">
                  <from>min count</from>
                </input>
              </replacement-token>
              <replacement-token name="max count">
                <input global="false">
                  <from>max count</from>
                </input>
              </replacement-token>
              <replacement-token name="key name">
                <input global="false">
                  <from>key name</from>
                </input>
              </replacement-token>
              <replacement-token name="group set">
                <input global="false">
                  <from>group set</from>
                </input>
              </replacement-token>
              <replacement-token name="additional info">
                <input global="false">
                  <from>additional info</from>
                </input>
              </replacement-token>
              <replacement-token name="user data">
                <input global="false">
                  <from>user data</from>
                </input>
              </replacement-token>
              <replacement-token name="instance type">
                <input global="false">
                  <from>instance type</from>
                </input>
              </replacement-token>
              <replacement-token name="kernel id">
                <input global="false">
                  <from>kernel id</from>
                </input>
              </replacement-token>
              <replacement-token name="ramdisk id">
                <input global="false">
                  <from>ramdisk id</from>
                </input>
              </replacement-token>
              <replacement-token name="block device mapping">
                <input global="false">
                  <from>block device mapping</from>
                </input>
              </replacement-token>
              <replacement-token name="monitoring">
                <input global="false">
                  <from>monitoring</from>
                </input>
              </replacement-token>
              <replacement-token name="subnet id">
                <input global="false">
                  <from>subnet id</from>
                </input>
              </replacement-token>
              <replacement-token name="instance initiated shutdown behavior">
                <input global="false">
                  <from>instance initiated shutdown behavior</from>
                </input>
              </replacement-token>
              <replacement-token name="availability zone">
                <input global="false">
                  <from>availability zone</from>
                </input>
              </replacement-token>
              <replacement-token name="private ip">
                <input global="false">
                  <from>private ip address</from>
                </input>
              </replacement-token>
              <replacement-token name="region">
                <input global="false">
                  <from>region</from>
                </input>
              </replacement-token>
              <replacement-token name="session token">
                <input global="false">
                  <from>session token</from>
                </input>
              </replacement-token>
            </stylesheet-replacement-tokens>
            <stylesheet><![CDATA[<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
  <xsl:output indent="yes" />
  <xsl:template match="/">
    <request-data>
      <amazon-ec2-rest-request>
        <xsl:if test="string-length('${access key}')&gt;0">
          <access-key>${access key}</access-key>
        </xsl:if>
        <xsl:if test="string-length('${secret key}')&gt;0">
          <secret-key>${secret key}</secret-key>
        </xsl:if>
        <xsl:if test="string-length('${session token}')&gt;0  and string-length('${secret key}')&gt;0 and string-length('${access key}')&gt;0">
          <session-token>${session token}</session-token>
        </xsl:if>
        <operation-name>
          <xsl:text disable-output-escaping="no">run-instances</xsl:text>
        </operation-name>
        <xsl:if test="string-length('${region}')&gt;0">
          <region>${region}</region>
        </xsl:if>
        <parameters>
          <image-id>${image id}</image-id>
          <min-count>${min count}</min-count>
          <max-count>${max count}</max-count>
          <xsl:if test="string-length('${key name}')&gt;0">
            <key-name>${key name}</key-name>
          </xsl:if>
          ${group set}
          <additional-info>$[additional info]</additional-info>
          <user-data>
            <data>$[user data]</data>
          </user-data>
          <xsl:if test="string-length('${instance type}')&gt;0">
            <instance-type>${instance type}</instance-type>
          </xsl:if>
          <xsl:if test="string-length('${availability zone}')&gt;0">
            <placement>
              <availability-zone>${availability zone}</availability-zone>
            </placement>
          </xsl:if>
          <xsl:if test="string-length('${kernel id}')&gt;0">
            <kernel-id>${kernel id}</kernel-id>
          </xsl:if>
          <xsl:if test="string-length('${ramdisk id}')&gt;0">
            <ramdisk-id>${ramdisk id}</ramdisk-id>
          </xsl:if>
          ${block device mapping}
          <xsl:if test="string-length('${monitoring}')&gt;0">
            <monitoring>
              <enabled>${monitoring}</enabled>
            </monitoring>
          </xsl:if>
          <xsl:if test="string-length('${subnet id}')&gt;0">
            <subnet-id>${subnet id}</subnet-id>
          </xsl:if>
          <xsl:if test="string-length('${instance initiated shutdown behavior}')&gt;0">
            <instance-initiated-shutdown-behavior>${instance initiated shutdown behavior}</instance-initiated-shutdown-behavior>
          </xsl:if>
          <xsl:if test="string-length('${private ip}')&gt;0">
            <private-ip-address>${private ip}</private-ip-address>
          </xsl:if>
        </parameters>
      </amazon-ec2-rest-request>
    </request-data>
  </xsl:template>
</xsl:stylesheet>]]></stylesheet>
          </xslt-stylesheet>
        </assignment>
        <meta>
          <documentation />
          <checkpoint>false</checkpoint>
        </meta>
        <location>:assign[1]</location>
      </assign>
    </sequence>
    <meta>
      <expose-to>
        <consumer>RULE</consumer>
        <consumer>SCHEDULE</consumer>
      </expose-to>
      <documentation>
        <description>Launches a specified number of instances of an AMI for which you have permissions.

If Amazon EC2 cannot launch the minimum number AMIs you request, no instances will be launched.
If there is insufficient capacity to launch the maximum number of AMIs you request, Amazon EC2
launches the minimum number specified for each AMI and allocate the remaining available instances
using round robin.</description>
        <version>1.0</version>
      </documentation>
      <logging-options>
        <is-enabled>false</is-enabled>
        <log-file-name></log-file-name>
      </logging-options>
      <peer-location>
        <location>any</location>
      </peer-location>
      <record-metrics>false</record-metrics>
      <process-id>75cda76b-bad0-332e-9935-c1312c032910</process-id>
      <author>admin</author>
      <category></category>
      <status></status>
      <keywords></keywords>
      <systems></systems>
      <last-modified-by>aoadmin</last-modified-by>
      <last-modified>1609917144151</last-modified>
    </meta>
  </process-def>
</process>