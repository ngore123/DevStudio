<process draft="false" dev-studio-version="8.2.00">
  <process-def name=":BMC-AD-Kafka:Send Messages">
    <parameters>
      <input global="false" required="false">
        <description>If no value is provided, a default value KafkaActorAdapter is used.</description>
        <from>adapter name</from>
        <to>adapter name</to>
      </input>
      <input global="false" required="false">
        <description>Location where Kafka broker is located.

Format: hostname:port or IPaddress:port

If none provided, it will try to use the provided in the adapter configuration.

This input parameter will be used to set connection property called bootstrap.servers as defined here: https://kafka.apache.org/documentation/#producerconfigs

NOTE: Do not set/provide bootstrap.servers property in the 'connection properties' input parameter.</description>
        <from>url</from>
        <to>url</to>
      </input>
      <input global="false" required="false">
        <description>Used only when url is present in the request. Topic where the message is sent. If no value is provided, value provided in the adapter configuratoin will be used.</description>
        <from>topic</from>
        <to>topic</to>
      </input>
      <input global="false" required="false">
        <description>Used only when 'topic' input parameter is provided.

Parition number to be used.
 
1. If topic is present and patition is present, value set is used.
2. If topic is present but partition is NOT present, a value of 0 is set.
3. If topic is not present, but partition is present, the value will be reset to empty and value provided in adapter configuration will be used.
4. If topic is not present, but partition is not prenet, the value will be reset to empty  and value provided in adapter configuration will be used.</description>
        <from>partition</from>
        <to>partition</to>
      </input>
      <input global="false" required="false">
        <description>Used only  if url input parameter is non-empty. Otherwise, values specified in adapter configuration is used.

Format is:

&lt;connection-properties&gt;
   &lt;property-1&gt;value1&lt;/property-1&gt;
   &lt;property-2&gt;value2&lt;/property-2&gt;
    .
    .
    .
&lt;/connection-properties&gt;

property-1, property-2 is as defined here: https://kafka.apache.org/22/documentation.html#producerconfigs

If url input parameter is present and if 'connection properties' is empty, then, a default set of connection properties will be sent to the adapter as below:

    &lt;connection-properties&gt;
       &lt;acks&gt;all&lt;/acks&gt;
       &lt;key.serializer&gt;org.apache.kafka.common.serialization.StringSerializer&lt;/key.serializer&gt;
       &lt;value.serializer&gt;org.apache.kafka.common.serialization.StringSerializer&lt;/value.serializer&gt;
     &lt;/connection-properties&gt;



All properties defined in the document may not be supported. Some of the properties may not be supported because the application has not been configured to facilitate it, like for example: sasl.kerberos.service.name

bootstrap.servers shall not be specified here, because it is the same as the url input parameter.</description>
        <from>connection properties</from>
        <to>connection properties</to>
      </input>
      <input global="false" required="true">
        <description>Message(s) to be sent. At least one entry should be present

&lt;entries&gt;
      &lt;entry&gt;
         &lt;key&gt;request1&lt;/key&gt;
         &lt;value&gt;Hello World!&lt;/value&gt;
      &lt;/entry&gt;
      &lt;entry&gt;
         &lt;key&gt;request2&lt;/key&gt;
         &lt;value&gt;Hello Universe!&lt;/value&gt;
      &lt;/entry&gt;
 &lt;/entries&gt;</description>
        <from>messages</from>
        <to>messages</to>
      </input>
      <output global="false" required="false">
        <to>adapter response</to>
        <from>adapter response</from>
      </output>
      <output global="false" required="false">
        <to>status</to>
        <from>status</from>
      </output>
      <output global="false" required="false">
        <to>error message</to>
        <from>error message</from>
      </output>
    </parameters>
    <access />
    <sequence>
      <assign>
        <assignment>
          <input global="true">
            <configuration>:BMC-AD-Kafka:Defaults</configuration>
          </input>
          <output>
            <to>default configuration</to>
          </output>
        </assignment>
        <assignment>
          <document>
            <input>
              <from>default configuration</from>
            </input>
          </document>
          <result>
            <output>
              <to>adapter name</to>
            </output>
          </result>
          <xslt-stylesheet>
            <stylesheet-replacement-tokens>
              <replacement-token name="adapter name">
                <input global="false">
                  <from>adapter name</from>
                </input>
              </replacement-token>
            </stylesheet-replacement-tokens>
            <stylesheet><![CDATA[<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
  <xsl:output indent="no" />
  <xsl:template match="/">
    <value>
      <xsl:choose>
        <xsl:when test="string-length(normalize-space('${adapter name}')) &gt; 0">${adapter name}</xsl:when>
        <xsl:otherwise>
          <xsl:value-of select="//DefaultAdapterName/text()" disable-output-escaping="no" />
        </xsl:otherwise>
      </xsl:choose>
    </value>
  </xsl:template>
</xsl:stylesheet>]]></stylesheet>
          </xslt-stylesheet>
        </assignment>
        <assignment>
          <document>
            <input>
              <from>default configuration</from>
            </input>
          </document>
          <result>
            <output>
              <to>connection properties</to>
            </output>
          </result>
          <xslt-stylesheet>
            <stylesheet-replacement-tokens>
              <replacement-token name="connection properties">
                <input global="false">
                  <from>connection properties</from>
                </input>
              </replacement-token>
              <replacement-token name="url">
                <input global="false">
                  <from>url</from>
                </input>
              </replacement-token>
            </stylesheet-replacement-tokens>
            <stylesheet><![CDATA[<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
  <xsl:output indent="no" />
  <xsl:variable name="inputConnectionProperties">${connection properties}</xsl:variable>
  <xsl:template match="/">
    <xsl:choose>
      <xsl:when test="string-length(normalize-space('${url}')) &gt; 0">
        <xsl:choose>
          <xsl:when test="string-length(normalize-space('$[connection properties]')) = 0">
            <xsl:comment>Use default connection properties</xsl:comment>
            <xsl:copy-of select="//connection-properties" />
          </xsl:when>
          <xsl:otherwise>
            <xsl:choose>
              <xsl:when test="starts-with('$[connection properties]', normalize-space('&lt;connection-properties&gt;'))">
                <xsl:comment>Use input connection properties</xsl:comment>
                <xsl:copy-of select="$inputConnectionProperties" />
              </xsl:when>
              <xsl:otherwise>
                <xsl:copy-of select="//connection-properties" />
                <xsl:comment>Use default connection properties</xsl:comment>
              </xsl:otherwise>
            </xsl:choose>
          </xsl:otherwise>
        </xsl:choose>
      </xsl:when>
      <xsl:otherwise>
        <xsl:comment>Unset connection properties because url is not present.</xsl:comment>
        <connection-properties>
          <xsl:text></xsl:text>
        </connection-properties>
      </xsl:otherwise>
    </xsl:choose>
  </xsl:template>
</xsl:stylesheet>]]></stylesheet>
          </xslt-stylesheet>
        </assignment>
        <assignment>
          <document>
            <input>
              <from>url</from>
            </input>
          </document>
          <result>
            <output>
              <to>topic</to>
            </output>
          </result>
          <xslt-stylesheet>
            <stylesheet-replacement-tokens>
              <replacement-token name="topic">
                <input global="false">
                  <from>topic</from>
                </input>
              </replacement-token>
            </stylesheet-replacement-tokens>
            <stylesheet><![CDATA[<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
  <xsl:output indent="no" />
  <xsl:template match="/">
    <value>
      <xsl:choose>
        <xsl:when test="string-length(normalize-space(.)) &gt; 0">${topic}</xsl:when>
        <xsl:otherwise>
          <xsl:text></xsl:text>
        </xsl:otherwise>
      </xsl:choose>
    </value>
  </xsl:template>
</xsl:stylesheet>]]></stylesheet>
          </xslt-stylesheet>
        </assignment>
        <assignment>
          <document>
            <input>
              <from>topic</from>
            </input>
          </document>
          <result>
            <output>
              <to>partition</to>
            </output>
          </result>
          <xslt-stylesheet>
            <stylesheet-replacement-tokens>
              <replacement-token name="partition">
                <input global="false">
                  <from>partition</from>
                </input>
              </replacement-token>
            </stylesheet-replacement-tokens>
            <stylesheet><![CDATA[<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
  <xsl:output indent="no" />
  <xsl:template match="/">
    <value>
      <xsl:choose>
        <xsl:when test="string-length(normalize-space(.)) = 0">
          <xsl:text></xsl:text>
        </xsl:when>
        <xsl:otherwise>
          <xsl:choose>
            <xsl:when test="string-length(normalize-space('${partition}')) &gt; 0">${partition}</xsl:when>
            <xsl:otherwise>
              <xsl:text disable-output-escaping="no">0</xsl:text>
            </xsl:otherwise>
          </xsl:choose>
        </xsl:otherwise>
      </xsl:choose>
    </value>
  </xsl:template>
</xsl:stylesheet>]]></stylesheet>
          </xslt-stylesheet>
        </assignment>
        <assignment>
          <output>
            <to>status</to>
            <value>success</value>
          </output>
        </assignment>
        <assignment>
          <output>
            <to>error message</to>
            <value></value>
          </output>
        </assignment>
        <assignment>
          <output>
            <to>adapter response</to>
            <value></value>
          </output>
        </assignment>
        <meta>
          <documentation />
          <checkpoint>false</checkpoint>
        </meta>
        <after-execution>
          <log>
            <level>debug</level>
            <parameters>
              <input>
                <value>==== inputs====</value>
              </input>
              <input>
                <from>default configuration</from>
              </input>
              <input>
                <value>'</value>
              </input>
              <input>
                <from>adapter name</from>
              </input>
              <input>
                <value>'
</value>
              </input>
              <input>
                <from>connection properties</from>
              </input>
              <input>
                <value>
'</value>
              </input>
              <input>
                <from>url</from>
              </input>
              <input>
                <value>'
'</value>
              </input>
              <input>
                <from>topic</from>
              </input>
              <input>
                <value>'
'</value>
              </input>
              <input>
                <from>partition</from>
              </input>
              <input>
                <value>'</value>
              </input>
            </parameters>
          </log>
        </after-execution>
        <location>:assign[1]</location>
      </assign>
      <switch>
        <meta>
          <documentation />
          <run-mode-handling>
            <run-mode>OCP</run-mode>
            <allow-step-into>true</allow-step-into>
          </run-mode-handling>
          <checkpoint>false</checkpoint>
        </meta>
        <execute-all-applicable-cases>false</execute-all-applicable-cases>
        <default>
          <sequence>
            <assign>
              <assignment>
                <output>
                  <to>status</to>
                  <value>failure</value>
                </output>
              </assignment>
              <assignment>
                <document>
                  <input>
                    <from>messages</from>
                  </input>
                </document>
                <result>
                  <output>
                    <to>error message</to>
                  </output>
                </result>
                <xslt-stylesheet>
                  <stylesheet-replacement-tokens>
                    <replacement-token name="url">
                      <input global="false">
                        <from>url</from>
                      </input>
                    </replacement-token>
                    <replacement-token name="topic">
                      <input global="false">
                        <from>topic</from>
                      </input>
                    </replacement-token>
                  </stylesheet-replacement-tokens>
                  <stylesheet><![CDATA[<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
  <xsl:output indent="no" />
  <xsl:variable name="err1">
    <xsl:if test="string-length(normalize-space('${url}')) &gt; 0 and string-length(normalize-space('${topic}')) = 0">
      <xsl:text disable-output-escaping="no">No topic specified while URL is specified.</xsl:text>
    </xsl:if>
  </xsl:variable>
  <xsl:variable name="err2">
    <xsl:if test="not(boolean(//entry))">
      <xsl:text disable-output-escaping="no">Message is missing entry data.</xsl:text>
    </xsl:if>
  </xsl:variable>
  <xsl:variable name="LF">
    <xsl:text disable-output-escaping="no">
</xsl:text>
  </xsl:variable>
  <xsl:template match="/">
    <value>
      <xsl:choose>
        <xsl:when test="string-length(normalize-space($err1)) &gt; 0 and string-length(normalize-space($err2)) &gt; 0 ">
          <xsl:value-of select="concat($err1, $LF, $err2)" disable-output-escaping="no" />
        </xsl:when>
        <xsl:otherwise>
          <xsl:value-of select="concat($err1, $err2)" disable-output-escaping="no" />
        </xsl:otherwise>
      </xsl:choose>
    </value>
  </xsl:template>
</xsl:stylesheet>]]></stylesheet>
                </xslt-stylesheet>
              </assignment>
              <meta>
                <documentation />
                <checkpoint>false</checkpoint>
              </meta>
              <location>:switch[1]:sequence[1]:assign[1]</location>
            </assign>
          </sequence>
        </default>
        <case applies-if-any-condition-true="false">
          <condition>
            <document>
              <input>
                <from>messages</from>
              </input>
            </document>
            <xpath-expression>
              <xpath-replacement-tokens />
              <xpath><![CDATA[boolean(//entry) ]]></xpath>
            </xpath-expression>
          </condition>
          <condition>
            <document>
              <input>
                <from>url</from>
              </input>
            </document>
            <xpath-expression>
              <xpath-replacement-tokens>
                <replacement-token name="topic">
                  <input global="false">
                    <from>topic</from>
                  </input>
                </replacement-token>
              </xpath-replacement-tokens>
              <xpath><![CDATA[string-length(normalize-space(.)) = 0 or (string-length(normalize-space(.)) > 0 and string-length(normalize-space('${topic}')) > 0)]]></xpath>
            </xpath-expression>
          </condition>
          <sequence>
            <assign>
              <assignment>
                <document>
                  <input>
                    <from>messages</from>
                  </input>
                </document>
                <result>
                  <output>
                    <to>adapter request</to>
                  </output>
                </result>
                <xslt-stylesheet>
                  <stylesheet-replacement-tokens>
                    <replacement-token name="url">
                      <input global="false">
                        <from>url</from>
                      </input>
                    </replacement-token>
                    <replacement-token name="topic">
                      <input global="false">
                        <from>topic</from>
                      </input>
                    </replacement-token>
                    <replacement-token name="partition">
                      <input global="false">
                        <from>partition</from>
                      </input>
                    </replacement-token>
                    <replacement-token name="connection properties">
                      <input global="false">
                        <from>connection properties</from>
                      </input>
                    </replacement-token>
                  </stylesheet-replacement-tokens>
                  <stylesheet><![CDATA[<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
  <xsl:output indent="no" />
  <xsl:variable name="connectionProperties">${connection properties}</xsl:variable>
  <xsl:template match="/">
    <request-data>
      <kafka-adapter-request>
        <xsl:choose>
          <xsl:when test="string-length(normalize-space('${url}')) &gt; 0">
            <target>
              <url>${url}</url>
              <xsl:if test="string-length(normalize-space('${topic}')) &gt; 0">
                <topic>${topic}</topic>
                <partition>${partition}</partition>
              </xsl:if>
              <xsl:copy-of select="$connectionProperties" />
            </target>
          </xsl:when>
        </xsl:choose>
        <data>
          <xsl:copy-of select="." />
        </data>
      </kafka-adapter-request>
    </request-data>
  </xsl:template>
</xsl:stylesheet>]]></stylesheet>
                </xslt-stylesheet>
              </assignment>
              <meta>
                <documentation />
                <checkpoint>false</checkpoint>
              </meta>
              <after-execution>
                <log>
                  <level>debug</level>
                  <parameters>
                    <input>
                      <value>===Kafka Adapter Request===</value>
                    </input>
                    <input>
                      <from>adapter request</from>
                    </input>
                  </parameters>
                </log>
              </after-execution>
              <location>:switch[1]:sequence[2]:assign[1]</location>
            </assign>
            <call-adapter>
              <use-system-adapter>false</use-system-adapter>
              <parameters>
                <input global="false">
                  <from>adapter name</from>
                </input>
                <input>
                  <value>
                    <adapter-request>
                      <peer-location>
                        <location>any</location>
                      </peer-location>
                    </adapter-request>
                  </value>
                </input>
                <input global="false">
                  <from>adapter request</from>
                </input>
                <input global="false">
                  <from>adapter request</from>
                </input>
                <output global="false">
                  <to>adapter response</to>
                </output>
              </parameters>
              <meta>
                <documentation />
                <checkpoint>false</checkpoint>
              </meta>
              <after-execution>
                <log>
                  <level>debug</level>
                  <parameters>
                    <input>
                      <value>===Kafka Adapter Response===</value>
                    </input>
                    <input>
                      <from>adapter response</from>
                    </input>
                  </parameters>
                </log>
              </after-execution>
              <location>:switch[1]:sequence[2]:call-adapter[1]</location>
            </call-adapter>
          </sequence>
        </case>
        <location>:switch[1]</location>
      </switch>
    </sequence>
    <meta>
      <expose-to>
        <consumer>RULE</consumer>
        <consumer>SCHEDULE</consumer>
        <consumer>OCP</consumer>
        <consumer>SOAP</consumer>
      </expose-to>
      <documentation>
        <description>Send one or more messages.</description>
        <version></version>
      </documentation>
      <logging-options>
        <is-enabled>false</is-enabled>
        <log-file-name></log-file-name>
      </logging-options>
      <peer-location>
        <location>any</location>
      </peer-location>
      <record-metrics>true</record-metrics>
      <process-id>e730281f-692a-43b3-8c5f-cb2eb47ab953</process-id>
      <author>Ranganath Samudrala</author>
      <category>Kafka</category>
      <status></status>
      <keywords></keywords>
      <systems></systems>
      <last-modified-by>aoadmin</last-modified-by>
      <last-modified>1571812546616</last-modified>
    </meta>
  </process-def>
</process>