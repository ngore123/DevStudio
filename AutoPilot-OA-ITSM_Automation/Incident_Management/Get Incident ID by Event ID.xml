<process draft="false" dev-studio-version="8.2.00">
  <process-def name=":AutoPilot-OA-ITSM_Automation:Incident_Management:Get Incident ID by Event ID">
    <parameters>
      <input global="false" required="true">
        <description>Name of ITSM adapter. Like ARSAdapter.</description>
        <from>adapter name</from>
        <to>adapter name</to>
      </input>
      <input global="false" required="true">
        <description>Event ID that in a field in ITSM</description>
        <from>event id</from>
        <to>event id</to>
      </input>
      <input global="false" required="false">
        <description>Target URL, like Remedy REST API URL</description>
        <from>url</from>
        <to>url</to>
      </input>
      <input global="false" required="false">
        <description>itsm authentication token, if using non-Java mode of access</description>
        <from>itsm authentication token</from>
        <to>itsm authentication token</to>
      </input>
      <input global="false" required="false">
        <description>true/false. If true, when zero reccords are found, status will be failure with error message. Default is false.</description>
        <from>return error on zero records</from>
        <to>return error on zero records</to>
      </input>
      <output global="false" required="false">
        <to>incident id</to>
        <from>incident id</from>
      </output>
      <output global="false" required="false">
        <to>status</to>
        <from>status</from>
      </output>
      <output global="false" required="false">
        <to>status code</to>
        <from>status code</from>
      </output>
      <output global="false" required="false">
        <to>error message</to>
        <from>error message</from>
      </output>
    </parameters>
    <access />
    <sequence>
      <assign>
        <assignment>
          <output>
            <to>status</to>
            <value>success</value>
          </output>
        </assignment>
        <assignment>
          <output>
            <to>status code</to>
            <value></value>
          </output>
        </assignment>
        <assignment>
          <output>
            <to>error message</to>
            <value></value>
          </output>
        </assignment>
        <assignment>
          <output>
            <to>incident id</to>
            <value></value>
          </output>
        </assignment>
        <assignment>
          <input>
            <from>itsm authentication token</from>
          </input>
          <output>
            <to>authentication token</to>
          </output>
        </assignment>
        <assignment>
          <output>
            <to>schema name</to>
            <value>HPD:Help Desk</value>
          </output>
        </assignment>
        <assignment>
          <input>
            <concat>
              <input>
                <value>'mc_ueid' = "</value>
              </input>
              <input required="false">
                <from>event id</from>
              </input>
              <input>
                <value>"</value>
              </input>
            </concat>
          </input>
          <output>
            <to>query</to>
          </output>
        </assignment>
        <assignment>
          <output>
            <to>fields xml</to>
            <value>
              <fields>
                <field>Incident Number</field>
              </fields>
            </value>
          </output>
        </assignment>
        <assignment>
          <document>
            <input>
              <from>fields xml</from>
            </input>
          </document>
          <result>
            <output>
              <to>items</to>
            </output>
          </result>
          <xslt-stylesheet>
            <stylesheet-replacement-tokens>
              <replacement-token name="schema name">
                <input global="false">
                  <from>schema name</from>
                </input>
              </replacement-token>
              <replacement-token name="query">
                <input global="false">
                  <from>query</from>
                </input>
              </replacement-token>
            </stylesheet-replacement-tokens>
            <stylesheet><![CDATA[<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
  <xsl:output indent="no" cdata-section-elements="query " />
  <xsl:template match="/">
    <items>
      <item>
        <schema>${schema name}</schema>
        <query>${query}</query>
        <xsl:copy-of select="." />
      </item>
    </items>
  </xsl:template>
</xsl:stylesheet>]]></stylesheet>
          </xslt-stylesheet>
        </assignment>
        <assignment>
          <output>
            <to>version</to>
            <value>v9.0</value>
          </output>
        </assignment>
        <assignment>
          <output>
            <to>item type</to>
            <value>incident-number</value>
          </output>
        </assignment>
        <assignment>
          <document>
            <input>
              <from>return error on zero records</from>
            </input>
          </document>
          <result>
            <output>
              <to>return error on zero records</to>
            </output>
          </result>
          <xslt-stylesheet>
            <stylesheet-replacement-tokens />
            <stylesheet><![CDATA[<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
  <xsl:output indent="no" />
  <xsl:template match="/">
    <value>
      <xsl:choose>
        <xsl:when test="string-length(normalize-space(.)) = 0">
          <xsl:text disable-output-escaping="no">false</xsl:text>
        </xsl:when>
        <xsl:otherwise>
          <xsl:value-of select="." disable-output-escaping="no" />
        </xsl:otherwise>
      </xsl:choose>
    </value>
  </xsl:template>
</xsl:stylesheet>]]></stylesheet>
          </xslt-stylesheet>
        </assignment>
        <assignment>
          <output>
            <to>fields</to>
            <value>values(Incident Number)</value>
          </output>
        </assignment>
        <meta>
          <documentation />
          <checkpoint>false</checkpoint>
        </meta>
        <before-execution>
          <log>
            <level>debug</level>
            <parameters>
              <input>
                <value>=== Get Incident ID for Event ID Input====</value>
              </input>
              <input>
                <from>event id</from>
              </input>
            </parameters>
          </log>
        </before-execution>
        <location>:assign[1]</location>
      </assign>
      <switch>
        <meta>
          <documentation />
          <run-mode-handling>
            <run-mode>OCP</run-mode>
            <allow-step-into>true</allow-step-into>
          </run-mode-handling>
          <checkpoint>false</checkpoint>
        </meta>
        <execute-all-applicable-cases>false</execute-all-applicable-cases>
        <default>
          <sequence>
            <switch>
              <meta>
                <documentation />
                <run-mode-handling>
                  <run-mode>OCP</run-mode>
                  <allow-step-into>true</allow-step-into>
                </run-mode-handling>
                <checkpoint>false</checkpoint>
              </meta>
              <execute-all-applicable-cases>false</execute-all-applicable-cases>
              <default>
                <sequence>
                  <assign>
                    <assignment>
                      <output>
                        <to>status</to>
                        <value>failure</value>
                      </output>
                    </assignment>
                    <assignment>
                      <output>
                        <to>status code</to>
                        <value>500</value>
                      </output>
                    </assignment>
                    <assignment>
                      <output>
                        <to>error message</to>
                        <value>No ITSM authentication token to perform find/get operation.</value>
                      </output>
                    </assignment>
                    <meta>
                      <documentation />
                      <checkpoint>false</checkpoint>
                    </meta>
                    <location>:switch[1]:sequence[1]:switch[1]:sequence[1]:assign[1]</location>
                  </assign>
                </sequence>
              </default>
              <case>
                <condition>
                  <document>
                    <input>
                      <from>authentication token</from>
                    </input>
                  </document>
                  <xpath-expression>
                    <xpath-replacement-tokens />
                    <xpath><![CDATA[string-length(normalize-space(.)) > 0]]></xpath>
                  </xpath-expression>
                </condition>
                <sequence>
                  <call-process>
                    <process-name>:BMC-AD-Remedy_REST:Find Items</process-name>
                    <parameters>
                      <input>
                        <from>adapter name</from>
                        <to>adapter name</to>
                      </input>
                      <input>
                        <from>url</from>
                        <to>url</to>
                      </input>
                      <input>
                        <from>authentication token</from>
                        <to>authorization token</to>
                      </input>
                      <input>
                        <from>schema name</from>
                        <to>form name</to>
                      </input>
                      <input>
                        <from>query</from>
                        <to>query</to>
                      </input>
                      <input>
                        <value>xml</value>
                        <to>return data format</to>
                      </input>
                      <input>
                        <from>fields</from>
                        <to>fields</to>
                      </input>
                      <output>
                        <from>response headers</from>
                        <to>response headers</to>
                      </output>
                      <output>
                        <from>response body</from>
                        <to>response body</to>
                      </output>
                      <output>
                        <from>status</from>
                        <to>status</to>
                      </output>
                      <output>
                        <from>status code</from>
                        <to>status code</to>
                      </output>
                      <output>
                        <from>error message</from>
                        <to>error message</to>
                      </output>
                    </parameters>
                    <meta>
                      <documentation />
                      <run-mode-handling>
                        <run-mode>OCP</run-mode>
                        <allow-step-into>false</allow-step-into>
                      </run-mode-handling>
                      <checkpoint>false</checkpoint>
                    </meta>
                    <location>:switch[1]:sequence[1]:switch[1]:sequence[2]:call-process[1]</location>
                  </call-process>
                  <assign>
                    <assignment>
                      <document>
                        <input>
                          <from>response body</from>
                        </input>
                      </document>
                      <result>
                        <output>
                          <to>incident id</to>
                        </output>
                      </result>
                      <xslt-stylesheet>
                        <stylesheet-replacement-tokens>
                          <replacement-token name="status">
                            <input global="false">
                              <from>status</from>
                            </input>
                          </replacement-token>
                        </stylesheet-replacement-tokens>
                        <stylesheet><![CDATA[<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
  <xsl:output indent="no" />
  <xsl:template match="/">
    <value>
      <xsl:choose>
        <xsl:when test="'${status}' = 'success'">
          <xsl:value-of select="//Incident-Number/text()" disable-output-escaping="no" />
        </xsl:when>
        <xsl:otherwise>
          <xsl:text />
        </xsl:otherwise>
      </xsl:choose>
    </value>
  </xsl:template>
</xsl:stylesheet>]]></stylesheet>
                      </xslt-stylesheet>
                    </assignment>
                    <meta>
                      <documentation />
                      <checkpoint>false</checkpoint>
                    </meta>
                    <location>:switch[1]:sequence[1]:switch[1]:sequence[2]:assign[1]</location>
                  </assign>
                </sequence>
              </case>
              <location>:switch[1]:sequence[1]:switch[1]</location>
            </switch>
          </sequence>
        </default>
        <case>
          <condition>
            <document>
              <input global="true">
                <configuration>:AutoPilot-OA-ITSM_Automation:BMC_AR_System:Defaults:Use_Java</configuration>
              </input>
            </document>
            <xpath-expression>
              <xpath-replacement-tokens />
              <xpath><![CDATA[. = 'true']]></xpath>
            </xpath-expression>
          </condition>
          <sequence>
            <call-process>
              <process-name>:AMP-AD-BMC-Remedy-ARS:Find Items</process-name>
              <parameters>
                <input>
                  <from>adapter name</from>
                  <to>adapter name</to>
                </input>
                <input>
                  <from>items</from>
                  <to>items</to>
                </input>
                <input>
                  <from>version</from>
                  <to>version</to>
                </input>
                <input>
                  <from>item type</from>
                  <to>item type</to>
                </input>
                <output>
                  <from>adapter response</from>
                  <to>adapter response</to>
                </output>
              </parameters>
              <meta>
                <documentation />
                <run-mode-handling>
                  <run-mode>OCP</run-mode>
                  <allow-step-into>false</allow-step-into>
                </run-mode-handling>
                <checkpoint>false</checkpoint>
              </meta>
              <location>:switch[1]:sequence[2]:call-process[1]</location>
            </call-process>
            <switch>
              <meta>
                <documentation />
                <run-mode-handling>
                  <run-mode>OCP</run-mode>
                  <allow-step-into>true</allow-step-into>
                </run-mode-handling>
                <checkpoint>false</checkpoint>
              </meta>
              <execute-all-applicable-cases>false</execute-all-applicable-cases>
              <default>
                <sequence>
                  <assign>
                    <assignment>
                      <output>
                        <to>status</to>
                        <value>failure</value>
                      </output>
                    </assignment>
                    <assignment>
                      <document>
                        <input>
                          <from>adapter response</from>
                        </input>
                      </document>
                      <result>
                        <output>
                          <to>error message</to>
                        </output>
                      </result>
                      <xslt-stylesheet>
                        <stylesheet-replacement-tokens>
                          <replacement-token name="event id">
                            <input global="false">
                              <from>event id</from>
                            </input>
                          </replacement-token>
                        </stylesheet-replacement-tokens>
                        <stylesheet><![CDATA[<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
  <xsl:output indent="no" />
  <xsl:template match="/">
    <value>
      <xsl:choose>
        <xsl:when test="boolean(//metadata/error)">
          <xsl:value-of select="//metadata/error/text()" disable-output-escaping="no" />
        </xsl:when>
        <xsl:when test="not(boolean(//entry-id)) ">
          <xsl:text disable-output-escaping="no">Incident not found for event ID: ${event id}</xsl:text>
        </xsl:when>
      </xsl:choose>
    </value>
  </xsl:template>
</xsl:stylesheet>]]></stylesheet>
                      </xslt-stylesheet>
                    </assignment>
                    <meta>
                      <documentation />
                      <checkpoint>false</checkpoint>
                    </meta>
                    <location>:switch[1]:sequence[2]:switch[1]:sequence[1]:assign[1]</location>
                  </assign>
                </sequence>
              </default>
              <case>
                <condition>
                  <document>
                    <input>
                      <from>adapter response</from>
                    </input>
                  </document>
                  <xpath-expression>
                    <xpath-replacement-tokens />
                    <xpath><![CDATA[boolean(//entry) and number(//metadata/entry-count/text()) > 0]]></xpath>
                  </xpath-expression>
                </condition>
                <sequence>
                  <assign>
                    <assignment>
                      <output>
                        <to>status</to>
                        <value>success</value>
                      </output>
                    </assignment>
                    <assignment>
                      <document>
                        <input>
                          <from>adapter response</from>
                        </input>
                      </document>
                      <result>
                        <output>
                          <to>incident id</to>
                        </output>
                      </result>
                      <xpath-expression>
                        <xpath-replacement-tokens />
                        <xpath><![CDATA[(//field[@name = 'Incident Number'])[1]/text()]]></xpath>
                      </xpath-expression>
                    </assignment>
                    <meta>
                      <documentation />
                      <checkpoint>false</checkpoint>
                    </meta>
                    <location>:switch[1]:sequence[2]:switch[1]:sequence[2]:assign[1]</location>
                  </assign>
                </sequence>
              </case>
              <case applies-if-any-condition-true="false">
                <condition>
                  <document>
                    <input>
                      <from>return error on zero records</from>
                    </input>
                  </document>
                  <xpath-expression>
                    <xpath-replacement-tokens />
                    <xpath><![CDATA[. = 'false']]></xpath>
                  </xpath-expression>
                </condition>
                <condition>
                  <document>
                    <input>
                      <from>adapter response</from>
                    </input>
                  </document>
                  <xpath-expression>
                    <xpath-replacement-tokens />
                    <xpath><![CDATA[not(boolean(//metadata/error))]]></xpath>
                  </xpath-expression>
                </condition>
                <condition>
                  <document>
                    <input>
                      <from>adapter response</from>
                    </input>
                  </document>
                  <xpath-expression>
                    <xpath-replacement-tokens />
                    <xpath><![CDATA[not(boolean(entry))]]></xpath>
                  </xpath-expression>
                </condition>
                <sequence>
                  <assign>
                    <assignment>
                      <output>
                        <to>status</to>
                        <value>success</value>
                      </output>
                    </assignment>
                    <meta>
                      <documentation />
                      <checkpoint>false</checkpoint>
                    </meta>
                    <location>:switch[1]:sequence[2]:switch[1]:sequence[3]:assign[1]</location>
                  </assign>
                </sequence>
              </case>
              <location>:switch[1]:sequence[2]:switch[1]</location>
            </switch>
          </sequence>
        </case>
        <location>:switch[1]</location>
      </switch>
      <assign>
        <meta>
          <documentation />
          <checkpoint>false</checkpoint>
        </meta>
        <before-execution>
          <log>
            <level>debug</level>
            <parameters>
              <input>
                <value>====Get Incident ID by Event ID Output====</value>
              </input>
              <input>
                <from>incident id</from>
              </input>
              <input>
                <from>status</from>
              </input>
              <input>
                <from>error message</from>
              </input>
            </parameters>
          </log>
        </before-execution>
        <location>:assign[2]</location>
      </assign>
    </sequence>
    <meta>
      <expose-to>
        <consumer>RULE</consumer>
        <consumer>SCHEDULE</consumer>
        <consumer>OCP</consumer>
        <consumer>SOAP</consumer>
      </expose-to>
      <documentation>
        <description>Get Incident Number for a given Event ID (mc_ueid) attribute in Remedy ITSM.

First implmentation used Remedy Java API. So, there was no need to use url, user name and password inputs. 

Latest implementation uses Remedy REST API. This requires  url, user name and password inputs.</description>
        <version></version>
      </documentation>
      <logging-options>
        <is-enabled>false</is-enabled>
        <log-file-name></log-file-name>
      </logging-options>
      <peer-location>
        <location>any</location>
      </peer-location>
      <record-metrics>false</record-metrics>
      <process-id>bc19b5e8-b731-46ee-aaab-8508da497725</process-id>
      <author>Ranganath Samudrala</author>
      <category></category>
      <status></status>
      <keywords></keywords>
      <systems></systems>
      <last-modified-by>aoadmin</last-modified-by>
      <last-modified>1569856677542</last-modified>
    </meta>
  </process-def>
</process>