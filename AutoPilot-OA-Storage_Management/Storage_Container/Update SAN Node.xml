<process draft="false" dev-studio-version="7.6.02.01">
  <process-def name=":AutoPilot-OA-Storage_Management:Storage_Container:Update SAN Node">
    <parameters>
      <input global="false" required="true">
        <description>Name of supported vendor : NetApp</description>
        <from>configuration name</from>
        <to>configuration name</to>
      </input>
      <input global="false" required="true">
        <description>Modify node attributes of a SAN dataset. Export settings can also be modified using this wrapper.

Sample XML:

&lt;storage&gt;
	&lt;storage-container-name-or-id&gt;test1&lt;/storage-container-name-or-id&gt;
	&lt;force&gt;true&lt;/force&gt;
	&lt;dp-node-name&gt;Primary data&lt;/dp-node-name&gt;
	&lt;online-migration&gt;true&lt;/online-migration&gt;
	&lt;resourcepool-name-or-id&gt;Gold&lt;/resourcepool-name-or-id&gt;
	&lt;provisioning-policy-name-or-id&gt;Gold&lt;/provisioning-policy-name-or-id&gt;
	&lt;relinquish-vfiler&gt;true&lt;/relinquish-vfiler&gt;
	&lt;vfiler-name-or-id&gt;test&lt;/vfiler-name-or-id&gt;
	&lt;dataset-access-details&gt;
		&lt;ip-address&gt;172.16.49.104&lt;/ip-address&gt;
		&lt;netmask&gt;255.255.255.0&lt;/netmask&gt;
	&lt;/dataset-access-details&gt;
	&lt;dataset-export-info&gt;
		&lt;dataset-export-protocol&gt;fcp&lt;/dataset-export-protocol&gt;
		&lt;dataset-lun-mapping-info&gt;
			&lt;igroup-os-type&gt;windows&lt;/igroup-os-type&gt;
			&lt;lun-mapping-initiators&gt;
				&lt;lun-mapping-initiator&gt;
					&lt;hostname&gt;172.16.49.104&lt;/hostname&gt;
					&lt;initiator-id&gt;aaaaaaaaaaaaaaaa&lt;/initiator-id&gt;
				&lt;/lun-mapping-initiator&gt;
			&lt;/lun-mapping-initiators&gt;
		&lt;/dataset-lun-mapping-info&gt;
	&lt;/dataset-export-info&gt;
	&lt;timezone-name&gt;GMT&lt;/timezone-name&gt;
&lt;/storage&gt;

Parameters Description:

storage-container-name-or-id [Required]
	The name of the dataset that whose attributes will be modified.

force [Optional]
	This is a boolean field. By default, force is false. If true, and an edit is already in progress on the specified dataset or an object the dataset is dependent on (such as a data protection policy), the previous edit session is rolled back and a new edit session is begun.

dp-node-name [Optional]
	Name of the node in the data protection policy that maps to the storage	set. dp-node-name must match exactly the name of one of the nodes in the data protection policy that is currently assigned to the data set.
If dp-node-name is not specified, then the storage set associated with the root node is modified.

online-migration [Optional]
	This is a boolean field. If true, will indicate that the migration cutover has to be non-disrputive. By default the migration will be assumed to be disruptive. Default: false.

resourcepool-name-or-id [Optional]
	Name or object identifier of a resource pool to assign to the storage set. If other resource pool(s) are already assigned to the	storage set, then this one will replace it. This will delete all the attached resource pools and add the new one. If the input value is the empty string "", then no resource pool will be assigned to the storage set i.e. all the attached resource pools will be removed. If this parameter is not supplied, then the storage set's resource pool assignment will not be changed.

provisioning-policy-name-or-id [Optional]
	Name or object identifier of the provisioning policy to be attached to the node. The implications of this are:
		1. Members of the storage set associated with node are checked for conformance with the provisioning policy.
		2. Any new members provisioned into the storage set will be based on this provisioning policy.

relinquish-vfiler [Optional]
	This is a boolean field. If true, relinquish the vFiler unit associated with the dataset. This will destroy the vFiler unit, move all the storage owned by the vFiler unit to the hosting storage system and re-export the dataset over the storage system. This option can be specified only when:
	1. The vFiler unit associated with the root node of the dataset has been created for transparent migration by Provisioning Manager. In this case is-vfiler-created-for-migration will be true in dataset-info returned by dataset-list-info-iter APIs.
	2. All storage of the vFiler unit belongs to the primary node of the dataset, except for the root storage.
Default value is false.

vfiler-name-or-id [Optional]
	Name or object identifier of the vFiler unit to be attached to the node. If there are any members currently in the node, they should belong to this vFiler unit. Any new member provisioned for this node, will be exported over this vFiler unit.

dataset-access-details [Optional]
	Data access details for a dataset that needs to be configured and provisioned in a way that it is capable of transparent migration. This enables all the storage in the primary node of the dataset to be migrated to a different physical resource without having to reconfigure the clients accessing this storage. This input is valid only when: - There are no members in the dataset. - There is no vFiler unit attached to the dataset. - The node being edited is the primary node of the dataset.

ip-address [Optional]
	IP address in dotted decimal format. (for example, "192.168.11.12"). The length of this string cannot be more than 16 characters.

netmask [Optional]
	Netmask for the IP Address in dotted decimal notation. As input, this is valid only when ip-address is also provided in dataset-access-details. Provisioning Manager will create a vFiler unit whose IP Address will be the one configured as ip-address and it will be bound to an interface with this netmask.

dataset-export-info [Optional]
	Specifies the NAS or SAN export settings for the the provisioning member. Member level export settings cannot be specified, if export settings have been configured at node level.

dataset-export-protocol [Optional]
	Specifies the protocol over which members of the dataset node will be exported. This value is always returned. If omitted during a modify operation, the existing value is not changed. If specified as 'none' in a modify operation, the existing settings will be cleared. Default value is 'none'. Depending on the export protocol, dataset-lun-mapping, or a combination of dataset-nfs-export-setting and dataset-cifs-share-permissions, should be specified in a modify operation, and will be returned in the iterator output.

dataset-lun-mapping-info [Optional]
	Specifies the hosts and/or initiators to which LUNs in this dataset node will be mapped, and the igroup OS type. This field may be present only if the dataset-export-protocol is 'fcp' or 'iscsi'.

igroup-os-type [Optional]
	Specifies the OS type for initiators to map LUNs in the dataset node to. Possible values are: 'windows', 'windows_gpt', 'windows_2008', 'hpux', 'aix, 'linux, 'solaris', 'vmware' and 'netware'. Here "windows_gpt" refers to Windows using GPT (GUID Partition Type) partitioning style and "windows_2008" refers to Windows Longhorn systems.

lun-mapping-initiators [Optional]
	Specifies the initiators to map LUNs in the dataset node to, and, optionally, the host to which they belong.

lun-mapping-initiator [Optional]
	Specifies an initiator to map LUNs in the dataset node to, and, optionally, the host to which it belongs.

hostname [Optional]
	Specifies the name of the host which owns the initiator.

initiator-id [Optional]
	Specifies an initiator id on a host to which a LUN should be mapped.For FCP initiators, this is a string composed of 16 hexadecimal digits. For iSCSI initiators, this is an initiator name in the dotted-domain notation.

timezone-name [Optional]
	Timezone to assign to the storage set. The value must be either a timezone-name returned by timezone-list-info-iter-next, or the empty string "". If the value is "", no timezone is assigned to the storage set. Storage sets with no timezone assignment use the timezone of the resource pool assigned to them, or the system default if no timezone is assigned to the resource pool.</description>
        <from>storage</from>
        <to>storage</to>
      </input>
      <input global="false" required="false">
        <description>NetApp: 
[required if dynamic targeting is used otherwise optional] 

Designates a specific target (name of the DFM server where the operation will be performed) that has been defined in the adapter configuration. Valid value- Same value that has been specified for the name attribute of 'config' element in the adapter configuration . If this tag is left empty the request will be executed on the first defined adapter configuration.

for e.g for the  adapter config below , target would be 02.
&lt;configs&gt;
   &lt;config name="02"&gt;
          &lt;target&gt;172.19.224.103&lt;/target&gt;
          &lt;user-name&gt;root&lt;/user-name&gt;
          &lt;password&gt;bmcbmc&lt;/password&gt;
          &lt;protocol&gt;http&lt;/protocol&gt;
          &lt;port&gt;8088&lt;/port&gt;
   &lt;/config&gt;
&lt;/configs&gt;

Dynamic targeting: Host name or IP address of DFM.</description>
        <from>target</from>
        <to>target</to>
      </input>
      <input global="false" required="false">
        <description>NetApp:
[required only if dynamic targeting is used]
NetApp DataFabric Manager login username.</description>
        <from>username</from>
        <to>username</to>
      </input>
      <input global="false" required="false">
        <description>NetApp:
[required only if dynamic targeting is used]
NetApp DataFabric Manager login password.</description>
        <from>password</from>
        <to>password</to>
      </input>
      <input global="false" required="false">
        <description>NetApp: [Conditional]  specified only when password parameter is mentioned .
You can encrypt the password by specifying the encryption type .
Valid values:  Base64,Plain.</description>
        <from>encryption type</from>
        <to>encryption type</to>
      </input>
      <input global="false" required="false">
        <description>NetApp:
[Optional and used when dynamic targeting] 
Communication protocol used by adapter. Valid value is http or https. Default value is http.</description>
        <from>protocol</from>
        <to>protocol</to>
      </input>
      <input global="false" required="false">
        <description>NetApp: 
[Optional and used when dynamic targeting]
Port on which NetApp DataFabric Manager is enabled. Default value is 8088 for http protocol and 8488 for https protocol.</description>
        <from>port</from>
        <to>port</to>
      </input>
      <output global="false" required="false">
        <description>String Value - Indicates whether or not the process completed successfully. 

Valid values: success or failure</description>
        <to>success status</to>
        <from>success status</from>
      </output>
      <output global="false" required="false">
        <description>String Value - A process specific explanation for the value of success status, incase of failure</description>
        <to>status message</to>
        <from>status message</from>
      </output>
      <output global="false" required="false">
        <description>String or XML value - Contains required output, in case of success</description>
        <to>output</to>
        <from>output</from>
      </output>
    </parameters>
    <access />
    <sequence>
      <call-process>
        <process-name>:AutoPilot-OA-Storage_Management:Utilities:Extract Configuration Data</process-name>
        <parameters>
          <input>
            <from>configuration name</from>
            <to>configuration name</to>
          </input>
          <output>
            <from>success status</from>
            <to>success status</to>
          </output>
          <output>
            <from>adapter</from>
            <to>adapter</to>
          </output>
          <output>
            <from>version</from>
            <to>version</to>
          </output>
          <output>
            <from>module configuration items</from>
            <to>module configuration items</to>
          </output>
        </parameters>
        <meta>
          <documentation />
          <run-mode-handling>
            <run-mode>OCP</run-mode>
            <allow-step-into>false</allow-step-into>
          </run-mode-handling>
          <checkpoint>false</checkpoint>
        </meta>
        <after-execution>
          <console-output>
            <type>INFO</type>
            <summary>
              <concat>
                <input>
                  <value></value>
                </input>
              </concat>
            </summary>
            <detail>
              <concat>
                <input>
                  <value></value>
                </input>
              </concat>
            </detail>
          </console-output>
        </after-execution>
        <location>:call-process[1]</location>
      </call-process>
      <switch>
        <meta>
          <documentation />
          <run-mode-handling>
            <run-mode>OCP</run-mode>
            <allow-step-into>true</allow-step-into>
          </run-mode-handling>
          <checkpoint>false</checkpoint>
        </meta>
        <execute-all-applicable-cases>false</execute-all-applicable-cases>
        <default>
          <sequence>
            <assign>
              <assignment>
                <output>
                  <to>success status</to>
                  <value>failure</value>
                </output>
              </assignment>
              <assignment>
                <document>
                  <input>
                    <from>configuration name</from>
                  </input>
                </document>
                <result>
                  <output>
                    <to>status message</to>
                  </output>
                </result>
                <xpath-expression>
                  <xpath-replacement-tokens />
                  <xpath><![CDATA[concat("Unknown configuration name " , .)]]></xpath>
                </xpath-expression>
              </assignment>
              <meta>
                <documentation />
                <checkpoint>false</checkpoint>
              </meta>
              <location>:switch[1]:sequence[1]:assign[1]</location>
            </assign>
          </sequence>
        </default>
        <case>
          <condition>
            <document>
              <input>
                <from>configuration name</from>
              </input>
            </document>
            <xpath-expression>
              <xpath-replacement-tokens />
              <xpath><![CDATA[text()= 'NetApp']]></xpath>
            </xpath-expression>
          </condition>
          <sequence>
            <console-output>
              <type>INFO</type>
              <summary>
                <concat>
                  <input>
                    <value></value>
                  </input>
                </concat>
              </summary>
              <detail>
                <concat>
                  <input>
                    <value></value>
                  </input>
                </concat>
              </detail>
            </console-output>
            <assign>
              <assignment>
                <document>
                  <input>
                    <from>storage</from>
                  </input>
                </document>
                <result>
                  <output>
                    <to>items</to>
                  </output>
                </result>
                <xslt-stylesheet>
                  <stylesheet-replacement-tokens>
                    <replacement-token name="target">
                      <input global="false">
                        <from>target</from>
                      </input>
                    </replacement-token>
                    <replacement-token name="username">
                      <input global="false">
                        <from>username</from>
                      </input>
                    </replacement-token>
                    <replacement-token name="password">
                      <input global="false">
                        <from>password</from>
                      </input>
                    </replacement-token>
                    <replacement-token name="protocol">
                      <input global="false">
                        <from>protocol</from>
                      </input>
                    </replacement-token>
                    <replacement-token name="port">
                      <input global="false">
                        <from>port</from>
                      </input>
                    </replacement-token>
                    <replacement-token name="encryption type">
                      <input global="false">
                        <from>encryption type</from>
                      </input>
                    </replacement-token>
                  </stylesheet-replacement-tokens>
                  <stylesheet><![CDATA[<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
  <xsl:output indent="no" />
  <xsl:template match="/">
    <items>
      <item>
        <xsl:if test="string-length('${target}')&gt;0 and string-length('${username}') =0">
          <target>
            <xsl:value-of select="'${target}'" disable-output-escaping="no" />
          </target>
        </xsl:if>
        <dataset-name-or-id>
          <xsl:value-of select="//storage-container-name-or-id/text()" disable-output-escaping="no" />
        </dataset-name-or-id>
        <xsl:if test="string-length(//force/text())&gt;0">
          <force>
            <xsl:value-of select="//force/text()" disable-output-escaping="no" />
          </force>
        </xsl:if>
        <xsl:if test="string-length(//dp-node-name/text())&gt;0">
          <dp-node-name>
            <xsl:value-of select="//dp-node-name/text()" disable-output-escaping="no" />
          </dp-node-name>
        </xsl:if>
        <xsl:if test="string-length(//online-migration/text())&gt;0">
          <online-migration>
            <xsl:value-of select="//online-migration/text()" disable-output-escaping="no" />
          </online-migration>
        </xsl:if>
        <xsl:if test="string-length(//resourcepool-name-or-id/text())&gt;0">
          <resourcepool-name-or-id>
            <xsl:value-of select="//resourcepool-name-or-id/text()" disable-output-escaping="no" />
          </resourcepool-name-or-id>
        </xsl:if>
        <xsl:if test="string-length(//provisioning-policy-name-or-id/text())&gt;0">
          <provisioning-policy-name-or-id>
            <xsl:value-of select="//provisioning-policy-name-or-id/text()" disable-output-escaping="no" />
          </provisioning-policy-name-or-id>
        </xsl:if>
        <xsl:if test="string-length(//relinquish-vfiler/text())&gt;0">
          <relinquish-vfiler>
            <xsl:value-of select="//relinquish-vfiler/text()" disable-output-escaping="no" />
          </relinquish-vfiler>
        </xsl:if>
        <xsl:if test="string-length(//vfiler-name-or-id/text())&gt;0">
          <vfiler-name-or-id>
            <xsl:value-of select="//vfiler-name-or-id/text()" disable-output-escaping="no" />
          </vfiler-name-or-id>
        </xsl:if>
        <xsl:if test="name(//dataset-access-details)">
          <xsl:copy-of select="//dataset-access-details" />
        </xsl:if>
        <xsl:if test="name(//dataset-export-info)">
          <xsl:copy-of select="//dataset-export-info" />
        </xsl:if>
        <xsl:if test="string-length(//timezone-name/text())&gt;0">
          <timezone-name>
            <xsl:value-of select="//timezone-name/text()" disable-output-escaping="no" />
          </timezone-name>
        </xsl:if>
        <xsl:if test="string-length('${target}')&gt;0 and string-length('${username}') &gt; 0">
          <targets>
            <target>
              <host>
                <xsl:value-of select="'${target}'" disable-output-escaping="no" />
              </host>
              <user-name>${username}</user-name>
              <password>
                <xsl:attribute name="encryption-type">
                  <xsl:value-of select="'${encryption type}'" disable-output-escaping="no" />
                </xsl:attribute>
                <xsl:value-of select="'${password}'" disable-output-escaping="no" />
              </password>
              <xsl:if test="string-length('${protocol}') &gt;0">
                <protocol>${protocol}</protocol>
              </xsl:if>
              <xsl:if test="string-length('${port}') &gt;0">
                <port>${port}</port>
              </xsl:if>
            </target>
          </targets>
        </xsl:if>
      </item>
    </items>
  </xsl:template>
</xsl:stylesheet>]]></stylesheet>
                </xslt-stylesheet>
              </assignment>
              <meta>
                <documentation />
                <checkpoint>false</checkpoint>
              </meta>
              <location>:switch[1]:sequence[2]:assign[1]</location>
            </assign>
            <call-process>
              <process-name>:AO-AD-NetAPP_Storage:Update Items</process-name>
              <parameters>
                <input>
                  <from>module configuration items</from>
                  <to>adapter name</to>
                  <xpath-expression>
                    <xpath-replacement-tokens>
                      <replacement-token name="configuration name">
                        <input global="false">
                          <from>configuration name</from>
                        </input>
                      </replacement-token>
                    </xpath-replacement-tokens>
                    <xpath><![CDATA[//$[configuration name]/Adapter/text()]]></xpath>
                  </xpath-expression>
                </input>
                <input>
                  <from>module configuration items</from>
                  <to>version</to>
                  <xpath-expression>
                    <xpath-replacement-tokens>
                      <replacement-token name="configuration name">
                        <input global="false">
                          <from>configuration name</from>
                        </input>
                      </replacement-token>
                    </xpath-replacement-tokens>
                    <xpath><![CDATA[//$[configuration name]/Version/text()]]></xpath>
                  </xpath-expression>
                </input>
                <input>
                  <value>update-san-dataset-node</value>
                  <to>item type</to>
                </input>
                <input>
                  <from>items</from>
                  <to>items</to>
                </input>
                <output>
                  <from>adapter response</from>
                  <to>adapter response</to>
                </output>
              </parameters>
              <meta>
                <documentation />
                <run-mode-handling>
                  <run-mode>OCP</run-mode>
                  <allow-step-into>false</allow-step-into>
                </run-mode-handling>
                <checkpoint>false</checkpoint>
              </meta>
              <after-execution>
                <console-output>
                  <type>INFO</type>
                  <summary>
                    <concat>
                      <input>
                        <value></value>
                      </input>
                    </concat>
                  </summary>
                  <detail>
                    <concat>
                      <input>
                        <value></value>
                      </input>
                    </concat>
                  </detail>
                </console-output>
              </after-execution>
              <location>:switch[1]:sequence[2]:call-process[1]</location>
            </call-process>
            <switch>
              <meta>
                <documentation />
                <run-mode-handling>
                  <run-mode>OCP</run-mode>
                  <allow-step-into>true</allow-step-into>
                </run-mode-handling>
                <checkpoint>false</checkpoint>
              </meta>
              <execute-all-applicable-cases>false</execute-all-applicable-cases>
              <default>
                <sequence>
                  <assign>
                    <assignment>
                      <output>
                        <to>success status</to>
                        <value>failure</value>
                      </output>
                    </assignment>
                    <assignment>
                      <document>
                        <input>
                          <from>adapter response</from>
                        </input>
                      </document>
                      <result>
                        <output>
                          <to>status message</to>
                        </output>
                      </result>
                      <xpath-expression>
                        <xpath-replacement-tokens />
                        <xpath><![CDATA[//response/metadata/error/text()]]></xpath>
                      </xpath-expression>
                    </assignment>
                    <meta>
                      <documentation />
                      <checkpoint>false</checkpoint>
                    </meta>
                    <location>:switch[1]:sequence[2]:switch[1]:sequence[1]:assign[1]</location>
                  </assign>
                </sequence>
              </default>
              <case>
                <condition>
                  <document>
                    <input>
                      <from>adapter response</from>
                    </input>
                  </document>
                  <xpath-expression>
                    <xpath-replacement-tokens />
                    <xpath><![CDATA[string(//response/metadata/status/text() )!= 'error']]></xpath>
                  </xpath-expression>
                </condition>
                <sequence>
                  <console-output>
                    <type>INFO</type>
                    <summary>
                      <concat>
                        <input>
                          <value></value>
                        </input>
                      </concat>
                    </summary>
                    <detail>
                      <concat>
                        <input>
                          <value></value>
                        </input>
                      </concat>
                    </detail>
                  </console-output>
                  <assign>
                    <assignment>
                      <output>
                        <to>success status</to>
                        <value>success</value>
                      </output>
                    </assignment>
                    <assignment>
                      <document>
                        <input>
                          <from>adapter response</from>
                        </input>
                      </document>
                      <result>
                        <output>
                          <to>output</to>
                        </output>
                      </result>
                      <xslt-stylesheet>
                        <stylesheet-replacement-tokens />
                        <stylesheet><![CDATA[<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
  <xsl:output indent="no" />
  <xsl:template match="/">
    <output>
      <xsl:copy-of select="//response/metadata" />
    </output>
  </xsl:template>
</xsl:stylesheet>]]></stylesheet>
                      </xslt-stylesheet>
                    </assignment>
                    <meta>
                      <documentation />
                      <checkpoint>false</checkpoint>
                    </meta>
                    <location>:switch[1]:sequence[2]:switch[1]:sequence[2]:assign[1]</location>
                  </assign>
                </sequence>
              </case>
              <location>:switch[1]:sequence[2]:switch[1]</location>
            </switch>
          </sequence>
        </case>
        <location>:switch[1]</location>
      </switch>
    </sequence>
    <meta>
      <expose-to>
        <consumer>RULE</consumer>
        <consumer>SCHEDULE</consumer>
        <consumer>SOAP</consumer>
      </expose-to>
      <documentation>
        <description>NetApp:
Modify node attributes of a SAN dataset. Export settings can also be modified using this wrapper.

Dynamic targeting:Ability to communicate with multiple DFM servers which are not configured under the adapter configuration. NetApp action can be invoked using dynamic targeting / without dynamic targeting.

When Dynamic targeting is used : target would be Host name or IP address of server on which NetApp DataFabric Manager is running. It is mandatory send all the required parameters:
username, 
 password , 
 encyption type  when using dynamic targeting.

When Dynamic targeting is not used : Designates a specific target (name of the DFM server where the operation will be performed) that has been defined in the adapter configuration. Valid value- Same value that has been specified for the name attribute of 'config' element in the adapter configuration . If this tag is left empty the request will be executed on the first defined adapter configuration.

for e.g for the  adapter config below , target would be 02.
&lt;configs&gt;
  &lt;config name="02"&gt;
    &lt;target&gt;172.19.224.103&lt;/target&gt;
    &lt;user-name&gt;root&lt;/user-name&gt;
    &lt;password&gt;bmcbmc&lt;/password&gt;
    &lt;protocol&gt;http&lt;/protocol&gt;
    &lt;port&gt;8088&lt;/port&gt;
  &lt;/config&gt;
&lt;/configs&gt;
</description>
        <version></version>
      </documentation>
      <peer-location>
        <location>any</location>
      </peer-location>
      <record-metrics>false</record-metrics>
      <process-id>83dbf193-adae-3c4a-8807-47f0a117bef8</process-id>
      <author>admin</author>
      <category></category>
      <status></status>
      <keywords></keywords>
      <systems></systems>
      <last-modified-by>admin</last-modified-by>
      <last-modified>1311233631900</last-modified>
    </meta>
  </process-def>
</process>