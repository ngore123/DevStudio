<process draft="false" dev-studio-version="7.6.02.01">
  <process-def name=":AutoPilot-OA-Storage_Management:Virtual_Storage_System:Setup Virtual Storage System">
    <parameters>
      <input global="false" required="true">
        <description>Name of supported vendor : NetApp</description>
        <from>configuration name</from>
        <to>configuration name</to>
      </input>
      <input global="false" required="true">
        <description>Configure and setup a vFiler based on a specified vFiler template. Depending on the input a CIFS setup will also be done on the vFiler.

Sample Items XML:


	&lt;storage&gt;
		&lt;vfiler-name-or-id&gt;testfiler&lt;/vfiler-name-or-id&gt;
	 	&lt;allowed-protocols&gt;
			&lt;protocol&gt;nfs&lt;/protocol&gt;
			&lt;protocol&gt;iscsi&lt;/protocol&gt;
			&lt;protocol&gt;cifs&lt;/protocol&gt;
		&lt;/allowed-protocols&gt;
		&lt;cifs-domain-password&gt;root@123&lt;/cifs-domain-password&gt;
		&lt;cifs-domain-user&gt;root&lt;/cifs-domain-user&gt;
		&lt;cifs-workgroup-name&gt;WORKGROUP&lt;/cifs-workgroup-name&gt;
		&lt;ip-bindings&gt;
			&lt;ip-binding-info&gt;
				&lt;interface&gt;&lt;/interface&gt;
				&lt;ip-address&gt;&lt;/ip-address&gt;
				&lt;mtu-size&gt;&lt;/mtu-size&gt;
				&lt;netmask&gt;&lt;/netmask&gt;
				&lt;partner-interface&gt;&lt;/partner-interface&gt;
				&lt;prefix-length&gt;&lt;/prefix-length&gt;
				&lt;vlan-identifier&gt;&lt;/vlan-identifier&gt;
			&lt;/ip-binding-info&gt;	
		&lt;/ip-bindings&gt;
		&lt;root-password&gt;root@123&lt;/root-password&gt;
		&lt;run-cifs-setup&gt;true&lt;/run-cifs-setup&gt;
                &lt;script-path&gt;&lt;/script-path&gt;
		&lt;vfiler-template-name-or-id&gt;test&lt;/vfiler-template-name-or-id&gt;
	&lt;/storage&gt;


Parameters Description

target[Optional]
	Designates a specific target (name of the DFM server where the operation will be performed) that has been defined in the adapter configuration. Valid value- Same value that has been specified for the name attribute of 'config' element in the adapter configuration or if 'all' is provided then the request will get executed on all the DFM servers defined in adapter configuration.

allowed-protocols[Optional]
	List of protocols that needs to be allowed access to the vFiler. This list overrides the list of protocols currently allowed on the vFiler. If this is not present, no changes are done to the allowed protocols of the vFiler.

protocol[Optional]
	Name of the protocol. This tag is required if the list of allowed protocols is being provided in the allowed-protocols tag. Possible values: "nfs", "cifs", "iscsi".

cifs-domain-password[Optional]
	Password for cifs-domain-user. Encrypted using 2-way encryption. Applicable and mandatory if cifs-auth-type is set to "active_directory" in vfiler template specified in vfiler-template-name-or-id. Default value is empty.

cifs-domain-user	[Optional]
	Name of CIFS domain user that has the ability to add the CIFS server to the domain given in cifs-domain-name in vfiler template specified in vfiler-template-name-or-id. Examples: username (assumes domain-name is the user's domain), cifsdomain\username, cifs.domain.com\username. Applicable and mandatory if cifs-auth-type is set to "active_directory" in vfiler template specified in vfiler-template-name-or-id. Default value is empty.

cifs-workgroup-name[Optional]
	CIFS workgroup name of the new vfiler. If vfiler-template-name-or-id is specified, this field is applicable only if cifs-auth-type is "workgroup" in the specified vfiler-template. This field is also applicable when vfiler-template-name-or-id is not given, but cifs setup needs to be done on the vFiler. Default value is "WORKGROUP" and this will be used during CIFS setup of the vFiler if run-cifs-setup is true.

ip-bindings [Optional]
	IP Address to interface binding information. Multiple entries can be made under this tag in individual ip-binding-info tags.

ip-binding-info [Optional]
	This is used to specify a vFiler IP Address to interface binding information.

interface [Conditional]
	This is required if a IP binding is being specified. This is the Name or identifier of the interface to bind the vFiler IP Address to. This can be either a physical interface, VIF or a VLAN. 
Example: "e0a", "myvif", "service_vlan"

ip-address [Conditional]
	This is required if a IP binding is being specified. This is the IP address of the vFiler which is bound to the interface. If this IP Address is not already added to the vFiler, then the IP Address is first added to the vFiler before binding the IP Address with the given interface

mtu-size [Optional]	
	MTU size of the new VLAN interface. This element should be present only if a new VLAN interface is being created during vFiler setup. Also the version of Data ONTAP on the storage system on which the vFiler is being setup, should be 7.3.3 or later. Range: [296..9196]

netmask [Optional]
	Netmask for the IP address in dotted decimal notation. For IPv4 address, either netmask or prefix-length can be supplied. For IPv6 address, netmask is ignored.

partner-interface [Optional]	
	Name or identifier of the interface on the partner node. This element is valid when the storage system on which this vFiler unit is present is in a Active/Active configuration. If a new VLAN is getting created on the local node, then a new corresponding VLAN will also be created on the partner node on this interface.

prefix-length	 [Optional]
	Prefix length for the IP address. This is required if IPv6 address is supplied. For IPv4 address, either netmask or prefix-length can be supplied. Range: [1..127]

vlan-identifier [Optional]	
	Identifier for creating a new VLAN interface. If this element is present, the interface element should refer to a physical VLAN tagged interface. Range: [1..4094]

root-password [Optional]
	Root password of the new vFiler. This will be the password for a new root account that will be created on the vFiler. If a root account already exists on this vFiler, then the password for the root account will not be changed. Encrypted using 2-way encryption. Length: [0..64] Default value is empty. Ignored if ip-bindings element is not present.

run-cifs-setup [Optional]
	This is a boolean (true or false) field that indicates whether CIFS setup should be performed on the vFiler unit. Note that if this is true and CIFS is already running on the vFiler unit, CIFS service will be stopped, and then a setup will be performed. Default value is FALSE.

script-path [Optional]
	Path to a script that will be run in pre setup and post setup mode when setting up the vFiler unit.

vfiler-name-or-id [Required]
	Full name or identifier of the vFiler to be setup.

vfiler-template-name-or-id [Optional]
	Name or identifier of vFiler template. The vFiler is setup based on the settings specified in the template. If this is not specified, then DNS, NIS servers cannot be configured for the vFiler. Also, a CIFS setup cannot be done using active_directory. Ignored if ip-bindings element is not present and run-cifs-setup is false.</description>
        <from>storage</from>
        <to>storage</to>
      </input>
      <input global="false" required="false">
        <description>NetApp: 
[required if dynamic targeting is used otherwise optional] 

Designates a specific target (name of the DFM server where the operation will be performed) that has been defined in the adapter configuration. Valid value- Same value that has been specified for the name attribute of 'config' element in the adapter configuration . If this tag is left empty the request will be executed on the first defined adapter configuration.

for e.g for the  adapter config below , target would be 02.
&lt;configs&gt;
   &lt;config name="02"&gt;
          &lt;target&gt;172.19.224.103&lt;/target&gt;
          &lt;user-name&gt;root&lt;/user-name&gt;
          &lt;password&gt;bmcbmc&lt;/password&gt;
          &lt;protocol&gt;http&lt;/protocol&gt;
          &lt;port&gt;8088&lt;/port&gt;
   &lt;/config&gt;
&lt;/configs&gt;

Dynamic targeting: Host name or IP address of DFM.</description>
        <from>target</from>
        <to>target</to>
      </input>
      <input global="false" required="false">
        <description>NetApp:
[required only if dynamic targeting is used]
NetApp DataFabric Manager login username.</description>
        <from>username</from>
        <to>username</to>
      </input>
      <input global="false" required="false">
        <description>NetApp:
[required only if dynamic targeting is used]
NetApp DataFabric Manager login password.</description>
        <from>password</from>
        <to>password</to>
      </input>
      <input global="false" required="false">
        <description>Encryption type:

NetApp: [Conditional]  specified only when password parameter is mentioned .
You can encrypt the password by specifying the encryption type .
Valid values:  Base64,Plain.</description>
        <from>encryption type</from>
        <to>encryption type</to>
      </input>
      <input global="false" required="false">
        <description>NetApp:
[Optional and used when dynamic targeting] 
Communication protocol used by adapter. Valid value is http or https. Default value is http.</description>
        <from>protocol</from>
        <to>protocol</to>
      </input>
      <input global="false" required="false">
        <description>NetApp: 
[Optional and used when dynamic targeting]
Port on which NetApp DataFabric Manager is enabled. Default value is 8088 for http protocol and 8488 for https protocol.
</description>
        <from>port</from>
        <to>port</to>
      </input>
      <output global="false" required="false">
        <description>String Value - Indicates whether or not the process completed successfully. 

Valid values: success or failure</description>
        <to>success status</to>
        <from>success status</from>
      </output>
      <output global="false" required="false">
        <description>String Value - A process specific explanation for the value of success status, incase of failure.</description>
        <to>status message</to>
        <from>status message</from>
      </output>
      <output global="false" required="false">
        <description>String or XML value - Contains required output, incase of success.</description>
        <to>output</to>
        <from>output</from>
      </output>
    </parameters>
    <access />
    <sequence>
      <call-process>
        <process-name>:AutoPilot-OA-Storage_Management:Utilities:Extract Configuration Data</process-name>
        <parameters>
          <input>
            <from>configuration name</from>
            <to>configuration name</to>
          </input>
          <output>
            <from>success status</from>
            <to>success status</to>
          </output>
          <output>
            <from>version</from>
            <to>version</to>
          </output>
          <output>
            <from>module configuration items</from>
            <to>module configuration items</to>
          </output>
        </parameters>
        <meta>
          <documentation />
          <run-mode-handling>
            <run-mode>OCP</run-mode>
            <allow-step-into>false</allow-step-into>
          </run-mode-handling>
          <checkpoint>false</checkpoint>
        </meta>
        <after-execution>
          <console-output>
            <type>INFO</type>
            <summary>
              <concat>
                <input>
                  <value></value>
                </input>
              </concat>
            </summary>
            <detail>
              <concat>
                <input>
                  <value></value>
                </input>
              </concat>
            </detail>
          </console-output>
        </after-execution>
        <location>:call-process[1]</location>
      </call-process>
      <switch>
        <meta>
          <documentation />
          <run-mode-handling>
            <run-mode>OCP</run-mode>
            <allow-step-into>true</allow-step-into>
          </run-mode-handling>
          <checkpoint>false</checkpoint>
        </meta>
        <execute-all-applicable-cases>false</execute-all-applicable-cases>
        <default>
          <sequence>
            <assign>
              <assignment>
                <output>
                  <to>success status</to>
                  <value>failure</value>
                </output>
              </assignment>
              <assignment>
                <document>
                  <input>
                    <from>configuration name</from>
                  </input>
                </document>
                <result>
                  <output>
                    <to>status message</to>
                  </output>
                </result>
                <xpath-expression>
                  <xpath-replacement-tokens />
                  <xpath><![CDATA[concat("Unknown configuration name " , .)]]></xpath>
                </xpath-expression>
              </assignment>
              <meta>
                <documentation />
                <checkpoint>false</checkpoint>
              </meta>
              <location>:switch[1]:sequence[1]:assign[1]</location>
            </assign>
          </sequence>
        </default>
        <case applies-if-any-condition-true="false">
          <condition>
            <document>
              <input>
                <from>success status</from>
              </input>
            </document>
            <xpath-expression>
              <xpath-replacement-tokens />
              <xpath><![CDATA[text()= 'success']]></xpath>
            </xpath-expression>
          </condition>
          <condition>
            <document>
              <input>
                <from>configuration name</from>
              </input>
            </document>
            <xpath-expression>
              <xpath-replacement-tokens />
              <xpath><![CDATA[text()= 'NetApp']]></xpath>
            </xpath-expression>
          </condition>
          <sequence>
            <console-output>
              <type>INFO</type>
              <summary>
                <concat>
                  <input>
                    <value></value>
                  </input>
                </concat>
              </summary>
              <detail>
                <concat>
                  <input>
                    <value></value>
                  </input>
                </concat>
              </detail>
            </console-output>
            <assign>
              <assignment>
                <document>
                  <input>
                    <from>storage</from>
                  </input>
                </document>
                <result>
                  <output>
                    <to>items</to>
                  </output>
                </result>
                <xslt-stylesheet>
                  <stylesheet-replacement-tokens>
                    <replacement-token name="target">
                      <input global="false">
                        <from>target</from>
                      </input>
                    </replacement-token>
                    <replacement-token name="username">
                      <input global="false">
                        <from>username</from>
                      </input>
                    </replacement-token>
                    <replacement-token name="password">
                      <input global="false">
                        <from>password</from>
                      </input>
                    </replacement-token>
                    <replacement-token name="encryption type">
                      <input global="false">
                        <from>encryption type</from>
                      </input>
                    </replacement-token>
                    <replacement-token name="protocol">
                      <input global="false">
                        <from>protocol</from>
                      </input>
                    </replacement-token>
                    <replacement-token name="port">
                      <input global="false">
                        <from>port</from>
                      </input>
                    </replacement-token>
                  </stylesheet-replacement-tokens>
                  <stylesheet><![CDATA[<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
  <xsl:output indent="no" />
  <xsl:template match="/">
    <items>
      <item>
        <xsl:if test="string-length('${target}') &gt; 0 and string-length('${username}') =0">
          <target>
            <xsl:value-of select="'${target}'" disable-output-escaping="no" />
          </target>
        </xsl:if>
        <vfiler-name-or-id>
          <xsl:value-of select="//vfiler-name-or-id/text()" disable-output-escaping="no" />
        </vfiler-name-or-id>
        <xsl:if test=" name(//allowed-protocols) ">
          <xsl:copy-of select="//allowed-protocols" />
        </xsl:if>
        <cifs-domain-password>
          <xsl:value-of select="//cifs-domain-password/text()" disable-output-escaping="no" />
        </cifs-domain-password>
        <cifs-domain-user>
          <xsl:value-of select="//cifs-domain-user/text()" disable-output-escaping="no" />
        </cifs-domain-user>
        <cifs-workgroup-name>
          <xsl:value-of select="//cifs-workgroup-name/text()" disable-output-escaping="no" />
        </cifs-workgroup-name>
        <xsl:if test=" name(//ip-bindings) ">
          <xsl:copy-of select="//ip-bindings" />
        </xsl:if>
        <xsl:if test="string-length(//root-password/text())&gt;0">
          <root-password>
            <xsl:value-of select="//root-password/text()" disable-output-escaping="no" />
          </root-password>
        </xsl:if>
        <run-cifs-setup>
          <xsl:value-of select="//run-cifs-setup/text()" disable-output-escaping="no" />
        </run-cifs-setup>
        <script-path>
          <xsl:value-of select="//script-path/text()" disable-output-escaping="no" />
        </script-path>
        <vfiler-template-name-or-id>
          <xsl:value-of select="//vfiler-template-name-or-id/text()" disable-output-escaping="no" />
        </vfiler-template-name-or-id>
        <xsl:if test="string-length('${target}')&gt;0 and string-length('${username}') &gt; 0">
          <targets>
            <target>
              <host>
                <xsl:value-of select="'${target}'" disable-output-escaping="no" />
              </host>
              <user-name>${username}</user-name>
              <password>
                <xsl:attribute name="encryption-type">
                  <xsl:value-of select="'${encryption type}'" disable-output-escaping="no" />
                </xsl:attribute>
                <xsl:value-of select="'${password}'" disable-output-escaping="no" />
              </password>
              <xsl:if test="string-length('${protocol}') &gt;0">
                <protocol>${protocol}</protocol>
              </xsl:if>
              <xsl:if test="string-length('${port}') &gt;0">
                <port>${port}</port>
              </xsl:if>
            </target>
          </targets>
        </xsl:if>
      </item>
    </items>
  </xsl:template>
</xsl:stylesheet>]]></stylesheet>
                </xslt-stylesheet>
              </assignment>
              <meta>
                <documentation />
                <checkpoint>false</checkpoint>
              </meta>
              <location>:switch[1]:sequence[2]:assign[1]</location>
            </assign>
            <call-process>
              <process-name>:AO-AD-NetAPP_Storage:v4.0:VFiler:Setup VFiler</process-name>
              <parameters>
                <input>
                  <from>module configuration items</from>
                  <to>adapter name</to>
                  <xpath-expression>
                    <xpath-replacement-tokens>
                      <replacement-token name="configuration name">
                        <input global="false">
                          <from>configuration name</from>
                        </input>
                      </replacement-token>
                    </xpath-replacement-tokens>
                    <xpath><![CDATA[//$[configuration name]/Adapter/text()]]></xpath>
                  </xpath-expression>
                </input>
                <input>
                  <from>items</from>
                  <to>items</to>
                </input>
                <output>
                  <from>adapter response</from>
                  <to>adapter response</to>
                </output>
              </parameters>
              <meta>
                <documentation />
                <run-mode-handling>
                  <run-mode>OCP</run-mode>
                  <allow-step-into>false</allow-step-into>
                </run-mode-handling>
                <checkpoint>false</checkpoint>
              </meta>
              <after-execution>
                <console-output>
                  <type>INFO</type>
                  <summary>
                    <concat>
                      <input>
                        <value></value>
                      </input>
                    </concat>
                  </summary>
                  <detail>
                    <concat>
                      <input>
                        <value></value>
                      </input>
                    </concat>
                  </detail>
                </console-output>
              </after-execution>
              <location>:switch[1]:sequence[2]:call-process[1]</location>
            </call-process>
            <switch>
              <meta>
                <documentation />
                <run-mode-handling>
                  <run-mode>OCP</run-mode>
                  <allow-step-into>true</allow-step-into>
                </run-mode-handling>
                <checkpoint>false</checkpoint>
              </meta>
              <execute-all-applicable-cases>false</execute-all-applicable-cases>
              <default>
                <sequence>
                  <assign>
                    <assignment>
                      <output>
                        <to>success status</to>
                        <value>failure</value>
                      </output>
                    </assignment>
                    <assignment>
                      <document>
                        <input>
                          <from>adapter response</from>
                        </input>
                      </document>
                      <result>
                        <output>
                          <to>status message</to>
                        </output>
                      </result>
                      <xpath-expression>
                        <xpath-replacement-tokens />
                        <xpath><![CDATA[//response/metadata/error/text()]]></xpath>
                      </xpath-expression>
                    </assignment>
                    <meta>
                      <documentation />
                      <checkpoint>false</checkpoint>
                    </meta>
                    <location>:switch[1]:sequence[2]:switch[1]:sequence[1]:assign[1]</location>
                  </assign>
                </sequence>
              </default>
              <case>
                <condition>
                  <document>
                    <input>
                      <from>adapter response</from>
                    </input>
                  </document>
                  <xpath-expression>
                    <xpath-replacement-tokens />
                    <xpath><![CDATA[string(//response/metadata/status/text())!= 'error']]></xpath>
                  </xpath-expression>
                </condition>
                <sequence>
                  <console-output>
                    <type>INFO</type>
                    <summary>
                      <concat>
                        <input>
                          <value></value>
                        </input>
                      </concat>
                    </summary>
                    <detail>
                      <concat>
                        <input>
                          <value></value>
                        </input>
                      </concat>
                    </detail>
                  </console-output>
                  <assign>
                    <assignment>
                      <output>
                        <to>success status</to>
                        <value>success</value>
                      </output>
                    </assignment>
                    <assignment>
                      <document>
                        <input>
                          <from>adapter response</from>
                        </input>
                      </document>
                      <result>
                        <output>
                          <to>output</to>
                        </output>
                      </result>
                      <xslt-stylesheet>
                        <stylesheet-replacement-tokens />
                        <stylesheet><![CDATA[<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
  <xsl:output indent="no" />
  <xsl:template match="/">
    <output>
      <xsl:copy-of select="//responses/response" />
    </output>
  </xsl:template>
</xsl:stylesheet>]]></stylesheet>
                      </xslt-stylesheet>
                    </assignment>
                    <meta>
                      <documentation />
                      <checkpoint>false</checkpoint>
                    </meta>
                    <location>:switch[1]:sequence[2]:switch[1]:sequence[2]:assign[1]</location>
                  </assign>
                </sequence>
              </case>
              <location>:switch[1]:sequence[2]:switch[1]</location>
            </switch>
          </sequence>
        </case>
        <location>:switch[1]</location>
      </switch>
    </sequence>
    <meta>
      <expose-to>
        <consumer>RULE</consumer>
        <consumer>SCHEDULE</consumer>
        <consumer>SOAP</consumer>
      </expose-to>
      <documentation>
        <description>NetApp:
Configure and setup a vFiler based on a specified vFiler template. Depending on the input a CIFS setup will also be done on the vFiler.

Dynamic targeting:Ability to communicate with multiple DFM servers which are not configured under the adapter configuration. NetApp action can be invoked using dynamic targeting / without dynamic targeting.

When Dynamic targeting is used : target would be Host name or IP address of server on which NetApp DataFabric Manager is running. It is mandatory send all the required parameters:
username, 
 password , 
 encyption type  when using dynamic targeting.

When Dynamic targeting is not used : Designates a specific target (name of the DFM server where the operation will be performed) that has been defined in the adapter configuration. Valid value- Same value that has been specified for the name attribute of 'config' element in the adapter configuration . If this tag is left empty the request will be executed on the first defined adapter configuration.

for e.g for the  adapter config below , target would be 02.
&lt;configs&gt;
  &lt;config name="02"&gt;
    &lt;target&gt;172.19.224.103&lt;/target&gt;
    &lt;user-name&gt;root&lt;/user-name&gt;
    &lt;password&gt;bmcbmc&lt;/password&gt;
    &lt;protocol&gt;http&lt;/protocol&gt;
    &lt;port&gt;8088&lt;/port&gt;
  &lt;/config&gt;
&lt;/configs&gt;
</description>
        <version></version>
      </documentation>
      <peer-location>
        <location>any</location>
      </peer-location>
      <record-metrics>false</record-metrics>
      <process-id>1f2c50ba-8281-3919-95c4-cb5495887280</process-id>
      <author>admin</author>
      <category></category>
      <status></status>
      <keywords></keywords>
      <systems></systems>
      <last-modified-by>admin</last-modified-by>
      <last-modified>1313563061793</last-modified>
    </meta>
  </process-def>
</process>