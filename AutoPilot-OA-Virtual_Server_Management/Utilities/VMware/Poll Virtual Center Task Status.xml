<process draft="false" dev-studio-version="7.6.02.00">
  <process-def name=":AutoPilot-OA-Virtual_Server_Management:Utilities:VMware:Poll Virtual Center Task Status">
    <parameters>
      <input global="false" required="true">
        <description>Unique id for each action submitted in the virtual center</description>
        <from>virtual machine task id</from>
        <to>virtual machine task id</to>
      </input>
      <input global="false" required="false">
        <description>[optional] Name/IP Address of the virtual center on which the given virtual machine is hosted</description>
        <from>virtual center</from>
        <to>virtual center</to>
      </input>
      <input global="false" required="false">
        <description>No of iterations for which the task status would be polled</description>
        <from>delay</from>
        <to>delay</to>
      </input>
      <input global="false" required="false">
        <description>[optional] 

Specifies the url for the remote soap service running on the vmware virtual center.</description>
        <from>soap url</from>
        <to>soap url</to>
      </input>
      <input global="false" required="false">
        <description>[optional] 

Specifies the user name that will be used for http basic authentication on the vmware virtual center.</description>
        <from>username</from>
        <to>username</to>
      </input>
      <input global="false" required="false">
        <description>[optional] 

Specifies the password corresponding to the specified user name.</description>
        <from>password</from>
        <to>password</to>
      </input>
      <input global="false" required="false">
        <description>[optional] 

Specifies the transport protocol for the message.</description>
        <from>transport</from>
        <to>transport</to>
      </input>
      <output global="false" required="false">
        <description>String Value - Indicates whether or not the process completed successfully. 

Valid values: success, failure, pending</description>
        <to>success status</to>
        <from>success status</from>
      </output>
      <output global="false" required="false">
        <description>String Value - A process specific explanation for the value of success status.</description>
        <to>status message</to>
        <from>status message</from>
      </output>
    </parameters>
    <access />
    <sequence>
      <switch>
        <meta>
          <documentation />
          <run-mode-handling>
            <run-mode>OCP</run-mode>
            <allow-step-into>true</allow-step-into>
          </run-mode-handling>
          <checkpoint>false</checkpoint>
        </meta>
        <execute-all-applicable-cases>false</execute-all-applicable-cases>
        <default>
          <sequence>
            <call-process>
              <process-name>:AutoPilot-OA-Virtual_Server_Management:Utilities:Extract Configuration Data</process-name>
              <parameters>
                <input>
                  <value>VMware</value>
                  <to>configuration name</to>
                </input>
                <input>
                  <from>virtual center</from>
                  <to>virtual center</to>
                </input>
                <output>
                  <from>adapter</from>
                  <to>adapter</to>
                </output>
                <output>
                  <from>version</from>
                  <to>version</to>
                </output>
                <output>
                  <from>poll task status delay</from>
                  <to>poll task status delay</to>
                </output>
              </parameters>
              <meta>
                <documentation />
                <run-mode-handling>
                  <run-mode>OCP</run-mode>
                  <allow-step-into>false</allow-step-into>
                </run-mode-handling>
                <checkpoint>false</checkpoint>
              </meta>
              <location>:switch[1]:sequence[1]:call-process[1]</location>
            </call-process>
            <call-process>
              <process-name>:RBA-AD-VMware_Infrastructure:Utilities:Construct Connection Parameters</process-name>
              <parameters>
                <input>
                  <from>username</from>
                  <to>alternate username</to>
                </input>
                <input>
                  <from>password</from>
                  <to>alternate password</to>
                </input>
                <input>
                  <from>soap url</from>
                  <to>alternate soap URL</to>
                </input>
                <input>
                  <from>transport</from>
                  <to>alternate transport</to>
                </input>
                <output>
                  <from>connection parameters</from>
                  <to>connection parameters</to>
                </output>
              </parameters>
              <meta>
                <documentation />
                <run-mode-handling>
                  <run-mode>OCP</run-mode>
                  <allow-step-into>false</allow-step-into>
                </run-mode-handling>
                <checkpoint>false</checkpoint>
              </meta>
              <after-execution>
                <console-output>
                  <type>INFO</type>
                  <summary>
                    <concat>
                      <input>
                        <value></value>
                      </input>
                    </concat>
                  </summary>
                  <detail>
                    <concat>
                      <input>
                        <value></value>
                      </input>
                    </concat>
                  </detail>
                </console-output>
              </after-execution>
              <location>:switch[1]:sequence[1]:call-process[2]</location>
            </call-process>
          </sequence>
        </default>
        <case>
          <condition>
            <document>
              <input>
                <from>soap url</from>
              </input>
            </document>
            <xpath-expression>
              <xpath-replacement-tokens>
                <replacement-token name="username">
                  <input global="false">
                    <from>username</from>
                  </input>
                </replacement-token>
                <replacement-token name="password">
                  <input global="false">
                    <from>password</from>
                  </input>
                </replacement-token>
              </xpath-replacement-tokens>
              <xpath><![CDATA[(string-length(.) = 0) or (string-length('${username}') = 0) or (string-length('${password}') = 0)]]></xpath>
            </xpath-expression>
          </condition>
          <sequence>
            <call-process>
              <process-name>:AutoPilot-OA-Virtual_Server_Management:Utilities:Extract Configuration Data</process-name>
              <parameters>
                <input>
                  <value>VMware</value>
                  <to>configuration name</to>
                </input>
                <input>
                  <from>virtual center</from>
                  <to>virtual center</to>
                </input>
                <output>
                  <from>adapter</from>
                  <to>adapter</to>
                </output>
                <output>
                  <from>version</from>
                  <to>version</to>
                </output>
                <output>
                  <from>soap url</from>
                  <to>soap url</to>
                </output>
                <output>
                  <from>username</from>
                  <to>username</to>
                </output>
                <output>
                  <from>transport</from>
                  <to>transport</to>
                </output>
                <output>
                  <from>password</from>
                  <to>password</to>
                </output>
                <output>
                  <from>poll task status delay</from>
                  <to>poll task status delay</to>
                </output>
              </parameters>
              <meta>
                <documentation />
                <run-mode-handling>
                  <run-mode>OCP</run-mode>
                  <allow-step-into>false</allow-step-into>
                </run-mode-handling>
                <checkpoint>false</checkpoint>
              </meta>
              <after-execution>
                <console-output>
                  <type>INFO</type>
                  <summary>
                    <concat>
                      <input>
                        <value></value>
                      </input>
                    </concat>
                  </summary>
                  <detail>
                    <concat>
                      <input>
                        <value></value>
                      </input>
                    </concat>
                  </detail>
                </console-output>
              </after-execution>
              <location>:switch[1]:sequence[2]:call-process[1]</location>
            </call-process>
            <call-process>
              <process-name>:RBA-AD-VMware_Infrastructure:Utilities:Construct Connection Parameters</process-name>
              <parameters>
                <input>
                  <from>username</from>
                  <to>alternate username</to>
                </input>
                <input>
                  <from>password</from>
                  <to>alternate password</to>
                </input>
                <input>
                  <from>soap url</from>
                  <to>alternate soap URL</to>
                </input>
                <input>
                  <from>transport</from>
                  <to>alternate transport</to>
                </input>
                <output>
                  <from>connection parameters</from>
                  <to>connection parameters</to>
                </output>
              </parameters>
              <meta>
                <documentation />
                <run-mode-handling>
                  <run-mode>OCP</run-mode>
                  <allow-step-into>false</allow-step-into>
                </run-mode-handling>
                <checkpoint>false</checkpoint>
              </meta>
              <after-execution>
                <console-output>
                  <type>INFO</type>
                  <summary>
                    <concat>
                      <input>
                        <value></value>
                      </input>
                    </concat>
                  </summary>
                  <detail>
                    <concat>
                      <input>
                        <value></value>
                      </input>
                    </concat>
                  </detail>
                </console-output>
              </after-execution>
              <location>:switch[1]:sequence[2]:call-process[2]</location>
            </call-process>
          </sequence>
        </case>
        <location>:switch[1]</location>
      </switch>
      <assign>
        <assignment>
          <output>
            <to>task closed</to>
            <value>false</value>
          </output>
        </assignment>
        <assignment>
          <input>
            <from>poll task status delay</from>
          </input>
          <output>
            <to>configured delay</to>
          </output>
        </assignment>
        <assignment>
          <document>
            <input>
              <from>delay</from>
            </input>
          </document>
          <result>
            <output>
              <to>count</to>
            </output>
          </result>
          <xslt-stylesheet>
            <stylesheet-replacement-tokens>
              <replacement-token name="configured delay">
                <input global="false">
                  <from>configured delay</from>
                </input>
              </replacement-token>
            </stylesheet-replacement-tokens>
            <stylesheet><![CDATA[<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
  <xsl:output indent="no" />
  <xsl:template match="/">
    <value>
      <xsl:choose>
        <xsl:when test="string-length(.) &gt; 0">
          <xsl:value-of select="." disable-output-escaping="no" />
        </xsl:when>
        <xsl:otherwise>${configured delay}</xsl:otherwise>
      </xsl:choose>
    </value>
  </xsl:template>
</xsl:stylesheet>]]></stylesheet>
          </xslt-stylesheet>
        </assignment>
        <assignment>
          <document>
            <input>
              <from>count</from>
            </input>
          </document>
          <result>
            <output>
              <to>iterator</to>
            </output>
          </result>
          <xslt-stylesheet>
            <stylesheet-replacement-tokens />
            <stylesheet><![CDATA[<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:xalan="http://xml.apache.org/xalan" version="1.0">
  <xsl:output indent="no" />
  <xsl:template match="/">
    <xsl:variable name="elements">
      <root />
    </xsl:variable>
    <xsl:call-template name="create-xml">
      <xsl:with-param name="count" select="." />
      <xsl:with-param name="xml" select="$elements" />
    </xsl:call-template>
  </xsl:template>
  <xsl:template name="create-xml">
    <xsl:param name="count" />
    <xsl:param name="xml" />
    <xsl:choose>
      <xsl:when test="count(xalan:nodeset($xml)/root/element)&lt;$count">
        <xsl:variable name="new-xml">
          <root>
            <xsl:copy-of select="xalan:nodeset($xml)/root/element" />
            <element />
          </root>
        </xsl:variable>
        <xsl:call-template name="create-xml">
          <xsl:with-param name="count" select="$count" />
          <xsl:with-param name="xml" select="$new-xml" />
        </xsl:call-template>
      </xsl:when>
      <xsl:otherwise>
        <xsl:copy-of select="$xml" />
      </xsl:otherwise>
    </xsl:choose>
  </xsl:template>
</xsl:stylesheet>]]></stylesheet>
          </xslt-stylesheet>
        </assignment>
        <meta>
          <documentation />
          <checkpoint>false</checkpoint>
        </meta>
        <location>:assign[1]</location>
      </assign>
      <for-each>
        <document>
          <input>
            <from>iterator</from>
          </input>
        </document>
        <result>
          <output>
            <to>element</to>
          </output>
        </result>
        <xpath-expression>
          <xpath-replacement-tokens />
          <xpath><![CDATA[//element]]></xpath>
        </xpath-expression>
        <meta>
          <documentation />
          <run-mode-handling>
            <run-mode>OCP</run-mode>
            <allow-step-into>true</allow-step-into>
          </run-mode-handling>
          <checkpoint>false</checkpoint>
        </meta>
        <sequence>
          <console-output>
            <type>INFO</type>
            <summary>
              <concat>
                <input>
                  <value></value>
                </input>
              </concat>
            </summary>
            <detail>
              <concat>
                <input>
                  <value></value>
                </input>
              </concat>
            </detail>
          </console-output>
          <switch>
            <meta>
              <documentation />
              <run-mode-handling>
                <run-mode>OCP</run-mode>
                <allow-step-into>true</allow-step-into>
              </run-mode-handling>
              <checkpoint>false</checkpoint>
            </meta>
            <execute-all-applicable-cases>false</execute-all-applicable-cases>
            <default>
              <sequence />
            </default>
            <case>
              <condition>
                <document>
                  <input>
                    <from>task closed</from>
                  </input>
                </document>
                <xpath-expression>
                  <xpath-replacement-tokens />
                  <xpath><![CDATA[string(.)='false']]></xpath>
                </xpath-expression>
              </condition>
              <sequence>
                <console-output>
                  <type>INFO</type>
                  <summary>
                    <concat>
                      <input>
                        <value></value>
                      </input>
                    </concat>
                  </summary>
                  <detail>
                    <concat>
                      <input>
                        <value></value>
                      </input>
                    </concat>
                  </detail>
                </console-output>
                <pause>
                  <meta>
                    <documentation />
                    <checkpoint>false</checkpoint>
                  </meta>
                  <duration>1000</duration>
                  <location>:switch[2]:sequence[2]:pause[1]</location>
                </pause>
                <call-process>
                  <process-name>:AutoPilot-OA-Virtual_Server_Management:Utilities:VMware:Get Task Status</process-name>
                  <parameters>
                    <input>
                      <from>virtual machine task id</from>
                      <to>virtual machine task id</to>
                    </input>
                    <input>
                      <from>virtual center</from>
                      <to>virtual center</to>
                    </input>
                    <input>
                      <from>soap url</from>
                      <to>soap url</to>
                    </input>
                    <input>
                      <from>username</from>
                      <to>username</to>
                    </input>
                    <input>
                      <from>password</from>
                      <to>password</to>
                    </input>
                    <input>
                      <from>transport</from>
                      <to>transport</to>
                    </input>
                    <output>
                      <from>success status</from>
                      <to>success status</to>
                    </output>
                    <output>
                      <from>status message</from>
                      <to>status message</to>
                    </output>
                    <output>
                      <from>adapter response</from>
                      <to>adapter response</to>
                    </output>
                  </parameters>
                  <meta>
                    <documentation />
                    <run-mode-handling>
                      <run-mode>OCP</run-mode>
                      <allow-step-into>false</allow-step-into>
                    </run-mode-handling>
                    <checkpoint>false</checkpoint>
                  </meta>
                  <after-execution>
                    <console-output>
                      <type>INFO</type>
                      <summary>
                        <concat>
                          <input>
                            <value></value>
                          </input>
                        </concat>
                      </summary>
                      <detail>
                        <concat>
                          <input>
                            <value></value>
                          </input>
                        </concat>
                      </detail>
                    </console-output>
                  </after-execution>
                  <location>:switch[2]:sequence[2]:call-process[1]</location>
                </call-process>
                <assign>
                  <assignment>
                    <document>
                      <input>
                        <from>adapter response</from>
                      </input>
                    </document>
                    <result>
                      <output>
                        <to>task closed</to>
                      </output>
                    </result>
                    <xslt-stylesheet>
                      <stylesheet-replacement-tokens />
                      <stylesheet><![CDATA[<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
  <xsl:output indent="no" />
  <xsl:template match="/">
    <value>
      <xsl:choose>
        <xsl:when test="string(//state/text())=&quot;success&quot; or string(//state/text())=&quot;error&quot; or string-length(//faultstring/text()) &gt; 0">
          <xsl:text disable-output-escaping="no">true</xsl:text>
        </xsl:when>
        <xsl:otherwise>
          <xsl:text disable-output-escaping="no">false</xsl:text>
        </xsl:otherwise>
      </xsl:choose>
    </value>
  </xsl:template>
</xsl:stylesheet>]]></stylesheet>
                    </xslt-stylesheet>
                  </assignment>
                  <assignment>
                    <document>
                      <input>
                        <from>adapter response</from>
                      </input>
                    </document>
                    <result>
                      <output>
                        <to>success status</to>
                      </output>
                    </result>
                    <xslt-stylesheet>
                      <stylesheet-replacement-tokens />
                      <stylesheet><![CDATA[<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
  <xsl:output indent="no" />
  <xsl:template match="/">
    <value>
      <xsl:choose>
        <xsl:when test="string(//state/text())=&quot;success&quot;">
          <xsl:text disable-output-escaping="no">success</xsl:text>
        </xsl:when>
        <xsl:when test="string(//state/text())=&quot;running&quot;">
          <xsl:text disable-output-escaping="no">pending</xsl:text>
        </xsl:when>
        <xsl:otherwise>
          <xsl:text disable-output-escaping="no">failure</xsl:text>
        </xsl:otherwise>
      </xsl:choose>
    </value>
  </xsl:template>
</xsl:stylesheet>]]></stylesheet>
                    </xslt-stylesheet>
                  </assignment>
                  <assignment>
                    <document>
                      <input>
                        <from>adapter response</from>
                      </input>
                    </document>
                    <result>
                      <output>
                        <to>status message</to>
                      </output>
                    </result>
                    <xslt-stylesheet>
                      <stylesheet-replacement-tokens />
                      <stylesheet><![CDATA[<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
  <xsl:output indent="no" />
  <xsl:template match="/">
    <value>
      <xsl:choose>
        <xsl:when test="string(//state/text())=&quot;success&quot;">
          <xsl:text disable-output-escaping="no">Action completed.</xsl:text>
        </xsl:when>
        <xsl:when test="string(//state/text())=&quot;error&quot;">
          <xsl:value-of select="//localizedMessage/text()" disable-output-escaping="no" />
        </xsl:when>
        <xsl:when test="string-length(//faultstring/text()) &gt; 0">
          <xsl:value-of select="//faultstring/text()" disable-output-escaping="no" />
        </xsl:when>
        <xsl:when test="string(//state/text())=&quot;running&quot;">
          <xsl:text disable-output-escaping="no">Action status pending.</xsl:text>
        </xsl:when>
        <xsl:otherwise>
          <xsl:text disable-output-escaping="no">Action status unknown.</xsl:text>
        </xsl:otherwise>
      </xsl:choose>
    </value>
  </xsl:template>
</xsl:stylesheet>]]></stylesheet>
                    </xslt-stylesheet>
                  </assignment>
                  <meta>
                    <documentation />
                    <checkpoint>false</checkpoint>
                  </meta>
                  <location>:switch[2]:sequence[2]:assign[1]</location>
                </assign>
              </sequence>
            </case>
            <location>:switch[2]</location>
          </switch>
        </sequence>
        <location>:for-each[1]</location>
      </for-each>
    </sequence>
    <meta>
      <expose-to>
        <consumer>RULE</consumer>
        <consumer>SCHEDULE</consumer>
      </expose-to>
      <documentation>
        <description>This action supports dynamic targeting for multiple virtual centers. For using dynamic targeting, one has to pass in the input the connection details for the target virtual center comprising of:

- soap url
- username
- password
- transport

The above parameters are optional. If one does not pass the above parameters, then the "virtual center" input parameter has to be passed.  In this case, the connection details for the given virtual center will be extracted from the module configuration.  The pre-requisite for the latter case is that the connection details for the given virtual center have to be present in module configuration of the AO Virtual Server Management module.</description>
        <version></version>
      </documentation>
      <peer-location>
        <location>any</location>
      </peer-location>
      <record-metrics>false</record-metrics>
      <author>admin</author>
      <category></category>
      <status></status>
      <keywords></keywords>
      <systems></systems>
      <last-modified-by>admin</last-modified-by>
      <last-modified>1303377482785</last-modified>
    </meta>
  </process-def>
</process>