<process draft="false" dev-studio-version="7.6.01.04">
  <process-def name=":AutoPilot-OA-Virtual_Server_Management:Utilities:VMware:Update CPU Configuration">
    <parameters>
      <input global="false" required="true">
        <description>Display name of the virtual machine</description>
        <from>vm name</from>
        <to>vm name</to>
      </input>
      <input global="false" required="true">
        <description>Number of virtual processors in a virtual machine.

Valid values: Number</description>
        <from>no of cpu</from>
        <to>no of cpu</to>
      </input>
      <input global="false" required="false">
        <description>CPU allocation reservation [optional]
        Amount of resource that is guaranteed available to the virtual machine or resource pool. Reserved resources are not wasted if they are not used. If the utilization is less than the reservation, the resources can be utilized by other running virtual machines. Unit is MHz.</description>
        <from>cpu allocation reservation</from>
        <to>cpu allocation reservation</to>
      </input>
      <input global="false" required="false">
        <description>CPU allocation limit [optional]
The utilization of a virtual machine/resource pool will not exceed this limit, even if there are available resources. This is typically used to ensure a consistent performance of virtual machines / resource pools independent of available resources. If set to -1, then there is no fixed limit on resource usage (only bounded by available resources and shares). Unit is MHz. </description>
        <from>cpu allocation limit</from>
        <to>cpu allocation limit</to>
      </input>
      <input global="false" required="false">
        <description>CPU allocation shares [optional]
The number of shares allocated. Used to determine resource allocation in case of resource contention. This value is only set if level is set to custom. If level is not set to custom, this value is ignored. Therefore, only shares with custom values can be compared. 
There is no unit for this value. It is a relative measure based on the settings for other resource pools.</description>
        <from>cpu allocation shares</from>
        <to>cpu allocation shares</to>
      </input>
      <input global="false" required="false">
        <description>CPU allocation level [optional]
          The allocation level. The level is a simplified view of shares. Levels map to a pre-determined set of numeric values for shares. If the shares value does not map to a predefined size, then the level is set as custom.

valid values: 
custom - Shares are specified in the "shares" column.  
high - Shares = 2000 * number of virtual CPUs
low - Shares = 500 * number of virtual CPUs
normal - Shares = 1000 * number of virtual CPUs</description>
        <from>cpu allocation level</from>
        <to>cpu allocation level</to>
      </input>
      <input global="false" required="false">
        <description>[optional] Name/IP Address of the virtual center on which the given virtual machine is hosted</description>
        <from>virtual center</from>
        <to>virtual center</to>
      </input>
      <input global="false" required="false">
        <description>[Optional] Number of seconds to wait before polling for the virtual center task status</description>
        <from>delay</from>
        <to>delay</to>
      </input>
      <input global="false" required="false">
        <description>[optional] 

Specifies the url for the remote soap service running on the vmware virtual center.</description>
        <from>soap url</from>
        <to>soap url</to>
      </input>
      <input global="false" required="false">
        <description>[optional] 

Specifies the user name that will be used for http basic authentication on the vmware virtual center.</description>
        <from>username</from>
        <to>username</to>
      </input>
      <input global="false" required="false">
        <description>[optional] 

Specifies the password corresponding to the specified user name.</description>
        <from>password</from>
        <to>password</to>
      </input>
      <input global="false" required="false">
        <description>[optional] 

Specifies the transport protocol for the message.</description>
        <from>transport</from>
        <to>transport</to>
      </input>
      <output global="false" required="false">
        <description>String Value - Indicates whether or not the process completed successfully. 

Valid values: success, failure, pending</description>
        <to>success status</to>
        <from>success status</from>
      </output>
      <output global="false" required="false">
        <description>String Value - A process specific explanation for the value of success status.</description>
        <to>status message</to>
        <from>status message</from>
      </output>
    </parameters>
    <access />
    <sequence>
      <switch>
        <meta>
          <documentation />
          <run-mode-handling>
            <run-mode>OCP</run-mode>
            <allow-step-into>true</allow-step-into>
          </run-mode-handling>
          <checkpoint>false</checkpoint>
        </meta>
        <execute-all-applicable-cases>false</execute-all-applicable-cases>
        <default>
          <sequence>
            <call-process>
              <process-name>:AutoPilot-OA-Virtual_Server_Management:Utilities:Extract Configuration Data</process-name>
              <parameters>
                <input>
                  <value>VMware</value>
                  <to>configuration name</to>
                </input>
                <input>
                  <from>virtual center</from>
                  <to>virtual center</to>
                </input>
                <output>
                  <from>adapter</from>
                  <to>adapter</to>
                </output>
                <output>
                  <from>version</from>
                  <to>version</to>
                </output>
              </parameters>
              <meta>
                <documentation />
                <run-mode-handling>
                  <run-mode>OCP</run-mode>
                  <allow-step-into>false</allow-step-into>
                </run-mode-handling>
                <checkpoint>false</checkpoint>
              </meta>
              <location>:switch[1]:sequence[1]:call-process[1]</location>
            </call-process>
            <call-process>
              <process-name>:RBA-AD-VMware_Infrastructure:Utilities:Construct Connection Parameters</process-name>
              <parameters>
                <input>
                  <from>username</from>
                  <to>alternate username</to>
                </input>
                <input>
                  <from>password</from>
                  <to>alternate password</to>
                </input>
                <input>
                  <from>soap url</from>
                  <to>alternate soap URL</to>
                </input>
                <input>
                  <from>transport</from>
                  <to>alternate transport</to>
                </input>
                <output>
                  <from>connection parameters</from>
                  <to>connection parameters</to>
                </output>
              </parameters>
              <meta>
                <documentation />
                <run-mode-handling>
                  <run-mode>OCP</run-mode>
                  <allow-step-into>false</allow-step-into>
                </run-mode-handling>
                <checkpoint>false</checkpoint>
              </meta>
              <after-execution>
                <console-output>
                  <type>INFO</type>
                  <summary>
                    <concat>
                      <input>
                        <value></value>
                      </input>
                    </concat>
                  </summary>
                  <detail>
                    <concat>
                      <input>
                        <value></value>
                      </input>
                    </concat>
                  </detail>
                </console-output>
              </after-execution>
              <location>:switch[1]:sequence[1]:call-process[2]</location>
            </call-process>
          </sequence>
        </default>
        <case>
          <condition>
            <document>
              <input>
                <from>soap url</from>
              </input>
            </document>
            <xpath-expression>
              <xpath-replacement-tokens>
                <replacement-token name="username">
                  <input global="false">
                    <from>username</from>
                  </input>
                </replacement-token>
                <replacement-token name="password">
                  <input global="false">
                    <from>password</from>
                  </input>
                </replacement-token>
              </xpath-replacement-tokens>
              <xpath><![CDATA[(string-length(.) = 0) or (string-length('${username}') = 0) or (string-length('${password}') = 0)]]></xpath>
            </xpath-expression>
          </condition>
          <sequence>
            <call-process>
              <process-name>:AutoPilot-OA-Virtual_Server_Management:Utilities:Extract Configuration Data</process-name>
              <parameters>
                <input>
                  <value>VMware</value>
                  <to>configuration name</to>
                </input>
                <input>
                  <from>virtual center</from>
                  <to>virtual center</to>
                </input>
                <output>
                  <from>adapter</from>
                  <to>adapter</to>
                </output>
                <output>
                  <from>version</from>
                  <to>version</to>
                </output>
                <output>
                  <from>soap url</from>
                  <to>soap url</to>
                </output>
                <output>
                  <from>username</from>
                  <to>username</to>
                </output>
                <output>
                  <from>transport</from>
                  <to>transport</to>
                </output>
                <output>
                  <from>password</from>
                  <to>password</to>
                </output>
              </parameters>
              <meta>
                <documentation />
                <run-mode-handling>
                  <run-mode>OCP</run-mode>
                  <allow-step-into>false</allow-step-into>
                </run-mode-handling>
                <checkpoint>false</checkpoint>
              </meta>
              <after-execution>
                <console-output>
                  <type>INFO</type>
                  <summary>
                    <concat>
                      <input>
                        <value></value>
                      </input>
                    </concat>
                  </summary>
                  <detail>
                    <concat>
                      <input>
                        <value></value>
                      </input>
                    </concat>
                  </detail>
                </console-output>
              </after-execution>
              <location>:switch[1]:sequence[2]:call-process[1]</location>
            </call-process>
            <call-process>
              <process-name>:RBA-AD-VMware_Infrastructure:Utilities:Construct Connection Parameters</process-name>
              <parameters>
                <input>
                  <from>username</from>
                  <to>alternate username</to>
                </input>
                <input>
                  <from>password</from>
                  <to>alternate password</to>
                </input>
                <input>
                  <from>soap url</from>
                  <to>alternate soap URL</to>
                </input>
                <input>
                  <from>transport</from>
                  <to>alternate transport</to>
                </input>
                <output>
                  <from>connection parameters</from>
                  <to>connection parameters</to>
                </output>
              </parameters>
              <meta>
                <documentation />
                <run-mode-handling>
                  <run-mode>OCP</run-mode>
                  <allow-step-into>false</allow-step-into>
                </run-mode-handling>
                <checkpoint>false</checkpoint>
              </meta>
              <after-execution>
                <console-output>
                  <type>INFO</type>
                  <summary>
                    <concat>
                      <input>
                        <value></value>
                      </input>
                    </concat>
                  </summary>
                  <detail>
                    <concat>
                      <input>
                        <value></value>
                      </input>
                    </concat>
                  </detail>
                </console-output>
              </after-execution>
              <location>:switch[1]:sequence[2]:call-process[2]</location>
            </call-process>
          </sequence>
        </case>
        <location>:switch[1]</location>
      </switch>
      <call-process>
        <process-name>:AutoPilot-OA-Virtual_Server_Management:Utilities:VMware:Get VM Power Status</process-name>
        <parameters>
          <input>
            <from>vm name</from>
            <to>vm name</to>
          </input>
          <input>
            <from>virtual center</from>
            <to>virtual center</to>
          </input>
          <input>
            <from>soap url</from>
            <to>soap url</to>
          </input>
          <input>
            <from>username</from>
            <to>username</to>
          </input>
          <input>
            <from>password</from>
            <to>password</to>
          </input>
          <input>
            <from>transport</from>
            <to>transport</to>
          </input>
          <output>
            <from>success status</from>
            <to>success status</to>
          </output>
          <output>
            <from>status message</from>
            <to>status message</to>
          </output>
          <output>
            <from>powerStatus</from>
            <to>powerStatus</to>
          </output>
        </parameters>
        <meta>
          <documentation />
          <run-mode-handling>
            <run-mode>OCP</run-mode>
            <allow-step-into>false</allow-step-into>
          </run-mode-handling>
          <checkpoint>false</checkpoint>
        </meta>
        <after-execution>
          <console-output>
            <type>INFO</type>
            <summary>
              <concat>
                <input>
                  <value></value>
                </input>
              </concat>
            </summary>
            <detail>
              <concat>
                <input>
                  <value></value>
                </input>
              </concat>
            </detail>
          </console-output>
        </after-execution>
        <location>:call-process[1]</location>
      </call-process>
      <switch>
        <meta>
          <documentation />
          <run-mode-handling>
            <run-mode>OCP</run-mode>
            <allow-step-into>true</allow-step-into>
          </run-mode-handling>
          <checkpoint>false</checkpoint>
        </meta>
        <execute-all-applicable-cases>false</execute-all-applicable-cases>
        <default>
          <sequence>
            <assign>
              <assignment>
                <document>
                  <input>
                    <from>status message</from>
                  </input>
                </document>
                <result>
                  <output>
                    <to>status message</to>
                  </output>
                </result>
                <xslt-stylesheet>
                  <stylesheet-replacement-tokens>
                    <replacement-token name="power status">
                      <input global="false">
                        <from>powerStatus</from>
                      </input>
                    </replacement-token>
                  </stylesheet-replacement-tokens>
                  <stylesheet><![CDATA[<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
  <xsl:output indent="no" />
  <xsl:template match="/">
    <element>
      <xsl:choose>
        <xsl:when test="string('${power status}') = &quot;Started&quot; or string('${power status}') = &quot;Suspended&quot;">
          <xsl:text disable-output-escaping="no">Virtual machine is in ${power status} state.  Please power off the virtual machine and try again.</xsl:text>
        </xsl:when>
        <xsl:otherwise>
          <xsl:value-of select="." disable-output-escaping="no" />
        </xsl:otherwise>
      </xsl:choose>
    </element>
  </xsl:template>
</xsl:stylesheet>]]></stylesheet>
                </xslt-stylesheet>
              </assignment>
              <assignment>
                <output>
                  <to>success status</to>
                  <value>failure</value>
                </output>
              </assignment>
              <meta>
                <documentation />
                <checkpoint>false</checkpoint>
              </meta>
              <location>:switch[2]:sequence[1]:assign[1]</location>
            </assign>
          </sequence>
        </default>
        <case>
          <condition>
            <document>
              <input>
                <from>powerStatus</from>
              </input>
            </document>
            <xpath-expression>
              <xpath-replacement-tokens />
              <xpath><![CDATA[string(.) = 'Stopped']]></xpath>
            </xpath-expression>
          </condition>
          <sequence>
            <console-output>
              <type>INFO</type>
              <summary>
                <concat>
                  <input>
                    <value></value>
                  </input>
                </concat>
              </summary>
              <detail>
                <concat>
                  <input>
                    <value></value>
                  </input>
                </concat>
              </detail>
            </console-output>
            <call-process>
              <process-name>:RBA-AD-VMware_Infrastructure:Utilities:VM_Configuration_Operations:Construct Item for Update CPU Configuration</process-name>
              <parameters>
                <input>
                  <from>vm name</from>
                  <to>virtual machine</to>
                </input>
                <input>
                  <from>no of cpu</from>
                  <to>number of CPUs</to>
                </input>
                <input>
                  <from>cpu allocation reservation</from>
                  <to>CPU allocation reservation</to>
                </input>
                <input>
                  <from>cpu allocation limit</from>
                  <to>CPU allocation limit</to>
                </input>
                <input>
                  <from>cpu allocation shares</from>
                  <to>CPU allocation shares</to>
                </input>
                <input>
                  <from>cpu allocation level</from>
                  <to>CPU allocation level</to>
                </input>
                <output>
                  <from>items</from>
                  <to>items</to>
                </output>
              </parameters>
              <meta>
                <documentation />
                <run-mode-handling>
                  <run-mode>OCP</run-mode>
                  <allow-step-into>false</allow-step-into>
                </run-mode-handling>
                <checkpoint>false</checkpoint>
              </meta>
              <after-execution>
                <console-output>
                  <type>INFO</type>
                  <summary>
                    <concat>
                      <input>
                        <value></value>
                      </input>
                    </concat>
                  </summary>
                  <detail>
                    <concat>
                      <input>
                        <value></value>
                      </input>
                    </concat>
                  </detail>
                </console-output>
              </after-execution>
              <location>:switch[2]:sequence[2]:call-process[1]</location>
            </call-process>
            <call-process>
              <process-name>:RBA-AD-VMware_Infrastructure:Update Items</process-name>
              <parameters>
                <input>
                  <from>adapter</from>
                  <to>adapter name</to>
                </input>
                <input>
                  <from>items</from>
                  <to>items</to>
                </input>
                <input>
                  <value>Update_CPU_Configuration</value>
                  <to>item type</to>
                </input>
                <input>
                  <from>version</from>
                  <to>version</to>
                </input>
                <input>
                  <from>connection parameters</from>
                  <to>connection parameters</to>
                </input>
                <output>
                  <from>adapter response</from>
                  <to>adapter response</to>
                </output>
              </parameters>
              <meta>
                <documentation />
                <run-mode-handling>
                  <run-mode>OCP</run-mode>
                  <allow-step-into>false</allow-step-into>
                </run-mode-handling>
                <checkpoint>false</checkpoint>
              </meta>
              <after-execution>
                <console-output>
                  <type>INFO</type>
                  <summary>
                    <concat>
                      <input>
                        <value></value>
                      </input>
                    </concat>
                  </summary>
                  <detail>
                    <concat>
                      <input>
                        <value></value>
                      </input>
                    </concat>
                  </detail>
                </console-output>
              </after-execution>
              <location>:switch[2]:sequence[2]:call-process[2]</location>
            </call-process>
            <switch>
              <meta>
                <documentation />
                <run-mode-handling>
                  <run-mode>OCP</run-mode>
                  <allow-step-into>true</allow-step-into>
                </run-mode-handling>
                <checkpoint>false</checkpoint>
              </meta>
              <execute-all-applicable-cases>false</execute-all-applicable-cases>
              <default>
                <sequence>
                  <assign>
                    <assignment>
                      <document>
                        <input>
                          <concat>
                            <input>
                              <value>failure</value>
                            </input>
                          </concat>
                        </input>
                      </document>
                      <result>
                        <output>
                          <to>success status</to>
                        </output>
                      </result>
                      <xslt-stylesheet>
                        <stylesheet-replacement-tokens />
                        <stylesheet><![CDATA[<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
  <xsl:output indent="no" />
  <xsl:template match="/">
    <element>
      <xsl:choose>
        <xsl:when test="string(//status/text()) = 'success' and string-length(//faultstring/text()) = 0">
          <xsl:text disable-output-escaping="no">success</xsl:text>
        </xsl:when>
        <xsl:otherwise>
          <xsl:text disable-output-escaping="no">failure</xsl:text>
        </xsl:otherwise>
      </xsl:choose>
    </element>
  </xsl:template>
</xsl:stylesheet>]]></stylesheet>
                      </xslt-stylesheet>
                    </assignment>
                    <assignment>
                      <document>
                        <input>
                          <from>adapter response</from>
                        </input>
                      </document>
                      <result>
                        <output>
                          <to>status message</to>
                        </output>
                      </result>
                      <xpath-expression>
                        <xpath-replacement-tokens />
                        <xpath><![CDATA[//faultstring/text()]]></xpath>
                      </xpath-expression>
                    </assignment>
                    <meta>
                      <documentation />
                      <checkpoint>false</checkpoint>
                    </meta>
                    <location>:switch[2]:sequence[2]:switch[1]:sequence[1]:assign[1]</location>
                  </assign>
                </sequence>
              </default>
              <case>
                <condition>
                  <document>
                    <input>
                      <from>adapter response</from>
                    </input>
                  </document>
                  <xpath-expression>
                    <xpath-replacement-tokens />
                    <xpath><![CDATA[string-length(//Task/text()) > 0]]></xpath>
                  </xpath-expression>
                </condition>
                <sequence>
                  <console-output>
                    <type>INFO</type>
                    <summary>
                      <concat>
                        <input>
                          <value></value>
                        </input>
                      </concat>
                    </summary>
                    <detail>
                      <concat>
                        <input>
                          <value></value>
                        </input>
                      </concat>
                    </detail>
                  </console-output>
                  <call-process>
                    <process-name>:AutoPilot-OA-Virtual_Server_Management:Utilities:VMware:Poll Virtual Center Task Status</process-name>
                    <parameters>
                      <input>
                        <from>adapter response</from>
                        <to>virtual machine task id</to>
                        <xpath-expression>
                          <xpath-replacement-tokens />
                          <xpath><![CDATA[//Task/text()]]></xpath>
                        </xpath-expression>
                      </input>
                      <input>
                        <from>virtual center</from>
                        <to>virtual center</to>
                      </input>
                      <input>
                        <from>delay</from>
                        <to>delay</to>
                      </input>
                      <input>
                        <from>soap url</from>
                        <to>soap url</to>
                      </input>
                      <input>
                        <from>username</from>
                        <to>username</to>
                      </input>
                      <input>
                        <from>password</from>
                        <to>password</to>
                      </input>
                      <input>
                        <from>transport</from>
                        <to>transport</to>
                      </input>
                      <output>
                        <from>success status</from>
                        <to>success status</to>
                      </output>
                      <output>
                        <from>status message</from>
                        <to>status message</to>
                      </output>
                    </parameters>
                    <meta>
                      <documentation />
                      <run-mode-handling>
                        <run-mode>OCP</run-mode>
                        <allow-step-into>false</allow-step-into>
                      </run-mode-handling>
                      <checkpoint>false</checkpoint>
                    </meta>
                    <after-execution>
                      <console-output>
                        <type>INFO</type>
                        <summary>
                          <concat>
                            <input>
                              <value></value>
                            </input>
                          </concat>
                        </summary>
                        <detail>
                          <concat>
                            <input>
                              <value></value>
                            </input>
                          </concat>
                        </detail>
                      </console-output>
                    </after-execution>
                    <location>:switch[2]:sequence[2]:switch[1]:sequence[2]:call-process[1]</location>
                  </call-process>
                </sequence>
              </case>
              <location>:switch[2]:sequence[2]:switch[1]</location>
            </switch>
          </sequence>
        </case>
        <location>:switch[2]</location>
      </switch>
    </sequence>
    <meta>
      <expose-to>
        <consumer>RULE</consumer>
        <consumer>SCHEDULE</consumer>
      </expose-to>
      <documentation>
        <description>Modifies cpu configuration parameters on a VM.

This action supports dynamic targeting for multiple virtual centers. For using dynamic targeting, one has to pass in the input the connection details for the target virtual center comprising of:

- soap url
- username
- password
- transport

The above parameters are optional. If one does not pass the above parameters, then the "virtual center" input parameter has to be passed.  In this case, the connection details for the given virtual center will be extracted from the module configuration.  The pre-requisite for the latter case is that the connection details for the given virtual center have to be present in module configuration of the AO Virtual Server Management module.
</description>
        <version></version>
      </documentation>
      <peer-location>
        <location>any</location>
      </peer-location>
      <record-metrics>false</record-metrics>
      <author>admin</author>
      <category></category>
      <status></status>
      <keywords></keywords>
      <systems></systems>
      <last-modified-by>admin</last-modified-by>
      <last-modified>1295943478979</last-modified>
    </meta>
  </process-def>
</process>