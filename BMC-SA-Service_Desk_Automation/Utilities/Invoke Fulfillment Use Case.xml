<process draft="false" dev-studio-version="7.8.00">
  <process-def name=":BMC-SA-Service_Desk_Automation:Utilities:Invoke Fulfillment Use Case">
    <parameters>
      <input global="false" required="true">
        <description>&lt;bao-process-data&gt;
  &lt;metadata&gt;
    &lt;!-- Target server name or IP Address and port information --&gt;
    &lt;target-name /&gt;
    &lt;!-- Request type, like 'Reset Password' or 'Unlock Account'--&gt;
    &lt;request-type /&gt;
    &lt;!-- Indicates data type of the response data. Supported values: text/xml --&gt;
    &lt;data-type /&gt;
    &lt;!-- success or failure --&gt;
    &lt;status /&gt;
    &lt;!-- Runbook specific error code, in case of failure --&gt;
    &lt;error-code /&gt;
    &lt;!-- Summary error text, in case of failure --&gt;
    &lt;error-summary /&gt;
    &lt;!-- Detailed error text, in case of failure --&gt;
    &lt;error-detail /&gt;
    &lt;!-- Resolution text, in case of failure --&gt;
    &lt;resolution-steps /&gt;
    &lt;!-- Time taken to fulfill the request, success or failure --&gt;
    &lt;time-taken-seconds /&gt;
    &lt;!-- location of any external log file or record --&gt;
    &lt;log-info /&gt;
  &lt;/metadata&gt;
  &lt;!-- Contains data to be updated by a process. Should represent name/value pairs,
  where tag name is the field name to be updated and value is the new value --&gt;
  &lt;request-data&gt;
&lt;fulfillment-input&gt;
Incident ID=INC000000000804,ActionType=Unlock Account,Source=Incident
&lt;/fulfillment-input&gt;
&lt;/request-data&gt;
  &lt;!-- Details of the response from the target server --&gt;
  &lt;response-data /&gt;
&lt;/bao-process-data&gt;</description>
        <from>bao process data</from>
        <to>bao process data</to>
      </input>
      <output global="false" required="false">
        <to>response xml</to>
        <from>response xml</from>
      </output>
    </parameters>
    <access />
    <sequence>
      <call-process>
        <process-name>:BMC-SA-Service_Desk_Automation:Utilities:Set Start Time</process-name>
        <unique-id>c113440d-ac61-4f97-bc14-2607426fd912</unique-id>
        <parameters>
          <output>
            <from>start time</from>
            <to>start time</to>
          </output>
        </parameters>
        <meta>
          <documentation />
          <run-mode-handling>
            <run-mode>OCP</run-mode>
            <allow-step-into>false</allow-step-into>
          </run-mode-handling>
          <checkpoint>false</checkpoint>
        </meta>
        <location>:call-process[1]</location>
      </call-process>
      <call-process>
        <process-name>:BMC-SA-Service_Desk_Automation:Utilities:Read Configuration</process-name>
        <parameters>
          <input>
            <value>BAOEventForFulfillment</value>
            <to>configuration group</to>
          </input>
          <output>
            <from>configuration xml</from>
            <to>configuration xml</to>
          </output>
        </parameters>
        <meta>
          <documentation />
          <run-mode-handling>
            <run-mode>OCP</run-mode>
            <allow-step-into>false</allow-step-into>
          </run-mode-handling>
          <checkpoint>false</checkpoint>
        </meta>
        <after-execution>
          <log>
            <level>debug</level>
            <parameters>
              <input>
                <from>configuration xml</from>
              </input>
            </parameters>
          </log>
        </after-execution>
        <location>:call-process[2]</location>
      </call-process>
      <switch>
        <meta>
          <documentation />
          <run-mode-handling>
            <run-mode>OCP</run-mode>
            <allow-step-into>true</allow-step-into>
          </run-mode-handling>
          <checkpoint>false</checkpoint>
        </meta>
        <execute-all-applicable-cases>false</execute-all-applicable-cases>
        <default>
          <sequence>
            <call-process>
              <process-name>:BMC-SA-Service_Desk_Automation:Utilities:Create Response For Invalid Configuration</process-name>
              <parameters>
                <input>
                  <value>Invoke fulfillment use case</value>
                  <to>request type</to>
                </input>
                <input>
                  <from>start time</from>
                  <to>start time</to>
                </input>
                <output>
                  <from>response xml</from>
                  <to>response xml</to>
                </output>
              </parameters>
              <meta>
                <documentation />
                <run-mode-handling>
                  <run-mode>OCP</run-mode>
                  <allow-step-into>false</allow-step-into>
                </run-mode-handling>
                <checkpoint>false</checkpoint>
              </meta>
              <location>:switch[1]:sequence[1]:call-process[1]</location>
            </call-process>
          </sequence>
        </default>
        <case>
          <condition>
            <document>
              <input>
                <from>configuration xml</from>
              </input>
            </document>
            <xpath-expression>
              <xpath-replacement-tokens />
              <xpath><![CDATA[//DefaultInvocationEventType]]></xpath>
            </xpath-expression>
            <xpath-expression>
              <xpath-replacement-tokens />
              <xpath><![CDATA[//text()]]></xpath>
            </xpath-expression>
            <xpath-expression>
              <xpath-replacement-tokens />
              <xpath><![CDATA[lower-case(.)]]></xpath>
            </xpath-expression>
            <xpath-expression>
              <xpath-replacement-tokens />
              <xpath><![CDATA[string(.) = "remedy"]]></xpath>
            </xpath-expression>
          </condition>
          <sequence>
            <assign>
              <assignment>
                <document>
                  <input>
                    <from>configuration xml</from>
                  </input>
                </document>
                <result>
                  <output>
                    <to>alert id</to>
                  </output>
                </result>
                <xpath-expression>
                  <xpath-replacement-tokens />
                  <xpath><![CDATA[normalize-space(//RemedyEventDetails/ID/text())]]></xpath>
                </xpath-expression>
              </assignment>
              <assignment>
                <document>
                  <input>
                    <from>configuration xml</from>
                  </input>
                </document>
                <result>
                  <output>
                    <to>source</to>
                  </output>
                </result>
                <xpath-expression>
                  <xpath-replacement-tokens />
                  <xpath><![CDATA[normalize-space(//RemedyEventDetails/Alert_Source/text())]]></xpath>
                </xpath-expression>
              </assignment>
              <assignment>
                <document>
                  <input>
                    <from>configuration xml</from>
                  </input>
                </document>
                <result>
                  <output>
                    <to>alert user</to>
                  </output>
                </result>
                <xpath-expression>
                  <xpath-replacement-tokens />
                  <xpath><![CDATA[normalize-space(//RemedyEventDetails/Alert_User/text())]]></xpath>
                </xpath-expression>
              </assignment>
              <assignment>
                <document>
                  <input>
                    <from>bao process data</from>
                  </input>
                </document>
                <result>
                  <output>
                    <to>input data</to>
                  </output>
                </result>
                <xpath-expression>
                  <xpath-replacement-tokens />
                  <xpath><![CDATA[//fulfillment-input/text()]]></xpath>
                </xpath-expression>
              </assignment>
              <assignment>
                <document>
                  <input>
                    <from>bao process data</from>
                  </input>
                </document>
                <result>
                  <output>
                    <to>items</to>
                  </output>
                </result>
                <xslt-stylesheet>
                  <stylesheet-replacement-tokens>
                    <replacement-token name="source">
                      <input global="false">
                        <from>source</from>
                      </input>
                    </replacement-token>
                    <replacement-token name="alert id">
                      <input global="false">
                        <from>alert id</from>
                      </input>
                    </replacement-token>
                    <replacement-token name="alert user">
                      <input global="false">
                        <from>alert user</from>
                      </input>
                    </replacement-token>
                    <replacement-token name="input data">
                      <input global="false">
                        <from>input data</from>
                      </input>
                    </replacement-token>
                  </stylesheet-replacement-tokens>
                  <stylesheet><![CDATA[<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
  <xsl:output indent="no" />
  <xsl:template match="/">
    <items>
      <item>
        <schema>
          <xsl:text disable-output-escaping="no">Alert Events</xsl:text>
        </schema>
        <fields>
          <values>
            <field id="704">
              <xsl:text disable-output-escaping="no">${input data}</xsl:text>
            </field>
            <field id="705">${alert id}</field>
            <field id="2">${alert user}</field>
            <field id="4">${source}</field>
          </values>
        </fields>
      </item>
    </items>
  </xsl:template>
</xsl:stylesheet>]]></stylesheet>
                </xslt-stylesheet>
              </assignment>
              <meta>
                <documentation />
                <checkpoint>false</checkpoint>
              </meta>
              <before-execution>
                <log>
                  <level>debug</level>
                  <parameters>
                    <input>
                      <value>Fulfillment data</value>
                    </input>
                    <input>
                      <from>bao process data</from>
                    </input>
                  </parameters>
                </log>
              </before-execution>
              <location>:switch[1]:sequence[2]:assign[1]</location>
            </assign>
            <call-process>
              <process-name>:AMP-AD-BMC-Remedy-ARS:Create Items</process-name>
              <parameters>
                <input>
                  <from>configuration xml</from>
                  <to>adapter name</to>
                  <xpath-expression>
                    <xpath-replacement-tokens />
                    <xpath><![CDATA[normalize-space(//RemedyEventDetails/Default_Adapter_Name/text())]]></xpath>
                  </xpath-expression>
                </input>
                <input>
                  <from>items</from>
                  <to>items</to>
                </input>
                <input>
                  <from>configuration xml</from>
                  <to>version</to>
                  <xpath-expression>
                    <xpath-replacement-tokens />
                    <xpath><![CDATA[normalize-space(//RemedyEventDetails/version/text())]]></xpath>
                  </xpath-expression>
                </input>
                <output>
                  <from>adapter response</from>
                  <to>adapter response</to>
                </output>
              </parameters>
              <meta>
                <documentation />
                <run-mode-handling>
                  <run-mode>OCP</run-mode>
                  <allow-step-into>false</allow-step-into>
                </run-mode-handling>
                <checkpoint>false</checkpoint>
              </meta>
              <location>:switch[1]:sequence[2]:call-process[1]</location>
            </call-process>
            <call-process>
              <process-name>:BMC-SA-Service_Desk_Automation:Utilities:Create Response</process-name>
              <parameters>
                <input>
                  <from>adapter response</from>
                  <to>success status</to>
                </input>
                <input>
                  <from>start time</from>
                  <to>start time</to>
                </input>
                <input>
                  <value>Unknown</value>
                  <to>target name</to>
                </input>
                <input>
                  <value>Invoke fulfillment use case</value>
                  <to>request type</to>
                </input>
                <input>
                  <from>adapter response</from>
                  <to>target response</to>
                </input>
                <input>
                  <from>bao process data</from>
                  <to>fulfillment response</to>
                </input>
                <input>
                  <value>xml</value>
                  <to>data type</to>
                </input>
                <input>
                  <value>Invoke fulfillment use case failed.</value>
                  <to>error summary</to>
                </input>
                <output>
                  <from>response xml</from>
                  <to>response xml</to>
                </output>
              </parameters>
              <meta>
                <documentation />
                <run-mode-handling>
                  <run-mode>OCP</run-mode>
                  <allow-step-into>true</allow-step-into>
                </run-mode-handling>
                <checkpoint>false</checkpoint>
              </meta>
              <location>:switch[1]:sequence[2]:call-process[2]</location>
            </call-process>
          </sequence>
        </case>
        <case>
          <condition>
            <document>
              <input>
                <from>configuration xml</from>
              </input>
            </document>
            <xpath-expression>
              <xpath-replacement-tokens />
              <xpath><![CDATA[//DefaultInvocationEventType]]></xpath>
            </xpath-expression>
            <xpath-expression>
              <xpath-replacement-tokens />
              <xpath><![CDATA[//text()]]></xpath>
            </xpath-expression>
            <xpath-expression>
              <xpath-replacement-tokens />
              <xpath><![CDATA[normalize-space(.)]]></xpath>
            </xpath-expression>
            <xpath-expression>
              <xpath-replacement-tokens />
              <xpath><![CDATA[lower-case(.)]]></xpath>
            </xpath-expression>
            <xpath-expression>
              <xpath-replacement-tokens />
              <xpath><![CDATA[string(.) = "jms"]]></xpath>
            </xpath-expression>
          </condition>
          <sequence>
            <assign>
              <assignment>
                <document>
                  <input>
                    <from>configuration xml</from>
                  </input>
                </document>
                <result>
                  <output>
                    <to>queue name</to>
                  </output>
                </result>
                <xpath-expression>
                  <xpath-replacement-tokens />
                  <xpath><![CDATA[normalize-space(//JMSEventDetails/Default_Destination//text())]]></xpath>
                </xpath-expression>
              </assignment>
              <assignment>
                <document>
                  <input>
                    <from>bao process data</from>
                  </input>
                </document>
                <result>
                  <output>
                    <to>map properties</to>
                  </output>
                </result>
                <xslt-stylesheet>
                  <stylesheet-replacement-tokens />
                  <stylesheet><![CDATA[<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
  <xsl:output indent="no" />
  <xsl:template match="/">
    <messages>
      <map>
        <entries>
          <entry>
            <xsl:text disable-output-escaping="no">Dummy Data (For Testing Purpose Only)</xsl:text>
          </entry>
        </entries>
        <xsl:for-each select="//entries/entry">
          <xsl:copy-of select="." />
        </xsl:for-each>
      </map>
    </messages>
  </xsl:template>
</xsl:stylesheet>]]></stylesheet>
                </xslt-stylesheet>
              </assignment>
              <assignment>
                <document>
                  <input>
                    <from>bao process data</from>
                  </input>
                </document>
                <result>
                  <output>
                    <to>fulfillment event text</to>
                  </output>
                </result>
                <xslt-stylesheet>
                  <stylesheet-replacement-tokens />
                  <stylesheet><![CDATA[<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
  <xsl:output indent="no" />
  <xsl:template match="/">
    <messages>
      <text>
        <xsl:value-of select="//fulfillment-input/text()" disable-output-escaping="no" />
      </text>
    </messages>
  </xsl:template>
</xsl:stylesheet>]]></stylesheet>
                </xslt-stylesheet>
              </assignment>
              <meta>
                <documentation />
                <checkpoint>false</checkpoint>
              </meta>
              <location>:switch[1]:sequence[3]:assign[1]</location>
            </assign>
            <call-process>
              <process-name>:AutoPilot-AD-Utilities:JMS:Send Messages</process-name>
              <parameters>
                <input>
                  <from>configuration xml</from>
                  <to>adapter name</to>
                  <xpath-expression>
                    <xpath-replacement-tokens />
                    <xpath><![CDATA[normalize-space(//JMSEventDetails/Default_Adapter_Name/text())]]></xpath>
                  </xpath-expression>
                </input>
                <input>
                  <from>fulfillment event text</from>
                  <to>text messages</to>
                </input>
                <input>
                  <from>queue name</from>
                  <to>destination</to>
                </input>
                <output>
                  <from>Adapter response</from>
                  <to>Adapter response</to>
                </output>
              </parameters>
              <meta>
                <documentation />
                <run-mode-handling>
                  <run-mode>OCP</run-mode>
                  <allow-step-into>false</allow-step-into>
                </run-mode-handling>
                <checkpoint>false</checkpoint>
              </meta>
              <after-execution>
                <log>
                  <level>debug</level>
                  <parameters>
                    <input>
                      <from>Adapter response</from>
                    </input>
                  </parameters>
                </log>
              </after-execution>
              <location>:switch[1]:sequence[3]:call-process[1]</location>
            </call-process>
            <call-process>
              <process-name>:BMC-SA-Service_Desk_Automation:Utilities:Create Response</process-name>
              <parameters>
                <input>
                  <from>Adapter response</from>
                  <to>success status</to>
                  <xpath-expression>
                    <xpath-replacement-tokens />
                    <xpath><![CDATA[//status]]></xpath>
                  </xpath-expression>
                </input>
                <input>
                  <from>start time</from>
                  <to>start time</to>
                </input>
                <input>
                  <value>Unknown</value>
                  <to>target name</to>
                </input>
                <input>
                  <value>Invoke fulfillment use case</value>
                  <to>request type</to>
                </input>
                <input>
                  <from>Adapter response</from>
                  <to>target response</to>
                </input>
                <input>
                  <from>bao process data</from>
                  <to>fulfillment response</to>
                </input>
                <input>
                  <value>xml</value>
                  <to>data type</to>
                </input>
                <input>
                  <value>Invoke fulfillment use case failed.</value>
                  <to>error summary</to>
                </input>
                <output>
                  <from>response xml</from>
                  <to>response xml</to>
                </output>
              </parameters>
              <meta>
                <documentation />
                <run-mode-handling>
                  <run-mode>OCP</run-mode>
                  <allow-step-into>true</allow-step-into>
                </run-mode-handling>
                <checkpoint>false</checkpoint>
              </meta>
              <location>:switch[1]:sequence[3]:call-process[2]</location>
            </call-process>
          </sequence>
        </case>
        <location>:switch[1]</location>
      </switch>
    </sequence>
    <meta>
      <expose-to>
        <consumer>RULE</consumer>
        <consumer>SCHEDULE</consumer>
        <consumer>OCP</consumer>
      </expose-to>
      <documentation>
        <description>This workflow creates and generates a jms event at the end of successful completion of SDA runbook status updates and once we are ready to trigger use case.

The alert contains data required to process fulfillment use case. The jms monitor adapter should be enabled on the grid to process this event and trigger the use case.</description>
        <version></version>
      </documentation>
      <logging-options>
        <is-enabled>false</is-enabled>
        <log-file-name></log-file-name>
      </logging-options>
      <peer-location>
        <location>any</location>
      </peer-location>
      <record-metrics>false</record-metrics>
      <process-id>93e4d10d-8a13-46d8-ae71-43b418b8840d</process-id>
      <author>admin</author>
      <category></category>
      <status></status>
      <keywords>SDA, JMS, Alert</keywords>
      <systems></systems>
      <last-modified-by>admin</last-modified-by>
      <last-modified>1462184753337</last-modified>
    </meta>
  </process-def>
</process>