<process draft="false" dev-studio-version="7.6.02.02">
  <process-def name=":Closed_Loop_Server-SA-Audit:Open Incidents and Changes for Audit Discrepancies">
    <parameters>
      <input global="false" required="true">
        <description>inputevent: inputevent
This is the trap generated by the BladeLogic server in response to Audit job run.

Sample:

&lt;trap&gt;
  &lt;host&gt;172.21.124.94&lt;/host&gt;
  &lt;sysuptime&gt;0&lt;/sysuptime&gt;
  &lt;enterprise&gt;.1.3.6.1.4.1.12788&lt;/enterprise&gt;
  &lt;generic-trap-type&gt;6&lt;/generic-trap-type&gt;
  &lt;specific-trap-type&gt;1001&lt;/specific-trap-type&gt;
  &lt;varbinds&gt;
    &lt;varbind&gt;
      &lt;oid&gt;.1.3.6.1.4.1.12788.1.1.1&lt;/oid&gt;
      &lt;value&gt;auditJob&lt;/value&gt;
    &lt;/varbind&gt;
    &lt;varbind&gt;
      &lt;oid&gt;.1.3.6.1.4.1.12788.1.1.2&lt;/oid&gt;
      &lt;value&gt;Wed Nov 19 03:33:25 EST 2008&lt;/value&gt;
    &lt;/varbind&gt;
    &lt;varbind&gt;
      &lt;oid&gt;.1.3.6.1.4.1.12788.1.1.3&lt;/oid&gt;
      &lt;value&gt;Wed Nov 19 03:33:27 EST 2008&lt;/value&gt;
    &lt;/varbind&gt;
    &lt;varbind&gt;
      &lt;oid&gt;.1.3.6.1.4.1.12788.1.1.4&lt;/oid&gt;
      &lt;value&gt;0&lt;/value&gt;
    &lt;/varbind&gt;
    &lt;varbind&gt;
      &lt;oid&gt;.1.3.6.1.4.1.12788.1.1.5&lt;/oid&gt;
      &lt;value&gt;0&lt;/value&gt;
    &lt;/varbind&gt;
    &lt;varbind&gt;
      &lt;oid&gt;.1.3.6.1.4.1.12788.1.1.6&lt;/oid&gt;
      &lt;value&gt;2001001&lt;/value&gt;
    &lt;/varbind&gt;
    &lt;varbind&gt;
      &lt;oid&gt;.1.3.6.1.4.1.12788.1.1.7&lt;/oid&gt;
      &lt;value&gt;2005029&lt;/value&gt;
    &lt;/varbind&gt;
    &lt;varbind&gt;
      &lt;oid&gt;.1.3.6.1.4.1.12788.1.1.8&lt;/oid&gt;
      &lt;value&gt;31&lt;/value&gt;
    &lt;/varbind&gt;
  &lt;/varbinds&gt;
&lt;/trap&gt;</description>
        <from>inputevent</from>
        <to>inputevent</to>
      </input>
      <output global="false" required="false">
        <to>success status</to>
        <from>success status</from>
      </output>
      <output global="false" required="false">
        <to>status message</to>
        <from>status message</from>
      </output>
      <output global="false" required="false">
        <to>status messages</to>
        <from>status messages</from>
      </output>
    </parameters>
    <access />
    <sequence>
      <call-process>
        <process-name>:Closed_Loop_Server-SA-Audit:Utilities:Extract Configuration Data</process-name>
        <parameters>
          <input>
            <value>BLADELOGIC</value>
            <to>configuration name</to>
          </input>
          <output>
            <from>trap mappings</from>
            <to>trap mappings</to>
          </output>
          <output>
            <from>bl connection details</from>
            <to>bl connection details</to>
          </output>
          <output>
            <from>export path</from>
            <to>export path</to>
          </output>
          <output>
            <from>file connection details</from>
            <to>file connection details</to>
          </output>
          <output>
            <from>jobs</from>
            <to>jobs</to>
          </output>
          <output>
            <from>incident platform</from>
            <to>incident platform</to>
          </output>
          <output>
            <from>incident template name</from>
            <to>incident template name</to>
          </output>
          <output>
            <from>change platform</from>
            <to>change platform</to>
          </output>
          <output>
            <from>change template name</from>
            <to>change template name</to>
          </output>
          <output>
            <from>task platform</from>
            <to>task platform</to>
          </output>
          <output>
            <from>authentication enable</from>
            <to>authentication enable</to>
          </output>
          <output>
            <from>authentication platform</from>
            <to>authentication platform</to>
          </output>
          <output>
            <from>authentication schema</from>
            <to>authentication schema</to>
          </output>
          <output>
            <from>authentication version</from>
            <to>authentication version</to>
          </output>
          <output>
            <from>authentication adapter</from>
            <to>authentication adapter</to>
          </output>
          <output>
            <from>authentication query mappings</from>
            <to>authentication query mappings</to>
          </output>
          <output>
            <from>authentication username</from>
            <to>authentication username</to>
          </output>
          <output>
            <from>success status</from>
            <to>success status</to>
          </output>
          <output>
            <from>status message</from>
            <to>status message</to>
          </output>
          <output>
            <from>configuration name</from>
            <to>configuration name</to>
          </output>
          <output>
            <from>incident default status</from>
            <to>incident default status</to>
          </output>
          <output>
            <from>incident default service type</from>
            <to>incident default service type</to>
          </output>
          <output>
            <from>incident default impact</from>
            <to>incident default impact</to>
          </output>
          <output>
            <from>incident default urgency</from>
            <to>incident default urgency</to>
          </output>
          <output>
            <from>change default status</from>
            <to>change default status</to>
          </output>
          <output>
            <from>change default change type</from>
            <to>change default change type</to>
          </output>
          <output>
            <from>change default impact</from>
            <to>change default impact</to>
          </output>
          <output>
            <from>change default urgency</from>
            <to>change default urgency</to>
          </output>
          <output>
            <from>change default risk level</from>
            <to>change default risk level</to>
          </output>
          <output>
            <from>change default timing</from>
            <to>change default timing</to>
          </output>
          <output>
            <from>incident default status reason</from>
            <to>incident default status reason</to>
          </output>
          <output>
            <from>incident default reported source</from>
            <to>incident default reported source</to>
          </output>
          <output>
            <from>configuration enable</from>
            <to>configuration enable</to>
          </output>
          <output>
            <from>configuration platform</from>
            <to>configuration platform</to>
          </output>
          <output>
            <from>blcli tunnelling</from>
            <to>blcli tunnelling</to>
          </output>
          <output>
            <from>bl connection details instance 2</from>
            <to>bl connection details instance 2</to>
          </output>
        </parameters>
        <meta>
          <documentation />
          <run-mode-handling>
            <run-mode>OCP</run-mode>
            <allow-step-into>false</allow-step-into>
          </run-mode-handling>
          <checkpoint>false</checkpoint>
        </meta>
        <location>:call-process[1]</location>
      </call-process>
      <call-process>
        <process-name>:Closed_Loop_Server-SA-Audit:Utilities:Receive Blade Logic Trap</process-name>
        <parameters>
          <input>
            <from>inputevent</from>
            <to>inputevent</to>
          </input>
          <input>
            <from>trap mappings</from>
            <to>trap mappings</to>
          </input>
          <output>
            <from>blade logic alert</from>
            <to>bladelogic alert</to>
          </output>
          <output>
            <from>success</from>
            <to>success status</to>
          </output>
        </parameters>
        <meta>
          <documentation />
          <run-mode-handling>
            <run-mode>OCP</run-mode>
            <allow-step-into>false</allow-step-into>
          </run-mode-handling>
          <checkpoint>false</checkpoint>
        </meta>
        <location>:call-process[2]</location>
      </call-process>
      <switch>
        <meta>
          <documentation />
          <run-mode-handling>
            <run-mode>OCP</run-mode>
            <allow-step-into>true</allow-step-into>
          </run-mode-handling>
          <checkpoint>false</checkpoint>
        </meta>
        <execute-all-applicable-cases>false</execute-all-applicable-cases>
        <default>
          <sequence />
        </default>
        <case>
          <condition>
            <document>
              <input>
                <from>success status</from>
              </input>
            </document>
            <xpath-expression>
              <xpath-replacement-tokens />
              <xpath><![CDATA[string(.)="true"]]></xpath>
            </xpath-expression>
          </condition>
          <sequence>
            <assign>
              <assignment>
                <document>
                  <input>
                    <from>bladelogic alert</from>
                  </input>
                </document>
                <result>
                  <output>
                    <to>audit job name</to>
                  </output>
                </result>
                <xpath-expression>
                  <xpath-replacement-tokens />
                  <xpath><![CDATA[//jc-job-name/text()]]></xpath>
                </xpath-expression>
              </assignment>
              <assignment>
                <document>
                  <input>
                    <from>jobs</from>
                  </input>
                </document>
                <result>
                  <output>
                    <to>job</to>
                  </output>
                </result>
                <xslt-stylesheet>
                  <stylesheet-replacement-tokens>
                    <replacement-token name="job name">
                      <input global="false">
                        <from>audit job name</from>
                      </input>
                    </replacement-token>
                  </stylesheet-replacement-tokens>
                  <stylesheet><![CDATA[<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
  <xsl:output indent="no" />
  <xsl:template match="/">
    <root>
      <xsl:copy-of select="//job[job-name/text()='${job name}']" />
    </root>
  </xsl:template>
</xsl:stylesheet>]]></stylesheet>
                </xslt-stylesheet>
              </assignment>
              <meta>
                <documentation />
                <checkpoint>false</checkpoint>
              </meta>
              <location>:switch[1]:sequence[2]:assign[1]</location>
            </assign>
            <call-process>
              <process-name>:Closed_Loop_Server-SA-Audit:Utilities:Get Audit Job Results</process-name>
              <parameters>
                <input>
                  <from>bl connection details</from>
                  <to>bl connection details</to>
                </input>
                <input>
                  <from>bl connection details instance 2</from>
                  <to>bl connection details instance 2</to>
                </input>
                <input>
                  <from>blcli tunnelling</from>
                  <to>blcli tunnelling</to>
                </input>
                <input>
                  <from>file connection details</from>
                  <to>file connection details</to>
                </input>
                <input>
                  <from>bladelogic alert</from>
                  <to>bladelogic alert</to>
                </input>
                <input>
                  <from>job</from>
                  <to>job</to>
                </input>
                <input>
                  <from>export path</from>
                  <to>export path</to>
                </input>
                <input>
                  <value>CSV</value>
                  <to>export file type</to>
                </input>
                <input>
                  <value>Run</value>
                  <to>purpose</to>
                </input>
                <output>
                  <from>success status</from>
                  <to>success status</to>
                </output>
                <output>
                  <from>audit run</from>
                  <to>audit run</to>
                </output>
                <output>
                  <from>audit job name</from>
                  <to>audit job name</to>
                </output>
                <output>
                  <from>audit job key</from>
                  <to>audit job key</to>
                </output>
                <output>
                  <from>audit job run key</from>
                  <to>audit job run key</to>
                </output>
                <output>
                  <from>audit job run index</from>
                  <to>audit job run index</to>
                </output>
              </parameters>
              <meta>
                <documentation />
                <run-mode-handling>
                  <run-mode>OCP</run-mode>
                  <allow-step-into>false</allow-step-into>
                </run-mode-handling>
                <checkpoint>false</checkpoint>
              </meta>
              <after-execution>
                <log>
                  <level>debug</level>
                  <parameters>
                    <input>
                      <from>audit run</from>
                    </input>
                  </parameters>
                </log>
              </after-execution>
              <location>:switch[1]:sequence[2]:call-process[1]</location>
            </call-process>
            <switch>
              <meta>
                <documentation />
                <run-mode-handling>
                  <run-mode>OCP</run-mode>
                  <allow-step-into>true</allow-step-into>
                </run-mode-handling>
                <checkpoint>false</checkpoint>
              </meta>
              <execute-all-applicable-cases>false</execute-all-applicable-cases>
              <default>
                <sequence>
                  <assign>
                    <assignment>
                      <document>
                        <input>
                          <from>audit job name</from>
                        </input>
                      </document>
                      <result>
                        <output>
                          <to>status message</to>
                        </output>
                      </result>
                      <xpath-expression>
                        <xpath-replacement-tokens />
                        <xpath><![CDATA[concat('Export unsuccessful for: ', .)]]></xpath>
                      </xpath-expression>
                    </assignment>
                    <meta>
                      <documentation />
                      <checkpoint>false</checkpoint>
                    </meta>
                    <location>:switch[1]:sequence[2]:switch[1]:sequence[1]:assign[1]</location>
                  </assign>
                </sequence>
              </default>
              <case>
                <condition>
                  <document>
                    <input>
                      <from>success status</from>
                    </input>
                  </document>
                  <xpath-expression>
                    <xpath-replacement-tokens />
                    <xpath><![CDATA[string(.)='true']]></xpath>
                  </xpath-expression>
                </condition>
                <sequence>
                  <call-process>
                    <process-name>:Closed_Loop_Server-SA-Audit:Utilities:Open Incidents and Related Changes</process-name>
                    <parameters>
                      <input>
                        <from>configuration name</from>
                        <to>configuration name</to>
                      </input>
                      <input>
                        <from>audit run</from>
                        <to>audit run</to>
                      </input>
                      <input>
                        <from>audit job name</from>
                        <to>audit job name</to>
                      </input>
                      <input>
                        <from>audit job key</from>
                        <to>audit job key</to>
                      </input>
                      <input>
                        <from>audit job run key</from>
                        <to>audit job run key</to>
                      </input>
                      <input>
                        <from>audit job run index</from>
                        <to>audit job run index</to>
                      </input>
                      <input>
                        <from>bladelogic alert</from>
                        <to>bladelogic alert</to>
                      </input>
                      <output>
                        <from>success status</from>
                        <to>success status</to>
                      </output>
                      <output>
                        <from>status message</from>
                        <to>status message</to>
                      </output>
                      <output>
                        <from>status messages</from>
                        <to>status messages</to>
                      </output>
                    </parameters>
                    <meta>
                      <documentation />
                      <run-mode-handling>
                        <run-mode>OCP</run-mode>
                        <allow-step-into>false</allow-step-into>
                      </run-mode-handling>
                      <checkpoint>false</checkpoint>
                    </meta>
                    <location>:switch[1]:sequence[2]:switch[1]:sequence[2]:call-process[1]</location>
                  </call-process>
                </sequence>
              </case>
              <location>:switch[1]:sequence[2]:switch[1]</location>
            </switch>
          </sequence>
        </case>
        <location>:switch[1]</location>
      </switch>
      <assign>
        <assignment>
          <document>
            <input>
              <from>success status</from>
            </input>
          </document>
          <result>
            <output>
              <to>success status</to>
            </output>
          </result>
          <xslt-stylesheet>
            <stylesheet-replacement-tokens />
            <stylesheet><![CDATA[<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
  <xsl:output indent="no" />
  <xsl:template match="/">
    <value>
      <xsl:choose>
        <xsl:when test="string(.)!='success' and string(.)!='failure'">
          <xsl:choose>
            <xsl:when test="string(.)='true'">
              <xsl:text disable-output-escaping="no">success</xsl:text>
            </xsl:when>
            <xsl:otherwise>
              <xsl:text disable-output-escaping="no">failure</xsl:text>
            </xsl:otherwise>
          </xsl:choose>
        </xsl:when>
        <xsl:otherwise>
          <xsl:value-of select="." disable-output-escaping="no" />
        </xsl:otherwise>
      </xsl:choose>
    </value>
  </xsl:template>
</xsl:stylesheet>]]></stylesheet>
          </xslt-stylesheet>
        </assignment>
        <meta>
          <documentation />
          <checkpoint>false</checkpoint>
        </meta>
        <location>:assign[1]</location>
      </assign>
    </sequence>
    <meta>
      <expose-to>
        <consumer>RULE</consumer>
        <consumer>SCHEDULE</consumer>
      </expose-to>
      <documentation>
        <description>This workflow is triggered by RBA monitor adapter upon receiving a SNMP alert from BL upon detecting audit discrepancies. This workflow queries audit data and checks for any targets for discrepancies. This workflow creates one ore more incidents and change tickets (and corresponding task from task template) for each target that is found to be inconsistent.</description>
        <version></version>
      </documentation>
      <peer-location>
        <location>any</location>
      </peer-location>
      <record-metrics>false</record-metrics>
      <process-id>97848dd7-1a25-368b-9601-643628bdf5e4</process-id>
      <author>admin</author>
      <category></category>
      <status></status>
      <keywords></keywords>
      <systems></systems>
      <last-modified-by>admin</last-modified-by>
      <last-modified>1318923059857</last-modified>
    </meta>
  </process-def>
</process>