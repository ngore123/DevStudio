<process draft="false" dev-studio-version="7.6.01.02">
  <process-def name=":AO-AD-HP_ServiceManager:Utilities:Configuration_Management:Create Configuration Item Utility">
    <parameters>
      <input global="false" required="false">
        <description>            The name of the adapter to use to handle the request. 
</description>
        <from>adapter name</from>
        <to>adapter name</to>
      </input>
      <input global="false" required="true">
        <description>The items for the adapter request. This should be an XML document with a root element named "items" having a child "item", which should contain the data necessary to execute the specific request. </description>
        <from>items</from>
        <to>items</to>
      </input>
      <input global="false" required="false">
        <from>connection parameters</from>
        <to>connection parameters</to>
      </input>
      <output global="false" required="false">
        <description> The adapter response containing the results. </description>
        <to>adapter response</to>
        <from>adapter response</from>
      </output>
    </parameters>
    <access />
    <sequence>
      <call-process>
        <process-name>:AO-AD-HP_ServiceManager:Utilities:Set Default Adapter Name</process-name>
        <parameters>
          <input>
            <from>adapter name</from>
            <to>adapter name</to>
          </input>
          <output>
            <from>adapter name</from>
            <to>adapter name</to>
          </output>
        </parameters>
        <meta>
          <documentation />
          <run-mode-handling>
            <run-mode>OCP</run-mode>
            <allow-step-into>false</allow-step-into>
          </run-mode-handling>
          <checkpoint>false</checkpoint>
        </meta>
        <location>:call-process[1]</location>
      </call-process>
      <assign>
        <assignment>
          <document>
            <input>
              <from>items</from>
            </input>
          </document>
          <result>
            <output>
              <to>request element</to>
            </output>
          </result>
          <xpath-expression>
            <xpath-replacement-tokens />
            <xpath><![CDATA[concat(concat(substring-before((//operation-name)[1], "-"), "-configuration"), "-request")]]></xpath>
          </xpath-expression>
        </assignment>
        <assignment>
          <document>
            <input>
              <from>connection parameters</from>
            </input>
          </document>
          <result>
            <output>
              <to>username</to>
            </output>
          </result>
          <xpath-expression>
            <xpath-replacement-tokens />
            <xpath><![CDATA[(//alternate-username)[1]/text()]]></xpath>
          </xpath-expression>
        </assignment>
        <assignment>
          <document>
            <input>
              <from>connection parameters</from>
            </input>
          </document>
          <result>
            <output>
              <to>password</to>
            </output>
          </result>
          <xpath-expression>
            <xpath-replacement-tokens />
            <xpath><![CDATA[(//alternate-password)[1]/text()]]></xpath>
          </xpath-expression>
        </assignment>
        <meta>
          <documentation />
          <checkpoint>false</checkpoint>
        </meta>
        <location>:assign[1]</location>
      </assign>
      <assign>
        <assignment>
          <document>
            <input>
              <from>items</from>
            </input>
          </document>
          <result>
            <output>
              <to>adapter request</to>
            </output>
          </result>
          <xslt-stylesheet>
            <stylesheet-replacement-tokens>
              <replacement-token name="items">
                <input global="false">
                  <from>items</from>
                </input>
              </replacement-token>
              <replacement-token name="request element">
                <input global="false">
                  <from>request element</from>
                </input>
              </replacement-token>
              <replacement-token name="username">
                <input global="false">
                  <from>username</from>
                </input>
              </replacement-token>
              <replacement-token name="password">
                <input global="false">
                  <from>password</from>
                </input>
              </replacement-token>
            </stylesheet-replacement-tokens>
            <stylesheet><![CDATA[<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
  <xsl:output indent="no" />
  <xsl:template match="/">
    <request-data>
      <hp-service-manager-request>
        <xsl:if test="string('${username}') != ''">
          <username>${username}</username>
        </xsl:if>
        <xsl:if test="string('${password}') != ''">
          <password>${password}</password>
        </xsl:if>
        <entity>
          <xsl:text disable-output-escaping="no">configurationitem</xsl:text>
        </entity>
        <entity-type>
          <xsl:copy-of select="(//entity-type)[1]/text()" />
        </entity-type>
        <request>
          <operation-name>
            <xsl:copy-of select="(//operation-name)[1]/text()" />
          </operation-name>
          <xsl:for-each select="/items/item">
            <parameters>
              <xsl:element name="${request element}">
                <xsl:copy-of select="./model" />
              </xsl:element>
            </parameters>
          </xsl:for-each>
        </request>
      </hp-service-manager-request>
    </request-data>
  </xsl:template>
</xsl:stylesheet>]]></stylesheet>
          </xslt-stylesheet>
        </assignment>
        <meta>
          <documentation />
          <checkpoint>false</checkpoint>
        </meta>
        <location>:assign[2]</location>
      </assign>
      <call-adapter>
        <parameters>
          <input global="false">
            <from>adapter name</from>
          </input>
          <input>
            <value>
              <adapter-request>
                <peer-location>
                  <location>any</location>
                </peer-location>
                <request-action>invoke</request-action>
              </adapter-request>
            </value>
          </input>
          <input global="false">
            <from>adapter request</from>
          </input>
          <input global="false">
            <from>adapter request</from>
          </input>
          <output global="false">
            <to>adapter response</to>
          </output>
        </parameters>
        <meta>
          <documentation />
          <checkpoint>false</checkpoint>
        </meta>
        <before-execution>
          <log>
            <level>debug</level>
            <parameters>
              <input>
                <value>Adapter Request:</value>
              </input>
              <input>
                <from>adapter request</from>
              </input>
              <input>
                <from>adapter name</from>
              </input>
            </parameters>
          </log>
        </before-execution>
        <after-execution>
          <log>
            <level>debug</level>
            <parameters>
              <input>
                <value>Adapter Response:</value>
              </input>
              <input>
                <from>adapter response</from>
              </input>
            </parameters>
          </log>
        </after-execution>
        <location>:call-adapter[1]</location>
      </call-adapter>
    </sequence>
    <meta>
      <expose-to>
        <consumer>RULE</consumer>
        <consumer>SCHEDULE</consumer>
      </expose-to>
      <documentation>
        <description>Create Change
    Utility wrapper for creating a change

    Inputs
       adapter name    [Optional]
            The name of the adapter to use to handle the request. 
       version
             Identifies the version of HP Service Manager system. Currently "v7.1" is supported.
        items
            The items for the adapter request. This should be an XML document with a root element named "items" having a child "item", which should contain the data necessary to execute the specific request. 
	operation name 
		The value of the operation-name as per the request data provided in the "items"
	alternate username [Optional] 
		Provide username if the corresponding value in the adapter config needs to be overridden
	alternate password [Optional] 
		Provide password if the corresponding value in the adapter config needs to be overridden
   Outputs
        adapter response
            The adapter response containing the results. </description>
        <version>1.0</version>
      </documentation>
      <peer-location>
        <location>any</location>
      </peer-location>
      <record-metrics>false</record-metrics>
      <process-id>d7b35afa-3a83-314d-9fd8-47795e093dca</process-id>
      <author />
      <category />
      <status />
      <keywords />
      <systems />
      <last-modified-by />
      <last-modified>1290594302862</last-modified>
    </meta>
  </process-def>
</process>