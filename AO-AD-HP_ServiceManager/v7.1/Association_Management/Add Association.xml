<process draft="false" dev-studio-version="7.6.01.02">
  <process-def name=":AO-AD-HP_ServiceManager:v7.1:Association_Management:Add Association">
    <parameters>
      <input global="false" required="false">
        <description>The name of the adapter to use to handle the request. Default adapter name: HPSMActor. </description>
        <from>adapter name</from>
        <to>adapter name</to>
      </input>
      <input global="false" required="true">
        <description>The items for the adapter request. This should be an XML document with a root element named "items" having multiple child "item" elements, which should contain the data necessary to execute the specific request.

Add Association

This wrapper creates an 'Association'.

Sample Item Xml:
  
&lt;items&gt;
	&lt;item&gt;
		&lt;operation-name&gt;add-screlation&lt;/operation-name&gt;
		&lt;model&gt;
			&lt;keys&gt;	
				&lt;source&gt;
					&lt;value&gt;C10&lt;/value&gt;
					&lt;type&gt;String&lt;/type&gt;
				&lt;/source&gt;
				&lt;source-filename&gt;
					&lt;value&gt;cm3r&lt;/value&gt;
					&lt;type&gt;String&lt;/type&gt;
				&lt;/source-filename&gt;
				&lt;depend&gt;
					&lt;value&gt;IM1002&lt;/value&gt;
					&lt;type&gt;String&lt;/type&gt;
				&lt;/depend&gt;	
				&lt;depend-filename&gt;
					&lt;value&gt;problem&lt;/value&gt;
					&lt;type&gt;String&lt;/type&gt;
				&lt;/depend-filename&gt;				
			&lt;/keys&gt;
			&lt;instance&gt;
				&lt;source&gt;
					&lt;value&gt;C10&lt;/value&gt;
					&lt;type&gt;String&lt;/type&gt;
				&lt;/source&gt;
				&lt;source-filename&gt;
					&lt;value&gt;cm3r&lt;/value&gt;
					&lt;type&gt;String&lt;/type&gt;
				&lt;/source-filename&gt;
				&lt;depend&gt;
					&lt;value&gt;IM1002&lt;/value&gt;
					&lt;type&gt;String&lt;/type&gt;
				&lt;/depend&gt;
				&lt;depend-filename&gt;
					&lt;value&gt;problem&lt;/value&gt;
					&lt;type&gt;String&lt;/type&gt;
				&lt;/depend-filename&gt;				
			&lt;/instance&gt;
		&lt;/model&gt;
	&lt;/item&gt;
&lt;/items&gt;

Elements’ Description:   

The information provided in &lt;keys&gt; tag should refer to an existing association. It is to specify the type of association we want to create. For example, if information provided in &lt;keys&gt; refers to an association with a Change as the source and an Incident as the dependent entity, then the source and dependent entity types will remain same for the new association we are creating. i.e. Source type will be Change, and dependent entity type will be Incident. The information of new association we want to create is given inside &lt;instance&gt; tag.

Note: Application supports following type of associations
Change : Incident
Change : Interaction
Incident : Change
Incident : Interaction
Incident : Problem
Interaction : Change 
Interaction : Incident
Problem : Incident 

item [Required]: This is a child of &lt;items&gt;. This &lt;item&gt; tag can be multiple times to support "multiple items support". 

operation-name [Required]: This is used to specify the operation that needs to be performed.

	Valid values: add-screlation

model[Required]: It is the parent tag for containing all other tags.

keys [Required]: used as a unique identifier of the 'Association'. This existing association is to specify the 'type' of association we want to create.

instance [Required] : This tag holds information about the new assocation we want to create.

source [Required]: refers to the source entry.
	Valid values: key of any existing “change”, “incident” or "interaction" entry. The keys for different type of entries are as follows:
	Change : change-number ("Change ID" on application UI)
	Incident : incident-i-d ("Incident ID" on application UI)
	Interaction : call-i-d ("Interaction ID" on the application UI)
	Problem : id ("Problem ID" on the application UI)
	
source-filename [Optional]: the file name of the source entry. This should be specified only when the source entity in the key cannot be used to determine the entity type. E.g. when a Incident and a Change exist with the same key. The file names in the out of the box HP Service Manager application for change and incidents are as below

Change : cm3r
Incident : problem
Interaction : incidents
Problem : rootcause

depend [Required]: refers to the dependent entry. 
	Valid values: key of any existing “change”, “incident” or "interaction" entry. The keys for different type of entries are as follows:
	Change : change-number ("Change ID" on the application UI)
	Incident : incident-i-d ("Incident ID" on the application UI)
	Interaction : call-i-d ("Interaction ID" on the application UI)
	Problem : id ("Problem ID" on the application UI)
	
depend-filename [Optional]: the file name of the dependent entry. This should be specified only when the dependent entity in the key cannot be used to determine the entity type. E.g. when a Incident and a Change exist with the same key. The file names in the out of the box HP Service Manager application for change and incidents are as below

Change : cm3r
Incident : problem
Interaction : incidents
Problem : rootcause
</description>
        <from>items</from>
        <to>items</to>
      </input>
      <input global="false" required="false">
        <description>Provide username/password in form of xml. 

This input parameter is required when the user wants to override the default values for username and password provided in the adapter configuration. This is required for cases where an operation cannot be executed with the default username/password provided in the adapter configuration and only user with special permissions can execute the operation. Examples of such operations can be - 'approve-change', 'deny-change', 'close-change', 'approve-task'

Sample XML Format: 

&lt;connection-parameters&gt;
	&lt;alternate-username&gt;USERNAME&lt;/alternate-username&gt;
	&lt;alternate-password&gt;PASSWORD&lt;/alternate-password&gt;
&lt;/connection-parameters&gt;</description>
        <from>connection parameters</from>
        <to>connection parameters</to>
      </input>
      <output global="false" required="false">
        <to>adapter response</to>
        <from>adapter response</from>
      </output>
    </parameters>
    <access />
    <sequence>
      <switch>
        <meta>
          <documentation />
          <run-mode-handling>
            <run-mode>OCP</run-mode>
            <allow-step-into>true</allow-step-into>
          </run-mode-handling>
          <checkpoint>false</checkpoint>
        </meta>
        <execute-all-applicable-cases>false</execute-all-applicable-cases>
        <default>
          <sequence>
            <call-process>
              <process-name>:AO-AD-HP_ServiceManager:Utilities:Operation Name Error Reporting</process-name>
              <parameters>
                <input>
                  <value>add-screlation</value>
                  <to>operation name</to>
                </input>
                <input>
                  <from>items</from>
                  <to>items</to>
                </input>
              </parameters>
              <meta>
                <documentation />
                <run-mode-handling>
                  <run-mode>OCP</run-mode>
                  <allow-step-into>false</allow-step-into>
                </run-mode-handling>
                <checkpoint>false</checkpoint>
              </meta>
              <location>:switch[1]:sequence[1]:call-process[1]</location>
            </call-process>
          </sequence>
        </default>
        <case>
          <condition>
            <document>
              <input>
                <from>items</from>
              </input>
            </document>
            <xpath-expression>
              <xpath-replacement-tokens />
              <xpath><![CDATA[(//operation-name)[1]/text() = 'add-screlation']]></xpath>
            </xpath-expression>
          </condition>
          <sequence>
            <call-process>
              <process-name>:AO-AD-HP_ServiceManager:Utilities:Set Default Adapter Name</process-name>
              <parameters>
                <input>
                  <from>adapter name</from>
                  <to>adapter name</to>
                </input>
                <output>
                  <from>adapter name</from>
                  <to>adapter name</to>
                </output>
              </parameters>
              <meta>
                <documentation />
                <run-mode-handling>
                  <run-mode>OCP</run-mode>
                  <allow-step-into>false</allow-step-into>
                </run-mode-handling>
                <checkpoint>false</checkpoint>
              </meta>
              <location>:switch[1]:sequence[2]:call-process[1]</location>
            </call-process>
            <assign>
              <assignment>
                <document>
                  <input>
                    <from>items</from>
                  </input>
                </document>
                <result>
                  <output>
                    <to>request element</to>
                  </output>
                </result>
                <xpath-expression>
                  <xpath-replacement-tokens />
                  <xpath><![CDATA[concat((//operation-name)[1], "-request")]]></xpath>
                </xpath-expression>
              </assignment>
              <assignment>
                <document>
                  <input>
                    <from>connection parameters</from>
                  </input>
                </document>
                <result>
                  <output>
                    <to>username</to>
                  </output>
                </result>
                <xpath-expression>
                  <xpath-replacement-tokens />
                  <xpath><![CDATA[(//alternate-username)[1]/text()]]></xpath>
                </xpath-expression>
              </assignment>
              <assignment>
                <document>
                  <input>
                    <from>connection parameters</from>
                  </input>
                </document>
                <result>
                  <output>
                    <to>password</to>
                  </output>
                </result>
                <xpath-expression>
                  <xpath-replacement-tokens />
                  <xpath><![CDATA[(//alternate-password)[1]/text()]]></xpath>
                </xpath-expression>
              </assignment>
              <meta>
                <documentation />
                <checkpoint>false</checkpoint>
              </meta>
              <location>:switch[1]:sequence[2]:assign[1]</location>
            </assign>
            <assign>
              <assignment>
                <document>
                  <input>
                    <from>items</from>
                  </input>
                </document>
                <result>
                  <output>
                    <to>adapter request</to>
                  </output>
                </result>
                <xslt-stylesheet>
                  <stylesheet-replacement-tokens>
                    <replacement-token name="items">
                      <input global="false">
                        <from>items</from>
                      </input>
                    </replacement-token>
                    <replacement-token name="request element">
                      <input global="false">
                        <from>request element</from>
                      </input>
                    </replacement-token>
                    <replacement-token name="username">
                      <input global="false">
                        <from>username</from>
                      </input>
                    </replacement-token>
                    <replacement-token name="password">
                      <input global="false">
                        <from>password</from>
                      </input>
                    </replacement-token>
                  </stylesheet-replacement-tokens>
                  <stylesheet><![CDATA[<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
  <xsl:output indent="no" />
  <xsl:template match="/">
    <request-data>
      <hp-service-manager-request>
        <xsl:if test="string('${username}') != ''">
          <username>${username}</username>
        </xsl:if>
        <xsl:if test="string('${password}') != ''">
          <password>${password}</password>
        </xsl:if>
        <entity>
          <xsl:text disable-output-escaping="no">association</xsl:text>
        </entity>
        <entity-type>
          <xsl:copy-of select="(//entity-type)[1]/text()" />
        </entity-type>
        <request>
          <operation-name>
            <xsl:copy-of select="(//operation-name)[1]/text()" />
          </operation-name>
          <xsl:for-each select="/items/item">
            <parameters>
              <xsl:element name="${request element}">
                <xsl:copy-of select="./model" />
              </xsl:element>
            </parameters>
          </xsl:for-each>
        </request>
      </hp-service-manager-request>
    </request-data>
  </xsl:template>
</xsl:stylesheet>]]></stylesheet>
                </xslt-stylesheet>
              </assignment>
              <meta>
                <documentation />
                <checkpoint>false</checkpoint>
              </meta>
              <location>:switch[1]:sequence[2]:assign[2]</location>
            </assign>
            <call-adapter>
              <parameters>
                <input global="false">
                  <from>adapter name</from>
                </input>
                <input>
                  <value>
                    <adapter-request>
                      <peer-location>
                        <location>any</location>
                      </peer-location>
                      <request-action>invoke</request-action>
                    </adapter-request>
                  </value>
                </input>
                <input global="false">
                  <from>adapter request</from>
                </input>
                <input global="false">
                  <from>adapter request</from>
                </input>
                <output global="false">
                  <to>adapter response</to>
                </output>
              </parameters>
              <meta>
                <documentation />
                <checkpoint>false</checkpoint>
              </meta>
              <before-execution>
                <log>
                  <level>debug</level>
                  <parameters>
                    <input>
                      <value>Adapter Request:</value>
                    </input>
                    <input>
                      <from>adapter request</from>
                    </input>
                    <input>
                      <from>adapter name</from>
                    </input>
                  </parameters>
                </log>
              </before-execution>
              <after-execution>
                <log>
                  <level>debug</level>
                  <parameters>
                    <input>
                      <value>Adapter Response:</value>
                    </input>
                    <input>
                      <from>adapter response</from>
                    </input>
                  </parameters>
                </log>
              </after-execution>
              <location>:switch[1]:sequence[2]:call-adapter[1]</location>
            </call-adapter>
          </sequence>
        </case>
        <location>:switch[1]</location>
      </switch>
    </sequence>
    <meta>
      <expose-to>
        <consumer>RULE</consumer>
        <consumer>SCHEDULE</consumer>
      </expose-to>
      <documentation>
        <description>This wrapper creates an 'Association'.</description>
        <version></version>
      </documentation>
      <peer-location>
        <location>any</location>
      </peer-location>
      <record-metrics>false</record-metrics>
      <process-id>82e15e40-eee4-3342-9109-ba1df6737a6f</process-id>
      <author />
      <category />
      <status />
      <keywords />
      <systems />
      <last-modified-by />
      <last-modified>1290594316283</last-modified>
    </meta>
  </process-def>
</process>