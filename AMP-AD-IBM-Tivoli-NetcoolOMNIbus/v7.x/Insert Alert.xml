<process draft="false" dev-studio-version="7.6.01.00">
  <process-def name=":AMP-AD-IBM-Tivoli-NetcoolOMNIbus:v7.x:Insert Alert">
    <parameters>
      <input global="false" required="false">
        <from>adapter name</from>
        <to>adapter name</to>
      </input>
      <input global="false" required="true">
        <from>fqdn</from>
        <to>fqdn</to>
      </input>
      <input global="false" required="true">
        <from>severity</from>
        <to>severity</to>
      </input>
      <input global="false" required="true">
        <from>summary</from>
        <to>summary</to>
      </input>
      <input global="false" required="true">
        <from>identifier</from>
        <to>identifier</to>
      </input>
      <input global="false" required="true">
        <from>alertgroup</from>
        <to>alertgroup</to>
      </input>
      <input global="false" required="true">
        <from>owner id</from>
        <to>owner id</to>
      </input>
      <output global="false" required="true">
        <to>serial</to>
        <from>serial</from>
      </output>
    </parameters>
    <access />
    <sequence>
      <switch>
        <meta>
          <documentation />
          <run-mode-handling>
            <run-mode>OCP</run-mode>
            <allow-step-into>true</allow-step-into>
          </run-mode-handling>
          <checkpoint>false</checkpoint>
        </meta>
        <execute-all-applicable-cases>false</execute-all-applicable-cases>
        <default>
          <sequence />
        </default>
        <case>
          <condition>
            <document>
              <input>
                <from>adapter name</from>
              </input>
            </document>
            <xpath-expression>
              <xpath-replacement-tokens />
              <xpath><![CDATA[string-length(.)=0]]></xpath>
            </xpath-expression>
          </condition>
          <sequence>
            <assign>
              <assignment>
                <output>
                  <to>adapter name</to>
                  <value>OMNIbusAdapter</value>
                </output>
              </assignment>
              <meta>
                <documentation />
                <checkpoint>false</checkpoint>
              </meta>
              <after-execution>
                <log>
                  <level>debug</level>
                  <parameters>
                    <input>
                      <value>Done assigning adapter name</value>
                    </input>
                    <input>
                      <from>adapter name</from>
                    </input>
                  </parameters>
                </log>
              </after-execution>
              <location>:switch[1]:sequence[2]:assign[1]</location>
            </assign>
          </sequence>
        </case>
        <location>:switch[1]</location>
      </switch>
      <call-process>
        <process-name>:AMP-AD-IBM-Tivoli-NetcoolOMNIbus:Utilities:Tokenize String</process-name>
        <parameters>
          <input>
            <from>fqdn</from>
            <to>string</to>
          </input>
          <input>
            <value>.</value>
            <to>delimiters</to>
          </input>
          <output>
            <from>tokens</from>
            <to>tokenized domain name</to>
          </output>
        </parameters>
        <meta>
          <documentation />
          <run-mode-handling>
            <run-mode>OCP</run-mode>
            <allow-step-into>false</allow-step-into>
          </run-mode-handling>
          <checkpoint>false</checkpoint>
        </meta>
        <location>:call-process[1]</location>
      </call-process>
      <assign>
        <assignment>
          <document>
            <input>
              <from>tokenized domain name</from>
            </input>
          </document>
          <result>
            <output>
              <to>node</to>
            </output>
          </result>
          <xpath-expression>
            <xpath-replacement-tokens />
            <xpath><![CDATA[/tokens/token[1]/text()]]></xpath>
          </xpath-expression>
        </assignment>
        <meta>
          <documentation />
          <checkpoint>false</checkpoint>
        </meta>
        <location>:assign[1]</location>
      </assign>
      <utility>
        <date>
          <now />
        </date>
        <output global="false">
          <to>time now</to>
        </output>
        <meta>
          <documentation />
          <checkpoint>false</checkpoint>
        </meta>
        <location>:utility[1]</location>
      </utility>
      <assign>
        <assignment>
          <output>
            <to>agent</to>
            <value>AMP</value>
          </output>
        </assignment>
        <assignment>
          <output>
            <to>manager</to>
            <value>AMP</value>
          </output>
        </assignment>
        <meta>
          <documentation />
          <checkpoint>false</checkpoint>
        </meta>
        <location>:assign[2]</location>
      </assign>
      <assign>
        <assignment>
          <document>
            <input>
              <from>adapter name</from>
            </input>
          </document>
          <result>
            <output>
              <to>adapter request</to>
            </output>
          </result>
          <xslt-stylesheet>
            <stylesheet-replacement-tokens>
              <replacement-token name="node">
                <input global="false">
                  <from>node</from>
                </input>
              </replacement-token>
              <replacement-token name="fqdn">
                <input global="false">
                  <from>fqdn</from>
                </input>
              </replacement-token>
              <replacement-token name="manager">
                <input global="false">
                  <from>manager</from>
                </input>
              </replacement-token>
              <replacement-token name="agent">
                <input global="false">
                  <from>agent</from>
                </input>
              </replacement-token>
              <replacement-token name="alertgroup">
                <input global="false">
                  <from>alertgroup</from>
                </input>
              </replacement-token>
              <replacement-token name="severity">
                <input global="false">
                  <from>severity</from>
                </input>
              </replacement-token>
              <replacement-token name="summary">
                <input global="false">
                  <from>summary</from>
                </input>
              </replacement-token>
              <replacement-token name="identifier">
                <input global="false">
                  <from>identifier</from>
                </input>
              </replacement-token>
              <replacement-token name="timenow">
                <input global="false">
                  <from>time now</from>
                </input>
              </replacement-token>
              <replacement-token name="owner id">
                <input global="false">
                  <from>owner id</from>
                </input>
              </replacement-token>
            </stylesheet-replacement-tokens>
            <stylesheet><![CDATA[<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" version="1.0">
  <xsl:template match="/">
    <request-data>
      <OmnibusAdapterRequest>
        <action>
          <xsl:text disable-output-escaping="no">insert into alerts.status (Identifier, Node, NodeAlias, FirstOccurrence, Manager, Agent, AlertGroup, AlertKey, Severity, OwnerUID, Summary) values ('${identifier}', '${node}', '${fqdn}', ${timenow}, '${manager}', '${agent}', '${alertgroup}', '${identifier}', ${severity}, ${owner id}, '${summary}')</xsl:text>
        </action>
      </OmnibusAdapterRequest>
    </request-data>
  </xsl:template>
</xsl:stylesheet>]]></stylesheet>
          </xslt-stylesheet>
        </assignment>
        <meta>
          <documentation />
          <checkpoint>false</checkpoint>
        </meta>
        <before-execution>
          <log>
            <level>debug</level>
            <parameters>
              <input>
                <value>About to setup adapter request</value>
              </input>
              <input>
                <from>adapter name</from>
              </input>
              <input>
                <from>owner id</from>
              </input>
            </parameters>
          </log>
        </before-execution>
        <location>:assign[3]</location>
      </assign>
      <call-adapter>
        <parameters>
          <input global="false">
            <from>adapter name</from>
          </input>
          <input>
            <value>
              <adapter-request>
                <peer-location>
                  <location>any</location>
                </peer-location>
              </adapter-request>
            </value>
          </input>
          <input global="false">
            <from>adapter request</from>
          </input>
          <input global="false">
            <from>adapter request</from>
          </input>
        </parameters>
        <meta>
          <documentation />
          <checkpoint>false</checkpoint>
        </meta>
        <before-execution>
          <log>
            <level>debug</level>
            <parameters>
              <input>
                <value>Adapter request</value>
              </input>
              <input>
                <from>adapter request</from>
              </input>
            </parameters>
          </log>
        </before-execution>
        <after-execution>
          <log>
            <level>debug</level>
            <parameters>
              <input>
                <value>EMS Event created</value>
              </input>
            </parameters>
          </log>
        </after-execution>
        <location>:call-adapter[1]</location>
      </call-adapter>
      <assign>
        <assignment>
          <document>
            <input>
              <from>adapter name</from>
            </input>
          </document>
          <result>
            <output>
              <to>adapter request</to>
            </output>
          </result>
          <xslt-stylesheet>
            <stylesheet-replacement-tokens>
              <replacement-token name="identifier">
                <input global="false">
                  <from>identifier</from>
                </input>
              </replacement-token>
            </stylesheet-replacement-tokens>
            <stylesheet><![CDATA[<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="1.0"
                xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
                xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <xsl:template match="/">
    <request-data>
      <OmnibusAdapterRequest>
        <action>select Serial from alerts.status where Identifier = '${identifier}'</action>
      </OmnibusAdapterRequest>
    </request-data>
  </xsl:template>
</xsl:stylesheet>]]></stylesheet>
          </xslt-stylesheet>
        </assignment>
        <meta>
          <documentation />
          <checkpoint>false</checkpoint>
        </meta>
        <location>:assign[4]</location>
      </assign>
      <call-adapter>
        <parameters>
          <input global="false">
            <from>adapter name</from>
          </input>
          <input>
            <value>
              <adapter-request>
                <peer-location>
                  <location>any</location>
                </peer-location>
              </adapter-request>
            </value>
          </input>
          <input global="false">
            <from>adapter request</from>
          </input>
          <input global="false">
            <from>adapter request</from>
          </input>
          <output global="false">
            <to>adapter response</to>
          </output>
        </parameters>
        <meta>
          <documentation />
          <checkpoint>false</checkpoint>
        </meta>
        <before-execution>
          <log>
            <level>debug</level>
            <parameters>
              <input>
                <value>Adapter Request</value>
              </input>
              <input>
                <from>adapter request</from>
              </input>
            </parameters>
          </log>
        </before-execution>
        <location>:call-adapter[2]</location>
      </call-adapter>
      <assign>
        <assignment>
          <document>
            <input>
              <from>adapter response</from>
            </input>
          </document>
          <result>
            <output>
              <to>serial</to>
            </output>
          </result>
          <xpath-expression>
            <xpath-replacement-tokens />
            <xpath><![CDATA[//column[@name='Serial']/text()]]></xpath>
          </xpath-expression>
        </assignment>
        <meta>
          <documentation />
          <checkpoint>false</checkpoint>
        </meta>
        <after-execution>
          <log>
            <level>debug</level>
            <parameters>
              <input>
                <from>serial</from>
              </input>
            </parameters>
          </log>
        </after-execution>
        <location>:assign[5]</location>
      </assign>
    </sequence>
    <meta>
      <expose-to>
        <consumer>RULE</consumer>
        <consumer>SCHEDULE</consumer>
      </expose-to>
      <documentation>
        <description>Insert Alert
    Inserts an OMNIbus alert.

    Inputs
        adapter name    [Optional]
            The adapter to be used to handle the request. If not provided, "EMSAdapter" will be used.
        fqdn
            The alert fqdn.
        severity
            The alert severity.
        summary
            The alert summary.
        identifier
            The alert identifier.
        alertgroup
            The alert alertgroup.

    Outputs
        serial
            Identifies the alert.</description>
        <version>1.0</version>
      </documentation>
      <peer-location>
        <location>any</location>
      </peer-location>
      <record-metrics>false</record-metrics>
      <process-id>525961fd-2fa3-3f66-a63a-e85e238b0af1</process-id>
      <author>admin</author>
      <category></category>
      <status></status>
      <keywords></keywords>
      <systems></systems>
      <last-modified-by>admin</last-modified-by>
      <last-modified>1282115247838</last-modified>
    </meta>
  </process-def>
</process>