<process draft="false" dev-studio-version="7.6.03">
  <process-def name=":AMP-AD-IBM-Tivoli-NetcoolOMNIbus:v7.x:Get Alerts">
    <parameters>
      <input global="false" required="false">
        <from>adapter name</from>
        <to>adapter name</to>
      </input>
      <input global="false" required="true">
        <from>key</from>
        <to>key</to>
      </input>
      <input global="false" required="true">
        <from>value</from>
        <to>value</to>
      </input>
      <input global="false" required="true">
        <from>requested mappings</from>
        <to>mappings</to>
      </input>
      <input global="false" required="false">
        <from>is char</from>
        <to>is char</to>
      </input>
      <output global="false" required="true">
        <to>response</to>
        <from>adapter response</from>
      </output>
    </parameters>
    <access />
    <sequence>
      <switch>
        <meta>
          <documentation />
          <run-mode-handling>
            <run-mode>OCP</run-mode>
            <allow-step-into>true</allow-step-into>
          </run-mode-handling>
          <checkpoint>false</checkpoint>
        </meta>
        <execute-all-applicable-cases>false</execute-all-applicable-cases>
        <default>
          <sequence />
        </default>
        <case>
          <condition>
            <document>
              <input>
                <from>adapter name</from>
              </input>
            </document>
            <xpath-expression>
              <xpath-replacement-tokens />
              <xpath><![CDATA[string-length(.)=0]]></xpath>
            </xpath-expression>
          </condition>
          <sequence>
            <assign>
              <assignment>
                <output>
                  <to>adapter name</to>
                  <value>OMNIbusAdapter</value>
                </output>
              </assignment>
              <meta>
                <documentation />
                <checkpoint>false</checkpoint>
              </meta>
              <after-execution>
                <log>
                  <level>debug</level>
                  <parameters>
                    <input>
                      <value>Done assigning adapter name</value>
                    </input>
                    <input>
                      <from>adapter name</from>
                    </input>
                  </parameters>
                </log>
              </after-execution>
              <location>:switch[1]:sequence[2]:assign[1]</location>
            </assign>
          </sequence>
        </case>
        <location>:switch[1]</location>
      </switch>
      <switch>
        <meta>
          <documentation />
          <run-mode-handling>
            <run-mode>OCP</run-mode>
            <allow-step-into>true</allow-step-into>
          </run-mode-handling>
          <checkpoint>false</checkpoint>
        </meta>
        <execute-all-applicable-cases>false</execute-all-applicable-cases>
        <default>
          <sequence />
        </default>
        <case>
          <condition>
            <document>
              <input>
                <from>is char</from>
              </input>
            </document>
            <xpath-expression>
              <xpath-replacement-tokens />
              <xpath><![CDATA[string-length(.)=0]]></xpath>
            </xpath-expression>
          </condition>
          <sequence>
            <assign>
              <assignment>
                <output>
                  <to>is char</to>
                  <value>false</value>
                </output>
              </assignment>
              <meta>
                <documentation />
                <checkpoint>false</checkpoint>
              </meta>
              <location>:switch[2]:sequence[2]:assign[1]</location>
            </assign>
          </sequence>
        </case>
        <location>:switch[2]</location>
      </switch>
      <assign>
        <assignment>
          <document>
            <input>
              <from>mappings</from>
            </input>
          </document>
          <result>
            <output>
              <to>adapter request</to>
            </output>
          </result>
          <xslt-stylesheet>
            <stylesheet-replacement-tokens>
              <replacement-token name="key">
                <input global="false">
                  <from>key</from>
                </input>
              </replacement-token>
              <replacement-token name="value">
                <input global="false">
                  <from>value</from>
                </input>
              </replacement-token>
              <replacement-token name="is char">
                <input global="false">
                  <from>is char</from>
                </input>
              </replacement-token>
            </stylesheet-replacement-tokens>
            <stylesheet><![CDATA[<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
  <xsl:output indent="yes" />
  <xsl:template match="/">
    <request-data>
      <OmnibusAdapterRequest>
        <action>
          <xsl:text disable-output-escaping="no">select </xsl:text>
          <xsl:for-each select="result/mappings/*">
            <xsl:value-of select="text()" />
            <xsl:if test="position()!=last()">
              <xsl:text>, </xsl:text>
            </xsl:if>
          </xsl:for-each>
          <xsl:text disable-output-escaping="no"> from alerts.status where ${key}=</xsl:text>
          <xsl:if test="${is char}()">
            <xsl:text disable-output-escaping="no">'</xsl:text>
          </xsl:if>
          <xsl:text disable-output-escaping="no">${value}</xsl:text>
          <xsl:if test="${is char}()">
            <xsl:text disable-output-escaping="no">'</xsl:text>
          </xsl:if>
        </action>
      </OmnibusAdapterRequest>
    </request-data>
  </xsl:template>
</xsl:stylesheet>]]></stylesheet>
          </xslt-stylesheet>
        </assignment>
        <meta>
          <documentation />
          <checkpoint>false</checkpoint>
        </meta>
        <before-execution>
          <log>
            <level>debug</level>
            <parameters>
              <input>
                <value>About to setup adapter request</value>
              </input>
              <input>
                <from>adapter name</from>
              </input>
            </parameters>
          </log>
        </before-execution>
        <location>:assign[1]</location>
      </assign>
      <call-adapter>
        <parameters>
          <input global="false">
            <from>adapter name</from>
          </input>
          <input>
            <value>
              <adapter-request>
                <peer-location>
                  <location>any</location>
                </peer-location>
              </adapter-request>
            </value>
          </input>
          <input global="false">
            <from>adapter request</from>
          </input>
          <input global="false">
            <from>adapter request</from>
          </input>
          <output global="false">
            <to>adapter response</to>
          </output>
        </parameters>
        <meta>
          <documentation />
          <checkpoint>false</checkpoint>
        </meta>
        <before-execution>
          <log>
            <level>debug</level>
            <parameters>
              <input>
                <value>before call</value>
              </input>
              <input>
                <from>adapter request</from>
              </input>
            </parameters>
          </log>
        </before-execution>
        <after-execution>
          <log>
            <level>debug</level>
            <parameters>
              <input>
                <value>Adapter response</value>
              </input>
              <input>
                <from>adapter response</from>
              </input>
            </parameters>
          </log>
        </after-execution>
        <location>:call-adapter[1]</location>
      </call-adapter>
    </sequence>
    <meta>
      <expose-to>
        <consumer>RULE</consumer>
        <consumer>SCHEDULE</consumer>
      </expose-to>
      <documentation>
        <description>Get Alerts
    Gets one or more OMNIbus alerts satisfying a specified condition.

    Inputs
        adapter name    [Optional]
            The name of the adapter to use to satisfy this request. If not provided, then "EMSAdapter" will be used.
        key
            Identifies an OMNIbus alert field that must contain the specified value.
        value
            Specifies the value that must be present in the specified field for matching OMNIbus alerts.
        requested mappings
            An XML document that maps from keys to OMNIbus alert fields and also identifies the set of fields to return for each matching alert. The document must have a root element named "mappings", and one or more children elements with keys for names and OMNIbus alert fields for text content. For example, with the following requested mappings,

   &lt;mappings&gt;
      &lt;serial&gt;Serial&lt;/serial&gt;
      &lt;id&gt;Identifier&lt;/id&gt;
      &lt;node&gt;Node&lt;/node&gt;
   &lt;/mappings&gt;

    a query can be issued that uses "node" as the "key" parameter, and some node identifier for the "value" parameter, and all alerts that match this node will be returned, with "Serial", "Identifier", and "Node" being returned for each alert.

    Outputs
        response
            The OMNIbus adapter response containing the alert. The response contains the following XML elements:
              queryExecuted               The syntax of the query defined in the adapter request.
              responseRowCount        The number of rows returned in the response.
              responseColumnCount  The number of columns returned for each row.
              row                                Contains the values returned for one row of the query.
              column                          The column name and value returned in the response.</description>
        <version>1.0</version>
      </documentation>
      <peer-location>
        <location>any</location>
      </peer-location>
      <record-metrics>false</record-metrics>
      <process-id>c123ea5a-6ea5-3601-85fb-65fd100e3494</process-id>
      <author>admin</author>
      <category></category>
      <status></status>
      <keywords></keywords>
      <systems></systems>
      <last-modified-by>admin</last-modified-by>
      <last-modified>1456911764739</last-modified>
    </meta>
  </process-def>
</process>